{"ast":null,"code":"import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";// --- QoL: Render Empires search/filter/sort ---\nfunction renderEmpiresTab(){return/*#__PURE__*/_jsxs(\"div\",{className:\"empires-tab card\",style:{maxWidth:700,margin:'2rem auto',background:'var(--card-bg)',border:'1px solid var(--accent)',borderRadius:12,padding:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',marginBottom:'1.2rem',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search empires...\",value:empireSearch,onChange:e=>setEmpireSearch(e.target.value),style:{flex:1,padding:'0.6em',borderRadius:8,border:'1px solid var(--accent)'}}),/*#__PURE__*/_jsxs(\"select\",{value:empireSort,onChange:e=>setEmpireSort(e.target.value),style:{padding:'0.6em',borderRadius:8,border:'1px solid var(--accent)'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"name\",children:\"Sort by Name\"}),/*#__PURE__*/_jsx(\"option\",{value:\"owner\",children:\"Sort by Owner\"})]})]}),/*#__PURE__*/_jsx(\"div\",{children:filteredEmpires.map(e=>{var _empireInfo$e$name;return/*#__PURE__*/_jsxs(\"div\",{className:\"empire-list-item card\",style:{marginBottom:12,padding:'1rem',borderLeft:'6px solid #b3cfff'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,fontSize:'1.15em'},children:e.name}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Owner: \",getEmpireAccount(e.name)||/*#__PURE__*/_jsx(\"i\",{children:\"Unassigned\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Lore: \",((_empireInfo$e$name=empireInfo[e.name])===null||_empireInfo$e$name===void 0?void 0:_empireInfo$e$name.lore)||/*#__PURE__*/_jsx(\"i\",{children:\"No lore\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{marginTop:6},onClick:()=>setEmpirePage(e.name),children:\"View\"})]},e.name);})})]});// --- QoL: Render Treaty search/filter/sort/pagination ---\nfunction renderTreatiesTab(){return/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-tab card\",style:{maxWidth:700,margin:'2rem auto',background:'var(--card-bg)',border:'1px solid var(--accent)',borderRadius:12,padding:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',marginBottom:'1.2rem',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search treaties...\",value:treatySearch,onChange:e=>{setTreatySearch(e.target.value);setTreatyPage(1);},style:{flex:1,padding:'0.6em',borderRadius:8,border:'1px solid var(--accent)'}}),/*#__PURE__*/_jsxs(\"select\",{value:treatySort,onChange:e=>setTreatySort(e.target.value),style:{padding:'0.6em',borderRadius:8,border:'1px solid var(--accent)'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"Sort by Title\"}),/*#__PURE__*/_jsx(\"option\",{value:\"owner\",children:\"Sort by Owner\"}),/*#__PURE__*/_jsx(\"option\",{value:\"status\",children:\"Sort by Status\"})]})]}),/*#__PURE__*/_jsx(\"div\",{children:paginatedTreaties.map(t=>{var _t$participants;return/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-list-item card\",style:{marginBottom:12,padding:'1rem',borderLeft:`6px solid ${TREATY_STATUS_COLORS[t.status]||'#aaa'}`},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,fontSize:'1.15em'},children:t.title}),/*#__PURE__*/_jsx(\"div\",{style:{color:TREATY_STATUS_COLORS[t.status]||'#aaa'},children:t.status}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Owner: \",t.owner]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Participants: \",((_t$participants=t.participants)===null||_t$participants===void 0?void 0:_t$participants.join(', '))||/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{marginTop:6},onClick:()=>handleViewTreaty(t),children:\"View\"}),canEditTreaty(t)&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",style:{marginLeft:8},onClick:()=>handleEditTreaty(t),children:\"Edit\"})]},t.id);})}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:18,display:'flex',gap:8,justifyContent:'center'},children:Array.from({length:treatyPages},(_,i)=>/*#__PURE__*/_jsx(\"button\",{className:i+1===treatyPage?'empire-save-btn':'empire-back-btn',onClick:()=>setTreatyPage(i+1),children:i+1},i))})]});}// --- Treaty View UI ---\nfunction TreatyView(_ref){var _treaty$participants;let{treaty,onBack,onEdit,onTransfer,canEdit,canTransfer,accounts}=_ref;if(!treaty)return null;const statuses={discussion:'🗨️ In Discussion',active:'✅ Active',broken:'❌ Broken',expired:'⌛ Expired',other:'❓ Other'};return/*#__PURE__*/_jsx(\"div\",{className:\"treaty-dialog-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-dialog\",children:[/*#__PURE__*/_jsx(\"h2\",{children:treaty.title}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Status:\"}),\" \",statuses[treaty.status]||treaty.status]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Owner:\"}),\" \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",((_treaty$participants=treaty.participants)===null||_treaty$participants===void 0?void 0:_treaty$participants.join(', '))||/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{margin:'1em 0',whiteSpace:'pre-line'},children:treaty.content}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",style:{minWidth:110,maxWidth:160},onClick:onBack,children:\"Back\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{minWidth:110,maxWidth:160},onClick:onEdit,children:\"Edit\"})]})]})});}// --- NEW: Permissions state for GameMaster ---\nconst[showMenu,setShowMenu]=useState(false);const[showPermissions,setShowPermissions]=useState(false);const[gmPermissions,setGmPermissions]=useState(()=>{// Persist in localStorage\nconst saved=localStorage.getItem('stellarisGmPermissions');return saved?JSON.parse(saved):{canDeleteMessages:true};});// Save GM permissions to localStorage\nuseEffect(()=>{localStorage.setItem('stellarisGmPermissions',JSON.stringify(gmPermissions));},[gmPermissions]);// --- NEW: Menu handlers ---\nfunction handleMenuToggle(){setShowMenu(v=>!v);setShowPermissions(false);}function handleMenuClose(){setShowMenu(false);setShowPermissions(false);}// Keep menu open when hovering either dropdown or permissions\nconst menuDropdownRef=useRef(null);const permissionsDropdownRef=useRef(null);// Close menu only if mouse leaves both dropdowns\nuseEffect(()=>{if(!showMenu&&!showPermissions)return;function handleMouseMove(e){if(menuDropdownRef.current&&permissionsDropdownRef.current&&!menuDropdownRef.current.contains(e.target)&&!permissionsDropdownRef.current.contains(e.target)){setShowMenu(false);setShowPermissions(false);}}document.addEventListener('mousedown',handleMouseMove);return()=>document.removeEventListener('mousedown',handleMouseMove);},[showMenu,showPermissions]);function handlePermissionsToggle(){setShowPermissions(v=>!v);}function handlePermissionChange(key,value){setGmPermissions(prev=>({...prev,[key]:value}));}// --- NEW: Other menu options ---\nfunction handleShowAbout(){alert(\"Stellaris RP Board\\n\\nCreated for roleplay and diplomacy.\\n\\nContact: admin@example.com\");handleMenuClose();}function handleShowTheme(){alert(\"Theme switcher coming soon!\");handleMenuClose();}// Only load empireInfo when switching to the Empires tab and not viewing/editing any empire.\n// This prevents any reloads while editing or viewing an empire.\nuseEffect(()=>{if(activeTab==='empires'&&!editEmpire&&!empirePage){// Add cache-busting query param\nfetch(`/empireInfo.json?ts=${Date.now()}`).then(res=>res.json()).then(data=>{setEmpireInfo(data&&typeof data==='object'?data:{});setEmpireInfoLoaded(true);}).catch(()=>setEmpireInfoLoaded(true));}// Only run when switching tabs, or leaving view/edit mode\n},[activeTab,editEmpire,empirePage]);// Helper: get empire names\nfunction getEmpireNames(){// Only include empires that exist (already the case)\nreturn empires.map(e=>e.name);}// Helper: get boards from linked empires\nfunction getLinkedBoards(){const names=getEmpireNames();return getNationPairs(names);}// Helper: get account linked to empire\nfunction getEmpireAccount(empireName){const emp=empires.find(e=>e.name===empireName);return emp&&emp.account?emp.account:null;}// Only show boards for the empire assigned to the logged-in account, except GameMaster sees all\nconst filteredBoards=account?account.username===\"GameMaster\"?getLinkedBoards():getLinkedBoards().filter(_ref2=>{let[a,b]=_ref2;return getEmpireAccount(a)===account.username||getEmpireAccount(b)===account.username;}):[];// GameMaster: link/unlink accounts to empires\nfunction handleLinkAccount(empireName,accountName){fetch('/api/empires/link',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({empireName,accountName})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>prev.map(e=>e.name===empireName?{...e,account:accountName}:e));}});}function handleUnlinkAccount(empireName){fetch('/api/empires/unlink',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({empireName})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>prev.map(e=>e.name===empireName?{...e,account:null}:e));}});}// Save selected board to localStorage\nfunction handleBoardSelect(pair){const key=pair.join('|');setSelected(key);localStorage.setItem('stellarisSelectedBoard',key);}// Fetch messages for the selected board from the server\nuseEffect(()=>{// Only poll messages if on channels tab and not editing/viewing empire\nif(!selected||activeTab!=='channels'||editEmpire||empirePage){// Stop polling if not in correct state\nif(pollingRef.current){clearInterval(pollingRef.current);pollingRef.current=null;}return;}// Use selected as key\nconst key=selected;// Function to fetch messages\nconst fetchMessages=()=>{fetch(`/api/messages?board=${encodeURIComponent(key)}`).then(res=>{if(!res.ok)throw new Error('Network response was not ok');return res.json();}).then(data=>{setMessages(prev=>({...prev,[key]:data}));}).catch(err=>{setMessages(prev=>({...prev,[key]:[]}));console.error('Failed to fetch messages:',err);});};// Initial fetch\nfetchMessages();// Set up polling\npollingRef.current=setInterval(fetchMessages,2000);// Cleanup on unmount or when selected/activeTab/editEmpire/empirePage changes\nreturn()=>{if(pollingRef.current){clearInterval(pollingRef.current);pollingRef.current=null;}};},[selected,activeTab,editEmpire,empirePage]);// Scroll to bottom only when messages actually change for the selected board\nconst prevMessagesLengthRef=useRef(0);useEffect(()=>{if(!selected)return;const currentMessages=messages[selected]||[];if(currentMessages.length!==prevMessagesLengthRef.current){if(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:'auto'});}prevMessagesLengthRef.current=currentMessages.length;}},[messages,selected]);// When posting, always use the logged-in account's empire name\nfunction postMessage(e){e.preventDefault();if(!selected||!account||!text.trim())return;const key=selected;const msg={board:key,author:account.username,text,timestamp:Date.now()};fetch('/api/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)}).then(res=>res.json()).then(()=>{fetch(`/api/messages?board=${encodeURIComponent(key)}`).then(res=>res.json()).then(data=>{setMessages(prev=>({...prev,[key]:data}));});});setText('');}// Fetch accounts from server (accounts.json)\nuseEffect(()=>{fetch('/accounts.json').then(res=>res.json()).then(data=>{setAccounts(data);setAccountsLoaded(true);}).catch(()=>setAccountsLoaded(true));},[]);// Load empires from empires.json\nuseEffect(()=>{fetch('/empires.json').then(res=>res.json()).then(data=>{setEmpires(Array.isArray(data)?data:[]);});},[]);// Fetch treaties from backend\nuseEffect(()=>{fetch('/treaties.json').then(res=>res.json()).then(data=>{setTreaties(Array.isArray(data)?data:[]);setTreatiesLoaded(true);}).catch(()=>setTreatiesLoaded(true));},[]);function handleLogin(e){e.preventDefault();// Wait until accounts are loaded\nif(!accountsLoaded){setError('Accounts are still loading, please wait...');return;}const username=loginUser.trim();const password=loginPass.trim();if(!accounts[username]){setError('Invalid credentials');return;}if(accounts[username]!==password){setError('Invalid credentials');return;}setAccount({username});localStorage.setItem('stellarisAccount',JSON.stringify({username}));setError('');}function handleLogout(){setAccount(null);localStorage.removeItem('stellarisAccount');}// Save empire info to backend and update local state\nfunction saveEmpireInfo(name,info){return fetch('/api/empireInfo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,info})}).then(res=>res.json()).then(()=>{// After saving, reload from backend with cache-busting param\nreturn fetch(`/empireInfo.json?ts=${Date.now()}`).then(res=>res.json()).then(data=>{setEmpireInfo(data&&typeof data==='object'?data:{});});});}// Edit panel for empire info\nfunction EmpireEditPanel(_ref3){let{name,onCancel}=_ref3;// Only initialize edit state from empireInfo[name] when the component mounts\nconst info=empireInfo[name]||{};const[edit,setEdit]=useState(info);// Do NOT use useEffect to update edit state from empireInfo.\n// This ensures the text fields are not reset while editing.\nfunction handleChange(e){setEdit({...edit,[e.target.name]:e.target.value});}function handleSave(e){e.preventDefault();saveEmpireInfo(name,edit).then(()=>{onCancel();});}return/*#__PURE__*/_jsxs(\"form\",{className:\"empire-edit-form\",onSubmit:handleSave,children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Lore:\",/*#__PURE__*/_jsx(\"textarea\",{name:\"lore\",value:edit.lore||'',onChange:handleChange,rows:3})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Stats:\",/*#__PURE__*/_jsx(\"input\",{name:\"stats\",value:edit.stats||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Ethics:\",/*#__PURE__*/_jsx(\"input\",{name:\"ethics\",value:edit.ethics||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Civics:\",/*#__PURE__*/_jsx(\"input\",{name:\"civics\",value:edit.civics||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Special Info:\",/*#__PURE__*/_jsx(\"input\",{name:\"special\",value:edit.special||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',marginTop:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"empire-back-btn\",onClick:onCancel,children:\"Cancel\"})]})]});}// View panel for empire info\nfunction EmpirePanel(_ref4){let{name,canEdit}=_ref4;const info=empireInfo[name]||{};return/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-card empire-info-page\",style:{maxWidth:420,margin:'2rem auto',background:'var(--card-bg)',border:'1.5px solid var(--accent)',borderRadius:14,boxShadow:'0 2px 16px #0002',padding:'2rem 2rem',display:'flex',flexDirection:'column',alignItems:'stretch',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"empire-info-title\",style:{marginBottom:0},children:name}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#b3cfff',fontWeight:500,marginBottom:'1.2rem',fontSize:'1.08em',textAlign:'center'},children:[\"Owner: \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff'},children:getEmpireAccount(name)||/*#__PURE__*/_jsx(\"i\",{children:\"Unassigned\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-details\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Lore:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.lore||/*#__PURE__*/_jsx(\"i\",{children:\"No lore set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Stats:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.stats||/*#__PURE__*/_jsx(\"i\",{children:\"No stats set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Ethics:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.ethics||/*#__PURE__*/_jsx(\"i\",{children:\"No ethics set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Civics:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.civics||/*#__PURE__*/_jsx(\"i\",{children:\"No civics set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Special Info:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.special||/*#__PURE__*/_jsx(\"i\",{children:\"No special info set.\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',marginTop:'1.5rem',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",onClick:()=>setEmpirePage(null),children:\"Back to Empires\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>setEditEmpire(name),children:\"Edit\"})]})]});}// Defensive: ensure empireInfo is always an object\nuseEffect(()=>{if(!empireInfo||typeof empireInfo!=='object'||Array.isArray(empireInfo)){setEmpireInfo({});}},[empireInfo]);// Defensive: ensure accounts is always an object\nuseEffect(()=>{if(!accounts||typeof accounts!=='object'||Array.isArray(accounts)){setAccounts({});}},[accounts]);// Add API to create new account\nfunction handleCreateAccount(e){e.preventDefault();setAccountError('');setAccountSuccess('');const name=newAccountName.trim();const pass=newAccountPass.trim();if(!name||!pass){setAccountError('Name and password required');return;}if(accounts[name]){setAccountError('Account already exists');return;}setAccountsTabLoading(true);fetch('/api/accounts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,pass})}).then(res=>res.json()).then(data=>{if(data.success){setAccounts(prev=>({...prev,[name]:pass}));// Remove: setEmpires(prev => prev.includes(name) ? prev : [...prev, name]);\nsetAccountSuccess('Account created');setNewAccountName('');setNewAccountPass('');}else{setAccountError(data.error||'Failed to create account');}}).catch(()=>setAccountError('Failed to create account')).finally(()=>setAccountsTabLoading(false));}// API: Rename account\nfunction handleRenameAccount(e){e.preventDefault();setEditAccountError('');setEditAccountLoading(true);const oldName=editAccount;const newName=editAccountName.trim();if(!newName||newName===oldName){setEditAccountError('Enter a new name');setEditAccountLoading(false);return;}fetch('/api/accounts/rename',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({oldName,newName})}).then(res=>res.json()).then(data=>{if(data.success){// Update local state\nsetAccounts(prev=>{const updated={...prev};updated[newName]=updated[oldName];delete updated[oldName];return updated;});setEmpires(prev=>prev.map(e=>e===oldName?newName:e));setEditAccount(null);}else{setEditAccountError(data.error||'Rename failed');}}).catch(()=>setEditAccountError('Rename failed')).finally(()=>setEditAccountLoading(false));}// API: Change password\nfunction handleChangePassword(e){e.preventDefault();setEditAccountError('');setEditAccountLoading(true);const name=editAccount;const pass=editAccountPass.trim();if(!pass){setEditAccountError('Enter a new password');setEditAccountLoading(false);return;}fetch('/api/accounts/password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,pass})}).then(res=>res.json()).then(data=>{if(data.success){setAccounts(prev=>({...prev,[name]:pass}));setEditAccount(null);}else{setEditAccountError(data.error||'Password change failed');}}).catch(()=>setEditAccountError('Password change failed')).finally(()=>setEditAccountLoading(false));}// API: Delete account\nfunction handleDeleteAccount(name){if(!window.confirm(`Delete account \"${name}\"? This cannot be undone.`))return;setEditAccountLoading(true);fetch('/api/accounts/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})}).then(res=>res.json()).then(data=>{if(data.success){setAccounts(prev=>{const updated={...prev};delete updated[name];return updated;});setEmpires(prev=>prev.filter(e=>e!==name));setEditAccount(null);}else{alert(data.error||'Delete failed');}}).catch(()=>alert('Delete failed')).finally(()=>setEditAccountLoading(false));}// API: Create new empire\nfunction handleCreateEmpire(e){e.preventDefault();setNewEmpireError('');setNewEmpireLoading(true);const name=newEmpireName.trim();if(!name){setNewEmpireError('Empire name required');setNewEmpireLoading(false);return;}if(empires.some(e=>e.name===name)){setNewEmpireError('Empire already exists');setNewEmpireLoading(false);return;}fetch('/api/empires/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>[...prev,{name,account:null}]);setNewEmpireName('');}else{setNewEmpireError(data.error||'Failed to create empire');}}).catch(()=>setNewEmpireError('Failed to create empire')).finally(()=>setNewEmpireLoading(false));}// API: Delete empire\nfunction handleDeleteEmpire(name){if(!window.confirm(`Delete empire \"${name}\"? This cannot be undone.`))return;setNewEmpireLoading(true);fetch('/api/empires/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>{const updated=prev.filter(e=>e.name!==name);// If the selected board involves the deleted empire, clear selection\nif(selected){const[a,b]=selected.split('|');if(a===name||b===name){setSelected(null);localStorage.removeItem('stellarisSelectedBoard');}}return updated;});}else{setNewEmpireError(data.error||'Failed to delete empire');}}).catch(()=>setNewEmpireError('Failed to delete empire')).finally(()=>setNewEmpireLoading(false));}// Treaties: permissions\nfunction canEditTreaty(treaty){if(!account)return false;return account.username===treaty.owner||account.username===\"GameMaster\";}function canTransferTreaty(treaty){return account&&account.username===\"GameMaster\";}// Treaties: open new form\nfunction handleAddTreaty(){setTreatyDialog({open:true,mode:'new',data:null});setTreatyError('');}// Treaties: open edit\nfunction handleEditTreaty(treaty){setTreatyDialog({open:true,mode:'edit',data:treaty});setTreatyError('');}// Treaties: open view\nfunction handleViewTreaty(treaty){setTreatyDialog({open:true,mode:'view',data:treaty});setTreatyError('');}// Treaties: cancel form\nfunction handleCancelTreatyForm(){setTreatyDialog({open:false,mode:null,data:null});setTreatyError('');}// Treaties: save (create or update)\nfunction handleSaveTreaty(e){e.preventDefault();setTreatyError('');setTreatySaving(true);const isEdit=treatyEditId!=null;const form={...treatyForm};if(!form.title.trim()||!form.content.trim()||!form.participants.length){setTreatyError('Title, content, and at least one participant are required.');setTreatySaving(false);return;}if(!form.owner)form.owner=account?account.username:'';if(!form.status)form.status='discussion';if(!form.id)form.id=isEdit?treatyEditId:Date.now().toString();fetch('/api/treaties',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)}).then(res=>res.json()).then(data=>{if(data.success){// Always fetch the latest treaties from /treaties.json after save\nreturn fetch('/treaties.json?ts='+Date.now()).then(res=>res.json()).then(data2=>{setTreaties(Array.isArray(data2)?data2:[]);setTreatyForm(null);setTreatyEditId(null);setShowTreatyForm(false);setTreatyViewId(form.id);});}else{setTreatyError(data.error||'Failed to save treaty');}}).catch(()=>setTreatyError('Failed to save treaty')).finally(()=>setTreatySaving(false));}// Treaties: transfer ownership (GM only)\nfunction handleTransferTreatyOwner(treaty,newOwner){if(!canTransferTreaty(treaty))return;setTreatySaving(true);fetch('/api/treaties/transfer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:treaty.id,newOwner})}).then(res=>res.json()).then(data=>{if(data.success){return fetch('/treaties.json').then(res=>res.json()).then(data2=>setTreaties(Array.isArray(data2)?data2:[]));}}).finally(()=>setTreatySaving(false));}// Treaties: form field change\nfunction handleTreatyFormChange(e){const{name,value,type,options}=e.target;if(type==='select-multiple'){const vals=Array.from(options).filter(o=>o.selected).map(o=>o.value);setTreatyForm(f=>({...f,[name]:vals}));}else{setTreatyForm(f=>({...f,[name]:value}));}}// Treaties: render\nfunction renderTreatyForm(){if(!treatyForm)return null;return/*#__PURE__*/_jsxs(\"form\",{className:\"treaty-form card\",onSubmit:handleSaveTreaty,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-header\",children:[/*#__PURE__*/_jsx(\"input\",{name:\"title\",placeholder:\"Treaty Title\",value:treatyForm.title,onChange:handleTreatyFormChange,className:\"login-input\",required:true,disabled:treatySaving}),/*#__PURE__*/_jsx(\"select\",{name:\"status\",value:treatyForm.status,onChange:handleTreatyFormChange,className:\"login-input\",disabled:treatySaving,children:TREATY_STATUSES.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.value,children:s.label},s.value))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-participants\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"participants-select\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"participants-label\",children:\"Participants\"}),/*#__PURE__*/_jsx(\"select\",{name:\"participants\",value:treatyForm.participants,onChange:handleTreatyFormChange,className:\"login-input\",multiple:true,disabled:treatySaving,children:getEmpireNames().map(e=>/*#__PURE__*/_jsx(\"option\",{value:e,children:e},e))})]}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"owner-select\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"owner-label\",children:\"Owner:\"}),/*#__PURE__*/_jsx(\"select\",{name:\"owner\",value:treatyForm.owner,onChange:handleTreatyFormChange,className:\"login-input\",disabled:treatySaving,children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsx(\"option\",{value:acc,children:acc},acc))})]})]}),/*#__PURE__*/_jsx(\"label\",{className:\"treaty-content-label\",children:\"Treaty Content\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"content\",placeholder:\"Treaty Content\",value:treatyForm.content,onChange:handleTreatyFormChange,className:\"login-input\",rows:9,required:true,disabled:treatySaving}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:treatySaving,children:treatyEditId?\"Save Changes\":\"Create Treaty\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"empire-back-btn\",onClick:handleCancelTreatyForm,disabled:treatySaving,children:\"Cancel\"}),treatyError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error treaty-error\",children:treatyError})]})]});}function renderTreatyView(treaty){const statusObj=TREATY_STATUSES.find(s=>s.value===treaty.status);return/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"treaty-title\",children:treaty.title}),/*#__PURE__*/_jsx(\"span\",{className:\"treaty-status\",style:{color:statusObj.color},children:statusObj?statusObj.label:treaty.status})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-owner\",children:[\"Owner: \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-participants\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",treaty.participants&&treaty.participants.length>0?treaty.participants.join(', '):/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"treaty-content-static\",children:treaty.content}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",onClick:()=>setTreatyViewId(null),children:\"Back\"}),canEditTreaty(treaty)&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>handleEditTreaty(treaty),children:\"Edit\"}),canTransferTreaty(treaty)&&/*#__PURE__*/_jsx(\"select\",{value:treaty.owner,onChange:e=>handleTransferTreatyOwner(treaty,e.target.value),className:\"owner-transfer-select\",children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsx(\"option\",{value:acc,children:acc},acc))})]})]});}// Add tab for GameMaster\nconst showAccountsTab=account&&account.username===\"GameMaster\";const tabs=[{key:'channels',label:'Channels'},{key:'empires',label:'Empires'},{key:'treaties',label:'Treaties'}];if(showAccountsTab){tabs.push({key:'accounts',label:'Manage Accounts'});tabs.push({key:'manage-empires',label:'Manage Empires'});}// Ref for account edit panel\nconst accountEditPanelRef=useRef(null);// Scroll to edit panel when editAccount changes\nuseEffect(()=>{if(editAccount&&accountEditPanelRef.current){accountEditPanelRef.current.scrollIntoView({behavior:'smooth',block:'center'});}},[editAccount]);// --- MODIFIED: Only allow delete if GM and permission enabled ---\nfunction handleDeleteMessage(boardKey,msgIdx){if(!account||account.username!==\"GameMaster\"||!gmPermissions.canDeleteMessages)return;if(!window.confirm(\"Delete this message?\"))return;fetch('/api/messages/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({board:boardKey,index:Number(msgIdx)})}).then(res=>res.json()).then(()=>{fetch(`/api/messages?board=${encodeURIComponent(boardKey)}`).then(res=>res.json()).then(data=>{setMessages(prev=>({...prev,[boardKey]:data}));});});}return/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Stellaris RP Diplomatic Message Boards\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"tabs-bar\",children:[tabs.map(tab=>/*#__PURE__*/_jsx(\"button\",{className:`tab-btn${activeTab===tab.key?' active':''}`,onClick:()=>{setActiveTab(tab.key);setEmpirePage(null);setEditEmpire(null);setEditAccount(null);setTreatyEditId(null);setTreatyViewId(null);setShowTreatyForm(false);},children:tab.label},tab.key)),/*#__PURE__*/_jsxs(\"div\",{className:\"menu-dropdown-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"menu-btn\",\"aria-label\":\"Open menu\",onClick:handleMenuToggle,children:/*#__PURE__*/_jsx(\"span\",{className:\"menu-icon\",children:\"\\u2630\"})}),showMenu&&/*#__PURE__*/_jsxs(\"div\",{className:\"menu-dropdown\",ref:menuDropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{className:\"menu-dropdown-item logout-btn\",onClick:handleLogout,children:[/*#__PURE__*/_jsx(\"span\",{className:\"logout-icon\",children:\"\\uD83D\\uDD11\"}),\" Logout\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handleShowAbout,children:\"About\"}),/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handleShowTheme,children:\"Theme Switcher\"}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handlePermissionsToggle,children:\"Manage Permissions\"})]}),showPermissions&&/*#__PURE__*/_jsxs(\"div\",{className:\"menu-permissions-dropdown\",ref:permissionsDropdownRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"menu-permissions-title\",children:\"GameMaster Permissions\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"menu-permissions-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!gmPermissions.canDeleteMessages,onChange:e=>handlePermissionChange('canDeleteMessages',e.target.checked)}),\"Allow deleting messages\"]})]})]})]})]}),/*#__PURE__*/_jsx(\"main\",{className:\"main-content\",children:activeTab==='treaties'?/*#__PURE__*/_jsxs(\"section\",{className:\"treaties-section card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Treaties, Contracts & Agreements\"}),account&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>openTreatyDialog('new'),children:\"+ Add New Treaty\"})]}),treatyDialog.open&&treatyDialog.mode!=='view'&&/*#__PURE__*/_jsx(TreatyDialog,{open:treatyDialog.open,mode:treatyDialog.mode,data:treatyDialog.data,onSave:handleTreatySave,onClose:closeTreatyDialog,error:treatyError,saving:treatySaving,empires:empires.map(e=>e.name),accounts:accounts}),treatyDialog.open&&treatyDialog.mode==='view'&&/*#__PURE__*/_jsx(TreatyView,{treaty:treatyDialog.data,onBack:closeTreatyDialog,onEdit:()=>openTreatyDialog('edit',treatyDialog.data),onTransfer:newOwner=>handleTreatyTransferOwner(treatyDialog.data.id,newOwner),canEdit:canEditTreaty(treatyDialog.data),canTransfer:canTransferTreaty(treatyDialog.data),accounts:accounts}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-list-container\",children:[!treatiesLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",children:\"Loading treaties...\"}),treaties.length===0&&treatiesLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"no-messages\",children:\"No treaties yet.\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"treaties-list\",children:treaties.map(treaty=>{var _treaty$participants2;return/*#__PURE__*/_jsxs(\"li\",{className:\"treaty-item\",onClick:()=>setTreatyDialog({open:true,mode:'view',data:treaty}),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"treaty-title\",children:treaty.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-meta\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-owner\",children:[\"Owner: \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-participants\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",((_treaty$participants2=treaty.participants)===null||_treaty$participants2===void 0?void 0:_treaty$participants2.join(', '))||/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"treaty-content\",children:treaty.content.length>180?treaty.content.slice(0,180)+'…':treaty.content})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-actions\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"treaty-status\",children:{discussion:'🗨️ In Discussion',active:'✅ Active',broken:'❌ Broken',expired:'⌛ Expired',other:'❓ Other'}[treaty.status]||treaty.status}),/*#__PURE__*/_jsxs(\"span\",{className:\"treaty-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",onClick:ev=>{ev.stopPropagation();setTreatyDialog({open:true,mode:'view',data:treaty});},children:\"View\"}),canEditTreaty(treaty)&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:ev=>{ev.stopPropagation();openTreatyDialog('edit',treaty);},children:\"Edit\"})]})]})]},treaty.id);})})]})]}):activeTab==='manage-empires'&&showAccountsTab?/*#__PURE__*/_jsxs(\"section\",{className:\"account-manage-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Manage Empires\"}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleCreateEmpire,className:\"account-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"account-form-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"New empire name\",value:newEmpireName,onChange:e=>setNewEmpireName(e.target.value),required:true,className:\"login-input\",disabled:newEmpireLoading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-btn\",disabled:newEmpireLoading,children:\"Create Empire\"})]})}),newEmpireError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:newEmpireError}),/*#__PURE__*/_jsx(\"h3\",{children:\"Empires & Account Assignment\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"accounts-list\",children:empires.map(emp=>/*#__PURE__*/_jsxs(\"li\",{className:\"account-item\",children:[/*#__PURE__*/_jsx(\"b\",{children:emp.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"account-actions\",children:[/*#__PURE__*/_jsxs(\"select\",{value:emp.account||'',onChange:e=>{const val=e.target.value;if(val)handleLinkAccount(emp.name,val);else handleUnlinkAccount(emp.name);},className:\"account-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",className:\"account-option\",children:\"Select account...\"}),Object.keys(accounts).map(accName=>/*#__PURE__*/_jsx(\"option\",{value:accName,className:\"account-option\",children:accName},accName))]}),/*#__PURE__*/_jsx(\"button\",{className:\"account-manage-btn account-delete-btn\",onClick:()=>handleDeleteEmpire(emp.name),disabled:newEmpireLoading,children:\"Delete\"})]})]},emp.name))})]}):activeTab==='accounts'&&showAccountsTab?/*#__PURE__*/_jsxs(\"section\",{className:\"account-manage-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Manage Accounts\"}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleCreateAccount,className:\"account-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"account-form-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Account name\",value:newAccountName,onChange:e=>setNewAccountName(e.target.value),required:true,className:\"login-input\",disabled:accountsTabLoading}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:newAccountPass,onChange:e=>setNewAccountPass(e.target.value),required:true,className:\"login-input\",disabled:accountsTabLoading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-btn\",disabled:accountsTabLoading,children:\"Create\"})]})}),accountError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:accountError}),accountSuccess&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",style:{color:'limegreen'},children:accountSuccess}),/*#__PURE__*/_jsx(\"h3\",{children:\"All Accounts\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"accounts-list\",children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsxs(\"li\",{className:\"account-item\",children:[/*#__PURE__*/_jsx(\"b\",{children:acc}),acc!==\"GameMaster\"&&/*#__PURE__*/_jsxs(\"span\",{className:\"account-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"account-manage-btn account-edit-btn\",onClick:()=>{setEditAccount(acc);setEditAccountName(acc);setEditAccountPass('');setEditAccountError('');},disabled:editAccountLoading,children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"account-manage-btn account-delete-btn\",onClick:()=>handleDeleteAccount(acc),disabled:editAccountLoading,children:\"Delete\"})]})]},acc))}),editAccount&&/*#__PURE__*/_jsxs(\"div\",{className:\"account-edit-panel card\",ref:accountEditPanelRef,children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Edit Account: \",/*#__PURE__*/_jsx(\"b\",{children:editAccount})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleRenameAccount,className:\"edit-account-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Rename to:\",/*#__PURE__*/_jsx(\"input\",{value:editAccountName,onChange:e=>setEditAccountName(e.target.value),className:\"login-input\",disabled:editAccountLoading})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:editAccountLoading,children:\"Rename\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleChangePassword,className:\"change-password-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"New Password:\",/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:editAccountPass,onChange:e=>setEditAccountPass(e.target.value),className:\"login-input\",disabled:editAccountLoading})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:editAccountLoading,children:\"Change Password\"})]}),editAccountError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:editAccountError}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",onClick:()=>setEditAccount(null),disabled:editAccountLoading,children:\"Cancel\"})]})]}):activeTab==='empires'?editEmpire?/*#__PURE__*/_jsxs(\"section\",{className:\"empires-info-section card\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Edit \",editEmpire]}),/*#__PURE__*/_jsx(EmpireEditPanel,{name:editEmpire,onCancel:()=>setEditEmpire(null)})]}):empirePage?/*#__PURE__*/_jsx(EmpirePanel,{name:empirePage,canEdit:account&&account.username===empirePage}):/*#__PURE__*/_jsxs(\"section\",{className:\"empires-info-section card\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',alignItems:'center',marginBottom:'1.5rem',gap:'0.3rem'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",style:{margin:0,textAlign:'center'},children:\"Empires Overview\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#aaa',fontSize:'1.05rem',fontWeight:500,textAlign:'center'},children:[\"Total Empires: \",/*#__PURE__*/_jsx(\"b\",{children:getEmpireNames().length})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"empires-info-list\",style:{display:'flex',flexWrap:'wrap',gap:'1.5rem',justifyContent:'flex-start'},children:getEmpireNames().map(e=>{const linkedAccount=getEmpireAccount(e);const canEdit=account&&(account.username===linkedAccount||account.username===\"GameMaster\");return/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-card empire-list-card\",style:{minWidth:260,maxWidth:340,flex:'1 1 320px',background:'var(--primary-bg)',border:'1.5px solid var(--accent)',borderRadius:12,boxShadow:'0 2px 12px #0002',padding:'1.2rem 1.2rem',display:'flex',flexDirection:'column',gap:'0.7rem',cursor:'pointer'},onClick:()=>setEmpirePage(e),children:[/*#__PURE__*/_jsx(\"h3\",{className:\"empire-info-title\",style:{margin:0,color:'var(--accent)',textAlign:'center'},children:e}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#b3cfff',fontWeight:500,fontSize:'1.05em',textAlign:'center',marginBottom:'0.5rem'},children:linkedAccount?/*#__PURE__*/_jsx(\"span\",{title:\"Assigned Account\",children:linkedAccount}):/*#__PURE__*/_jsx(\"i\",{children:\"Unassigned\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"empire-actions\",style:{display:'flex',gap:'0.5rem',marginTop:'0.5rem',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",style:{minWidth:80},onClick:ev=>{ev.stopPropagation();setEmpirePage(e);},children:\"View\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{minWidth:80},onClick:ev=>{ev.stopPropagation();setEditEmpire(e);},children:\"Edit\"})]})]},e);})})]}):/*#__PURE__*/_jsx(_Fragment,{children:!account?/*#__PURE__*/_jsxs(\"section\",{className:\"account-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"login-title\",children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"account-form login-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"login-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Empire name\",value:loginUser,onChange:e=>setLoginUser(e.target.value),required:true,disabled:!accountsLoaded,className:\"login-input\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:loginPass,onChange:e=>setLoginPass(e.target.value),required:true,disabled:!accountsLoaded,className:\"login-input\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!accountsLoaded,className:\"login-btn\",children:\"Login\"})]}),!accountsLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",children:\"Loading accounts...\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:error})]}):/*#__PURE__*/// Center the channels page\n_jsx(\"div\",{style:{display:'flex',justifyContent:'center',width:'100%'},children:/*#__PURE__*/_jsx(\"section\",{className:\"boards-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"channels-main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"channels-sidebar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"boards-list card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:account&&account.username===\"GameMaster\"?\"All Boards\":\"Your Diplomatic Channels\"}),/*#__PURE__*/_jsx(\"div\",{className:\"boards-list-header\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"boards-list-count\",children:[filteredBoards.length,\" \",filteredBoards.length===1?\"channel\":\"channels\"]})}),/*#__PURE__*/_jsxs(\"ul\",{className:\"boards-list-ul\",children:[filteredBoards.length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"no-channels\",children:\"No channels available.\"}),filteredBoards.map(_ref5=>{let[a,b]=_ref5;const key=a+'|'+b;return/*#__PURE__*/_jsx(\"li\",{className:`boards-list-item${selected===key?' active':''}`,children:/*#__PURE__*/_jsxs(\"button\",{className:\"board-btn\",onClick:()=>handleBoardSelect([a,b]),children:[/*#__PURE__*/_jsx(\"span\",{className:\"board-nations\",children:a}),/*#__PURE__*/_jsx(\"span\",{className:\"board-arrow\",children:\"\\u2194\"}),/*#__PURE__*/_jsx(\"span\",{className:\"board-nations\",children:b})]})},key);})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"channels-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"board-messages card\",children:selected&&filteredBoards.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"board-messages-inner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"board-title-row\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"board-title\",children:selected.replace('|',' ↔ ')})}),/*#__PURE__*/_jsxs(\"div\",{className:\"messages-panel\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messages-list-container\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"messages-list\",children:[(messages[selected]||[]).length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"no-messages\",children:\"No messages yet.\"}),(messages[selected]||[]).map((msg,i)=>{const[partnerA,partnerB]=selected.split('|');let partnerClass='';if(msg.author===partnerA)partnerClass='message-partnerA';else if(msg.author===partnerB)partnerClass='message-partnerB';return/*#__PURE__*/_jsxs(\"li\",{className:`message-item ${partnerClass}`,style:{display:'flex',alignItems:'stretch',justifyContent:'flex-start',gap:'0.7rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,minWidth:0,display:'flex',flexDirection:'column',gap:'0.15rem',justifyContent:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-meta\",style:{marginBottom:0},children:[/*#__PURE__*/_jsx(\"span\",{className:\"message-author\",children:msg.author}),/*#__PURE__*/_jsx(\"small\",{className:\"message-date\",children:new Date(msg.timestamp).toLocaleString()})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-text\",children:msg.text})]}),account&&account.username===\"GameMaster\"&&gmPermissions.canDeleteMessages&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',minWidth:'2.5em',paddingLeft:'0.5em'},children:/*#__PURE__*/_jsx(\"button\",{title:\"Delete message\",style:{background:'none',border:'none',color:'#ff4d4d',cursor:'pointer',fontSize:'1.3em',display:'flex',alignItems:'center',height:'2.2em'},onClick:e=>{e.stopPropagation();handleDeleteMessage(selected,i);},children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Delete\",children:\"\\uD83D\\uDDD1\"})})})]},i);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:postMessage,className:\"message-form message-form-bottom\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Your empire\",value:account.username,disabled:true,required:true,className:\"author-input\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Message\",value:text,onChange:e=>setText(e.target.value),required:true,className:\"text-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"send-btn\",children:\"Send\"})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-messages\",children:\"Select a channel to view messages.\"})})})]})})})})}),/*#__PURE__*/_jsx(\"footer\",{className:\"footer\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"Stellaris RP Board \\xA9 \",new Date().getFullYear()]})})]});}export default App;","map":{"version":3,"names":["renderEmpiresTab","_jsxs","className","style","maxWidth","margin","background","border","borderRadius","padding","children","display","gap","marginBottom","alignItems","_jsx","type","placeholder","value","empireSearch","onChange","e","setEmpireSearch","target","flex","empireSort","setEmpireSort","filteredEmpires","map","_empireInfo$e$name","borderLeft","fontWeight","fontSize","name","getEmpireAccount","empireInfo","lore","marginTop","onClick","setEmpirePage","renderTreatiesTab","treatySearch","setTreatySearch","setTreatyPage","treatySort","setTreatySort","paginatedTreaties","t","_t$participants","TREATY_STATUS_COLORS","status","title","color","owner","participants","join","handleViewTreaty","canEditTreaty","marginLeft","handleEditTreaty","id","justifyContent","Array","from","length","treatyPages","_","i","treatyPage","TreatyView","_ref","_treaty$participants","treaty","onBack","onEdit","onTransfer","canEdit","canTransfer","accounts","statuses","discussion","active","broken","expired","other","whiteSpace","content","minWidth","showMenu","setShowMenu","useState","showPermissions","setShowPermissions","gmPermissions","setGmPermissions","saved","localStorage","getItem","JSON","parse","canDeleteMessages","useEffect","setItem","stringify","handleMenuToggle","v","handleMenuClose","menuDropdownRef","useRef","permissionsDropdownRef","handleMouseMove","current","contains","document","addEventListener","removeEventListener","handlePermissionsToggle","handlePermissionChange","key","prev","handleShowAbout","alert","handleShowTheme","activeTab","editEmpire","empirePage","fetch","Date","now","then","res","json","data","setEmpireInfo","setEmpireInfoLoaded","catch","getEmpireNames","empires","getLinkedBoards","names","getNationPairs","empireName","emp","find","account","filteredBoards","username","filter","_ref2","a","b","handleLinkAccount","accountName","method","headers","body","success","setEmpires","handleUnlinkAccount","handleBoardSelect","pair","setSelected","selected","pollingRef","clearInterval","fetchMessages","encodeURIComponent","ok","Error","setMessages","err","console","error","setInterval","prevMessagesLengthRef","currentMessages","messages","messagesEndRef","scrollIntoView","behavior","postMessage","preventDefault","text","trim","msg","board","author","timestamp","setText","setAccounts","setAccountsLoaded","isArray","setTreaties","setTreatiesLoaded","handleLogin","accountsLoaded","setError","loginUser","password","loginPass","setAccount","handleLogout","removeItem","saveEmpireInfo","info","EmpireEditPanel","_ref3","onCancel","edit","setEdit","handleChange","handleSave","onSubmit","rows","stats","ethics","civics","special","EmpirePanel","_ref4","boxShadow","flexDirection","textAlign","setEditEmpire","handleCreateAccount","setAccountError","setAccountSuccess","newAccountName","pass","newAccountPass","setAccountsTabLoading","setNewAccountName","setNewAccountPass","finally","handleRenameAccount","setEditAccountError","setEditAccountLoading","oldName","editAccount","newName","editAccountName","updated","setEditAccount","handleChangePassword","editAccountPass","handleDeleteAccount","window","confirm","handleCreateEmpire","setNewEmpireError","setNewEmpireLoading","newEmpireName","some","setNewEmpireName","handleDeleteEmpire","split","canTransferTreaty","handleAddTreaty","setTreatyDialog","open","mode","setTreatyError","handleCancelTreatyForm","handleSaveTreaty","setTreatySaving","isEdit","treatyEditId","form","treatyForm","toString","data2","setTreatyForm","setTreatyEditId","setShowTreatyForm","setTreatyViewId","handleTransferTreatyOwner","newOwner","handleTreatyFormChange","options","vals","o","f","renderTreatyForm","required","disabled","treatySaving","TREATY_STATUSES","s","label","multiple","Object","keys","acc","treatyError","renderTreatyView","statusObj","showAccountsTab","tabs","push","accountEditPanelRef","block","handleDeleteMessage","boardKey","msgIdx","index","Number","tab","setActiveTab","ref","checked","openTreatyDialog","treatyDialog","TreatyDialog","onSave","handleTreatySave","onClose","closeTreatyDialog","saving","handleTreatyTransferOwner","treatiesLoaded","treaties","_treaty$participants2","slice","ev","stopPropagation","newEmpireLoading","newEmpireError","val","accName","accountsTabLoading","accountError","accountSuccess","setEditAccountName","setEditAccountPass","editAccountLoading","editAccountError","flexWrap","linkedAccount","cursor","_Fragment","setLoginUser","setLoginPass","width","_ref5","replace","partnerA","partnerB","partnerClass","toLocaleString","paddingLeft","height","role","getFullYear","App"],"sources":["C:/Users/Admin/Dokumente/Stellaris/project/StellarisRP-Site/src/App.js"],"sourcesContent":["    // --- QoL: Render Empires search/filter/sort ---\r\n    function renderEmpiresTab() {\r\n        return (\r\n            <div className=\"empires-tab card\" style={{maxWidth: 700, margin: '2rem auto', background: 'var(--card-bg)', border: '1px solid var(--accent)', borderRadius: 12, padding: '2rem'}}>\r\n                <div style={{display: 'flex', gap: '1rem', marginBottom: '1.2rem', alignItems: 'center'}}>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search empires...\"\r\n                        value={empireSearch}\r\n                        onChange={e => setEmpireSearch(e.target.value)}\r\n                        style={{flex: 1, padding: '0.6em', borderRadius: 8, border: '1px solid var(--accent)'}}\r\n                    />\r\n                    <select value={empireSort} onChange={e => setEmpireSort(e.target.value)} style={{padding: '0.6em', borderRadius: 8, border: '1px solid var(--accent)'}}>\r\n                        <option value=\"name\">Sort by Name</option>\r\n                        <option value=\"owner\">Sort by Owner</option>\r\n                    </select>\r\n                </div>\r\n                <div>\r\n                    {filteredEmpires.map(e => (\r\n                        <div key={e.name} className=\"empire-list-item card\" style={{marginBottom: 12, padding: '1rem', borderLeft: '6px solid #b3cfff'}}>\r\n                            <div style={{fontWeight: 600, fontSize: '1.15em'}}>{e.name}</div>\r\n                            <div>Owner: {getEmpireAccount(e.name) || <i>Unassigned</i>}</div>\r\n                            <div>Lore: {empireInfo[e.name]?.lore || <i>No lore</i>}</div>\r\n                            <button className=\"empire-save-btn\" style={{marginTop: 6}} onClick={() => setEmpirePage(e.name)}>View</button>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        );\r\n    // --- QoL: Render Treaty search/filter/sort/pagination ---\r\n    function renderTreatiesTab() {\r\n        return (\r\n            <div className=\"treaties-tab card\" style={{maxWidth: 700, margin: '2rem auto', background: 'var(--card-bg)', border: '1px solid var(--accent)', borderRadius: 12, padding: '2rem'}}>\r\n                <div style={{display: 'flex', gap: '1rem', marginBottom: '1.2rem', alignItems: 'center'}}>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search treaties...\"\r\n                        value={treatySearch}\r\n                        onChange={e => { setTreatySearch(e.target.value); setTreatyPage(1); }}\r\n                        style={{flex: 1, padding: '0.6em', borderRadius: 8, border: '1px solid var(--accent)'}}\r\n                    />\r\n                    <select value={treatySort} onChange={e => setTreatySort(e.target.value)} style={{padding: '0.6em', borderRadius: 8, border: '1px solid var(--accent)'}}>\r\n                        <option value=\"title\">Sort by Title</option>\r\n                        <option value=\"owner\">Sort by Owner</option>\r\n                        <option value=\"status\">Sort by Status</option>\r\n                    </select>\r\n                </div>\r\n                <div>\r\n                    {paginatedTreaties.map(t => (\r\n                        <div key={t.id} className=\"treaty-list-item card\" style={{marginBottom: 12, padding: '1rem', borderLeft: `6px solid ${TREATY_STATUS_COLORS[t.status] || '#aaa'}`}}>\r\n                            <div style={{fontWeight: 600, fontSize: '1.15em'}}>{t.title}</div>\r\n                            <div style={{color: TREATY_STATUS_COLORS[t.status] || '#aaa'}}>{t.status}</div>\r\n                            <div>Owner: {t.owner}</div>\r\n                            <div>Participants: {t.participants?.join(', ') || <i>None</i>}</div>\r\n                            <button className=\"empire-save-btn\" style={{marginTop: 6}} onClick={() => handleViewTreaty(t)}>View</button>\r\n                            {canEditTreaty(t) && <button className=\"empire-back-btn\" style={{marginLeft: 8}} onClick={() => handleEditTreaty(t)}>Edit</button>}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n                <div style={{marginTop: 18, display: 'flex', gap: 8, justifyContent: 'center'}}>\r\n                    {Array.from({ length: treatyPages }, (_, i) => (\r\n                        <button key={i} className={i + 1 === treatyPage ? 'empire-save-btn' : 'empire-back-btn'} onClick={() => setTreatyPage(i + 1)}>{i + 1}</button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    // --- Treaty View UI ---\r\n    function TreatyView({ treaty, onBack, onEdit, onTransfer, canEdit, canTransfer, accounts }) {\r\n        if (!treaty) return null;\r\n        const statuses = {\r\n            discussion: '🗨️ In Discussion',\r\n            active: '✅ Active',\r\n            broken: '❌ Broken',\r\n            expired: '⌛ Expired',\r\n            other: '❓ Other'\r\n        };\r\n        return (\r\n            <div className=\"treaty-dialog-overlay\">\r\n                <div className=\"treaty-dialog\">\r\n                    <h2>{treaty.title}</h2>\r\n                    <div><b>Status:</b> {statuses[treaty.status] || treaty.status}</div>\r\n                    <div><b>Owner:</b> {treaty.owner}</div>\r\n                    <div><b>Participants:</b> {treaty.participants?.join(', ') || <i>None</i>}</div>\r\n                    <div style={{margin: '1em 0', whiteSpace: 'pre-line'}}>{treaty.content}</div>\r\n                    <div className=\"treaty-form-actions\">\r\n                        <button className=\"empire-back-btn\" style={{minWidth: 110, maxWidth: 160}} onClick={onBack}>Back</button>\r\n                        {canEdit && <button className=\"empire-save-btn\" style={{minWidth: 110, maxWidth: 160}} onClick={onEdit}>Edit</button>}\r\n                        {/* The owner transfer dropdown is intentionally removed from view mode */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- NEW: Permissions state for GameMaster ---\r\n    const [showMenu, setShowMenu] = useState(false);\r\n    const [showPermissions, setShowPermissions] = useState(false);\r\n    const [gmPermissions, setGmPermissions] = useState(() => {\r\n        // Persist in localStorage\r\n        const saved = localStorage.getItem('stellarisGmPermissions');\r\n        return saved ? JSON.parse(saved) : { canDeleteMessages: true };\r\n    });\r\n\r\n    // Save GM permissions to localStorage\r\n    useEffect(() => {\r\n        localStorage.setItem('stellarisGmPermissions', JSON.stringify(gmPermissions));\r\n    }, [gmPermissions]);\r\n\r\n    // --- NEW: Menu handlers ---\r\n    function handleMenuToggle() {\r\n        setShowMenu(v => !v);\r\n        setShowPermissions(false);\r\n    }\r\n    function handleMenuClose() {\r\n        setShowMenu(false);\r\n        setShowPermissions(false);\r\n    }\r\n    // Keep menu open when hovering either dropdown or permissions\r\n    const menuDropdownRef = useRef(null);\r\n    const permissionsDropdownRef = useRef(null);\r\n\r\n    // Close menu only if mouse leaves both dropdowns\r\n    useEffect(() => {\r\n        if (!showMenu && !showPermissions) return;\r\n        function handleMouseMove(e) {\r\n            if (\r\n                menuDropdownRef.current &&\r\n                permissionsDropdownRef.current &&\r\n                !menuDropdownRef.current.contains(e.target) &&\r\n                !permissionsDropdownRef.current.contains(e.target)\r\n            ) {\r\n                setShowMenu(false);\r\n                setShowPermissions(false);\r\n            }\r\n        }\r\n        document.addEventListener('mousedown', handleMouseMove);\r\n        return () => document.removeEventListener('mousedown', handleMouseMove);\r\n    }, [showMenu, showPermissions]);\r\n    function handlePermissionsToggle() {\r\n        setShowPermissions(v => !v);\r\n    }\r\n    function handlePermissionChange(key, value) {\r\n        setGmPermissions(prev => ({ ...prev, [key]: value }));\r\n    }\r\n\r\n    // --- NEW: Other menu options ---\r\n    function handleShowAbout() {\r\n        alert(\"Stellaris RP Board\\n\\nCreated for roleplay and diplomacy.\\n\\nContact: admin@example.com\");\r\n        handleMenuClose();\r\n    }\r\n    function handleShowTheme() {\r\n        alert(\"Theme switcher coming soon!\");\r\n        handleMenuClose();\r\n    }\r\n\r\n    // Only load empireInfo when switching to the Empires tab and not viewing/editing any empire.\r\n    // This prevents any reloads while editing or viewing an empire.\r\n    useEffect(() => {\r\n        if (\r\n            activeTab === 'empires' &&\r\n            !editEmpire &&\r\n            !empirePage\r\n        ) {\r\n            // Add cache-busting query param\r\n            fetch(`/empireInfo.json?ts=${Date.now()}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setEmpireInfo(data && typeof data === 'object' ? data : {});\r\n                    setEmpireInfoLoaded(true);\r\n                })\r\n                .catch(() => setEmpireInfoLoaded(true));\r\n        }\r\n    // Only run when switching tabs, or leaving view/edit mode\r\n    }, [activeTab, editEmpire, empirePage]);\r\n\r\n    // Helper: get empire names\r\n    function getEmpireNames() {\r\n        // Only include empires that exist (already the case)\r\n        return empires.map(e => e.name);\r\n    }\r\n\r\n    // Helper: get boards from linked empires\r\n    function getLinkedBoards() {\r\n        const names = getEmpireNames();\r\n        return getNationPairs(names);\r\n    }\r\n\r\n    // Helper: get account linked to empire\r\n    function getEmpireAccount(empireName) {\r\n        const emp = empires.find(e => e.name === empireName);\r\n        return emp && emp.account ? emp.account : null;\r\n    }\r\n\r\n    // Only show boards for the empire assigned to the logged-in account, except GameMaster sees all\r\n    const filteredBoards = account\r\n        ? account.username === \"GameMaster\"\r\n            ? getLinkedBoards()\r\n            : getLinkedBoards().filter(([a, b]) =>\r\n                getEmpireAccount(a) === account.username || getEmpireAccount(b) === account.username\r\n            )\r\n        : [];\r\n\r\n    // GameMaster: link/unlink accounts to empires\r\n    function handleLinkAccount(empireName, accountName) {\r\n        fetch('/api/empires/link', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ empireName, accountName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev =>\r\n                    prev.map(e => e.name === empireName ? { ...e, account: accountName } : e)\r\n                );\r\n            }\r\n        });\r\n    }\r\n    function handleUnlinkAccount(empireName) {\r\n        fetch('/api/empires/unlink', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ empireName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev =>\r\n                    prev.map(e => e.name === empireName ? { ...e, account: null } : e)\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    // Save selected board to localStorage\r\n    function handleBoardSelect(pair) {\r\n        const key = pair.join('|');\r\n        setSelected(key);\r\n        localStorage.setItem('stellarisSelectedBoard', key);\r\n    }\r\n\r\n    // Fetch messages for the selected board from the server\r\n    useEffect(() => {\r\n        // Only poll messages if on channels tab and not editing/viewing empire\r\n        if (\r\n            !selected ||\r\n            activeTab !== 'channels' ||\r\n            editEmpire ||\r\n            empirePage\r\n        ) {\r\n            // Stop polling if not in correct state\r\n            if (pollingRef.current) {\r\n                clearInterval(pollingRef.current);\r\n                pollingRef.current = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Use selected as key\r\n        const key = selected;\r\n\r\n        // Function to fetch messages\r\n        const fetchMessages = () => {\r\n            fetch(`/api/messages?board=${encodeURIComponent(key)}`)\r\n                .then(res => {\r\n                    if (!res.ok) throw new Error('Network response was not ok');\r\n                    return res.json();\r\n                })\r\n                .then(data => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [key]: data\r\n                    }));\r\n                })\r\n                .catch((err) => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [key]: []\r\n                    }));\r\n                    console.error('Failed to fetch messages:', err);\r\n                });\r\n        };\r\n\r\n        // Initial fetch\r\n        fetchMessages();\r\n\r\n        // Set up polling\r\n        pollingRef.current = setInterval(fetchMessages, 2000);\r\n\r\n        // Cleanup on unmount or when selected/activeTab/editEmpire/empirePage changes\r\n        return () => {\r\n            if (pollingRef.current) {\r\n                clearInterval(pollingRef.current);\r\n                pollingRef.current = null;\r\n            }\r\n        };\r\n    }, [selected, activeTab, editEmpire, empirePage]);\r\n\r\n    // Scroll to bottom only when messages actually change for the selected board\r\n    const prevMessagesLengthRef = useRef(0);\r\n    useEffect(() => {\r\n        if (!selected) return;\r\n        const currentMessages = messages[selected] || [];\r\n        if (currentMessages.length !== prevMessagesLengthRef.current) {\r\n            if (messagesEndRef.current) {\r\n                messagesEndRef.current.scrollIntoView({ behavior: 'auto' });\r\n            }\r\n            prevMessagesLengthRef.current = currentMessages.length;\r\n        }\r\n    }, [messages, selected]);\r\n\r\n    // When posting, always use the logged-in account's empire name\r\n    function postMessage(e) {\r\n        e.preventDefault();\r\n        if (!selected || !account || !text.trim()) return;\r\n        const key = selected;\r\n        const msg = {\r\n            board: key,\r\n            author: account.username,\r\n            text,\r\n            timestamp: Date.now()\r\n        };\r\n        fetch('/api/messages', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(msg)\r\n        })\r\n        .then(res => res.json())\r\n        .then(() => {\r\n            fetch(`/api/messages?board=${encodeURIComponent(key)}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [key]: data\r\n                    }));\r\n                });\r\n        });\r\n        setText('');\r\n    }\r\n\r\n    // Fetch accounts from server (accounts.json)\r\n    useEffect(() => {\r\n        fetch('/accounts.json')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setAccounts(data);\r\n                setAccountsLoaded(true);\r\n            })\r\n            .catch(() => setAccountsLoaded(true));\r\n    }, []);\r\n\r\n    // Load empires from empires.json\r\n    useEffect(() => {\r\n        fetch('/empires.json')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setEmpires(Array.isArray(data) ? data : []);\r\n            });\r\n    }, []);\r\n\r\n    // Fetch treaties from backend\r\n    useEffect(() => {\r\n        fetch('/treaties.json')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setTreaties(Array.isArray(data) ? data : []);\r\n                setTreatiesLoaded(true);\r\n            })\r\n            .catch(() => setTreatiesLoaded(true));\r\n    }, []);\r\n\r\n    function handleLogin(e) {\r\n        e.preventDefault();\r\n        // Wait until accounts are loaded\r\n        if (!accountsLoaded) {\r\n            setError('Accounts are still loading, please wait...');\r\n            return;\r\n        }\r\n        const username = loginUser.trim();\r\n        const password = loginPass.trim();\r\n        if (!accounts[username]) {\r\n            setError('Invalid credentials');\r\n            return;\r\n        }\r\n        if (accounts[username] !== password) {\r\n            setError('Invalid credentials');\r\n            return;\r\n        }\r\n        setAccount({ username });\r\n        localStorage.setItem('stellarisAccount', JSON.stringify({ username }));\r\n        setError('');\r\n    }\r\n\r\n    function handleLogout() {\r\n        setAccount(null);\r\n        localStorage.removeItem('stellarisAccount');\r\n    }\r\n\r\n    // Save empire info to backend and update local state\r\n    function saveEmpireInfo(name, info) {\r\n        return fetch('/api/empireInfo', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, info })\r\n        })\r\n        .then(res => res.json())\r\n        .then(() => {\r\n            // After saving, reload from backend with cache-busting param\r\n            return fetch(`/empireInfo.json?ts=${Date.now()}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setEmpireInfo(data && typeof data === 'object' ? data : {});\r\n                });\r\n        });\r\n    }\r\n\r\n    // Edit panel for empire info\r\n    function EmpireEditPanel({ name, onCancel }) {\r\n        // Only initialize edit state from empireInfo[name] when the component mounts\r\n        const info = empireInfo[name] || {};\r\n        const [edit, setEdit] = useState(info);\r\n\r\n        // Do NOT use useEffect to update edit state from empireInfo.\r\n        // This ensures the text fields are not reset while editing.\r\n\r\n        function handleChange(e) {\r\n            setEdit({ ...edit, [e.target.name]: e.target.value });\r\n        }\r\n        function handleSave(e) {\r\n            e.preventDefault();\r\n            saveEmpireInfo(name, edit).then(() => {\r\n                onCancel();\r\n            });\r\n        }\r\n\r\n        return (\r\n            <form className=\"empire-edit-form\" onSubmit={handleSave}>\r\n                <label>\r\n                    Lore:\r\n                    <textarea\r\n                        name=\"lore\"\r\n                        value={edit.lore || ''}\r\n                        onChange={handleChange}\r\n                        rows={3}\r\n                    />\r\n                </label>\r\n                <label>\r\n                    Stats:\r\n                    <input name=\"stats\" value={edit.stats || ''} onChange={handleChange} />\r\n                </label>\r\n                <label>\r\n                    Ethics:\r\n                    <input name=\"ethics\" value={edit.ethics || ''} onChange={handleChange} />\r\n                </label>\r\n                <label>\r\n                    Civics:\r\n                    <input name=\"civics\" value={edit.civics || ''} onChange={handleChange} />\r\n                </label>\r\n                <label>\r\n                    Special Info:\r\n                    <input name=\"special\" value={edit.special || ''} onChange={handleChange} />\r\n                </label>\r\n                <div style={{display: 'flex', gap: '1rem', marginTop: '1rem'}}>\r\n                    <button type=\"submit\" className=\"empire-save-btn\">Save</button>\r\n                    <button type=\"button\" className=\"empire-back-btn\" onClick={onCancel}>Cancel</button>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    // View panel for empire info\r\n    function EmpirePanel({ name, canEdit }) {\r\n        const info = empireInfo[name] || {};\r\n        return (\r\n            <div\r\n                className=\"empire-info-card empire-info-page\"\r\n                style={{\r\n                    maxWidth: 420,\r\n                    margin: '2rem auto',\r\n                    background: 'var(--card-bg)',\r\n                    border: '1.5px solid var(--accent)',\r\n                    borderRadius: 14,\r\n                    boxShadow: '0 2px 16px #0002',\r\n                    padding: '2rem 2rem',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'stretch',\r\n                    gap: '1rem'\r\n                }}\r\n            >\r\n                <h2 className=\"empire-info-title\" style={{marginBottom: 0}}>{name}</h2>\r\n                <div style={{color: '#b3cfff', fontWeight: 500, marginBottom: '1.2rem', fontSize: '1.08em', textAlign: 'center'}}>\r\n                    Owner: <span style={{color: '#fff'}}>{getEmpireAccount(name) || <i>Unassigned</i>}</span>\r\n                </div>\r\n                <div className=\"empire-info-details\">\r\n                    <div><b>Lore:</b> <div className=\"empire-info-field\">{info.lore || <i>No lore set.</i>}</div></div>\r\n                    <div><b>Stats:</b> <div className=\"empire-info-field\">{info.stats || <i>No stats set.</i>}</div></div>\r\n                    <div><b>Ethics:</b> <div className=\"empire-info-field\">{info.ethics || <i>No ethics set.</i>}</div></div>\r\n                    <div><b>Civics:</b> <div className=\"empire-info-field\">{info.civics || <i>No civics set.</i>}</div></div>\r\n                    <div><b>Special Info:</b> <div className=\"empire-info-field\">{info.special || <i>No special info set.</i>}</div></div>\r\n                </div>\r\n                <div style={{display: 'flex', gap: '1rem', marginTop: '1.5rem', justifyContent: 'center'}}>\r\n                    <button className=\"empire-back-btn\" onClick={() => setEmpirePage(null)}>Back to Empires</button>\r\n                    {canEdit && (\r\n                        <button className=\"empire-save-btn\" onClick={() => setEditEmpire(name)}>Edit</button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Defensive: ensure empireInfo is always an object\r\n    useEffect(() => {\r\n        if (!empireInfo || typeof empireInfo !== 'object' || Array.isArray(empireInfo)) {\r\n            setEmpireInfo({});\r\n        }\r\n    }, [empireInfo]);\r\n\r\n    // Defensive: ensure accounts is always an object\r\n    useEffect(() => {\r\n        if (!accounts || typeof accounts !== 'object' || Array.isArray(accounts)) {\r\n            setAccounts({});\r\n        }\r\n    }, [accounts]);\r\n\r\n    // Add API to create new account\r\n    function handleCreateAccount(e) {\r\n        e.preventDefault();\r\n        setAccountError('');\r\n        setAccountSuccess('');\r\n        const name = newAccountName.trim();\r\n        const pass = newAccountPass.trim();\r\n        if (!name || !pass) {\r\n            setAccountError('Name and password required');\r\n            return;\r\n        }\r\n        if (accounts[name]) {\r\n            setAccountError('Account already exists');\r\n            return;\r\n        }\r\n        setAccountsTabLoading(true);\r\n        fetch('/api/accounts', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, pass })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setAccounts(prev => ({ ...prev, [name]: pass }));\r\n                // Remove: setEmpires(prev => prev.includes(name) ? prev : [...prev, name]);\r\n                setAccountSuccess('Account created');\r\n                setNewAccountName('');\r\n                setNewAccountPass('');\r\n            } else {\r\n                setAccountError(data.error || 'Failed to create account');\r\n            }\r\n        })\r\n        .catch(() => setAccountError('Failed to create account'))\r\n        .finally(() => setAccountsTabLoading(false));\r\n    }\r\n\r\n    // API: Rename account\r\n    function handleRenameAccount(e) {\r\n        e.preventDefault();\r\n        setEditAccountError('');\r\n        setEditAccountLoading(true);\r\n        const oldName = editAccount;\r\n        const newName = editAccountName.trim();\r\n        if (!newName || newName === oldName) {\r\n            setEditAccountError('Enter a new name');\r\n            setEditAccountLoading(false);\r\n            return;\r\n        }\r\n        fetch('/api/accounts/rename', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ oldName, newName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                // Update local state\r\n                setAccounts(prev => {\r\n                    const updated = { ...prev };\r\n                    updated[newName] = updated[oldName];\r\n                    delete updated[oldName];\r\n                    return updated;\r\n                });\r\n                setEmpires(prev => prev.map(e => e === oldName ? newName : e));\r\n                setEditAccount(null);\r\n            } else {\r\n                setEditAccountError(data.error || 'Rename failed');\r\n            }\r\n        })\r\n        .catch(() => setEditAccountError('Rename failed'))\r\n        .finally(() => setEditAccountLoading(false));\r\n    }\r\n\r\n    // API: Change password\r\n    function handleChangePassword(e) {\r\n        e.preventDefault();\r\n        setEditAccountError('');\r\n        setEditAccountLoading(true);\r\n        const name = editAccount;\r\n        const pass = editAccountPass.trim();\r\n        if (!pass) {\r\n            setEditAccountError('Enter a new password');\r\n            setEditAccountLoading(false);\r\n            return;\r\n        }\r\n        fetch('/api/accounts/password', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, pass })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setAccounts(prev => ({ ...prev, [name]: pass }));\r\n                setEditAccount(null);\r\n            } else {\r\n                setEditAccountError(data.error || 'Password change failed');\r\n            }\r\n        })\r\n        .catch(() => setEditAccountError('Password change failed'))\r\n        .finally(() => setEditAccountLoading(false));\r\n    }\r\n\r\n    // API: Delete account\r\n    function handleDeleteAccount(name) {\r\n        if (!window.confirm(`Delete account \"${name}\"? This cannot be undone.`)) return;\r\n        setEditAccountLoading(true);\r\n        fetch('/api/accounts/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setAccounts(prev => {\r\n                    const updated = { ...prev };\r\n                    delete updated[name];\r\n                    return updated;\r\n                });\r\n                setEmpires(prev => prev.filter(e => e !== name));\r\n                setEditAccount(null);\r\n            } else {\r\n                alert(data.error || 'Delete failed');\r\n            }\r\n        })\r\n        .catch(() => alert('Delete failed'))\r\n        .finally(() => setEditAccountLoading(false));\r\n    }\r\n\r\n    // API: Create new empire\r\n    function handleCreateEmpire(e) {\r\n        e.preventDefault();\r\n        setNewEmpireError('');\r\n        setNewEmpireLoading(true);\r\n        const name = newEmpireName.trim();\r\n        if (!name) {\r\n            setNewEmpireError('Empire name required');\r\n            setNewEmpireLoading(false);\r\n            return;\r\n        }\r\n        if (empires.some(e => e.name === name)) {\r\n            setNewEmpireError('Empire already exists');\r\n            setNewEmpireLoading(false);\r\n            return;\r\n        }\r\n        fetch('/api/empires/create', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev => [...prev, { name, account: null }]);\r\n                setNewEmpireName('');\r\n            } else {\r\n                setNewEmpireError(data.error || 'Failed to create empire');\r\n            }\r\n        })\r\n        .catch(() => setNewEmpireError('Failed to create empire'))\r\n        .finally(() => setNewEmpireLoading(false));\r\n    }\r\n\r\n    // API: Delete empire\r\n    function handleDeleteEmpire(name) {\r\n        if (!window.confirm(`Delete empire \"${name}\"? This cannot be undone.`)) return;\r\n        setNewEmpireLoading(true);\r\n        fetch('/api/empires/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev => {\r\n                    const updated = prev.filter(e => e.name !== name);\r\n                    // If the selected board involves the deleted empire, clear selection\r\n                    if (selected) {\r\n                        const [a, b] = selected.split('|');\r\n                        if (a === name || b === name) {\r\n                            setSelected(null);\r\n                            localStorage.removeItem('stellarisSelectedBoard');\r\n                        }\r\n                    }\r\n                    return updated;\r\n                });\r\n            } else {\r\n                setNewEmpireError(data.error || 'Failed to delete empire');\r\n            }\r\n        })\r\n        .catch(() => setNewEmpireError('Failed to delete empire'))\r\n        .finally(() => setNewEmpireLoading(false));\r\n    }\r\n\r\n    // Treaties: permissions\r\n    function canEditTreaty(treaty) {\r\n        if (!account) return false;\r\n        return account.username === treaty.owner || account.username === \"GameMaster\";\r\n    }\r\n    function canTransferTreaty(treaty) {\r\n        return account && account.username === \"GameMaster\";\r\n    }\r\n\r\n    // Treaties: open new form\r\n    function handleAddTreaty() {\r\n        setTreatyDialog({\r\n            open: true,\r\n            mode: 'new',\r\n            data: null\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: open edit\r\n    function handleEditTreaty(treaty) {\r\n        setTreatyDialog({\r\n            open: true,\r\n            mode: 'edit',\r\n            data: treaty\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: open view\r\n    function handleViewTreaty(treaty) {\r\n        setTreatyDialog({\r\n            open: true,\r\n            mode: 'view',\r\n            data: treaty\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: cancel form\r\n    function handleCancelTreatyForm() {\r\n        setTreatyDialog({\r\n            open: false,\r\n            mode: null,\r\n            data: null\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: save (create or update)\r\n    function handleSaveTreaty(e) {\r\n        e.preventDefault();\r\n        setTreatyError('');\r\n        setTreatySaving(true);\r\n        const isEdit = treatyEditId != null;\r\n        const form = { ...treatyForm };\r\n        if (!form.title.trim() || !form.content.trim() || !form.participants.length) {\r\n            setTreatyError('Title, content, and at least one participant are required.');\r\n            setTreatySaving(false);\r\n            return;\r\n        }\r\n        if (!form.owner) form.owner = account ? account.username : '';\r\n        if (!form.status) form.status = 'discussion';\r\n        if (!form.id) form.id = isEdit ? treatyEditId : Date.now().toString();\r\n\r\n        fetch('/api/treaties', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(form)\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                // Always fetch the latest treaties from /treaties.json after save\r\n                return fetch('/treaties.json?ts=' + Date.now())\r\n                    .then(res => res.json())\r\n                    .then(data2 => {\r\n                        setTreaties(Array.isArray(data2) ? data2 : []);\r\n                        setTreatyForm(null);\r\n                        setTreatyEditId(null);\r\n                        setShowTreatyForm(false);\r\n                        setTreatyViewId(form.id);\r\n                    });\r\n            } else {\r\n                setTreatyError(data.error || 'Failed to save treaty');\r\n            }\r\n        })\r\n        .catch(() => setTreatyError('Failed to save treaty'))\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n\r\n    // Treaties: transfer ownership (GM only)\r\n    function handleTransferTreatyOwner(treaty, newOwner) {\r\n        if (!canTransferTreaty(treaty)) return;\r\n        setTreatySaving(true);\r\n        fetch('/api/treaties/transfer', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ id: treaty.id, newOwner })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                return fetch('/treaties.json')\r\n                    .then(res => res.json())\r\n                    .then(data2 => setTreaties(Array.isArray(data2) ? data2 : []));\r\n            }\r\n        })\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n\r\n    // Treaties: form field change\r\n    function handleTreatyFormChange(e) {\r\n        const { name, value, type, options } = e.target;\r\n        if (type === 'select-multiple') {\r\n            const vals = Array.from(options).filter(o => o.selected).map(o => o.value);\r\n            setTreatyForm(f => ({ ...f, [name]: vals }));\r\n        } else {\r\n            setTreatyForm(f => ({ ...f, [name]: value }));\r\n        }\r\n    }\r\n\r\n    // Treaties: render\r\n    function renderTreatyForm() {\r\n        if (!treatyForm) return null;\r\n        return (\r\n            <form className=\"treaty-form card\" onSubmit={handleSaveTreaty}>\r\n                <div className=\"treaty-form-header\">\r\n                    <input\r\n                        name=\"title\"\r\n                        placeholder=\"Treaty Title\"\r\n                        value={treatyForm.title}\r\n                        onChange={handleTreatyFormChange}\r\n                        className=\"login-input\"\r\n                        required\r\n                        disabled={treatySaving}\r\n                    />\r\n                    <select\r\n                        name=\"status\"\r\n                        value={treatyForm.status}\r\n                        onChange={handleTreatyFormChange}\r\n                        className=\"login-input\"\r\n                        disabled={treatySaving}\r\n                    >\r\n                        {TREATY_STATUSES.map(s => (\r\n                            <option key={s.value} value={s.value}>{s.label}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n                <div className=\"treaty-form-participants\">\r\n                    <div className=\"participants-select\">\r\n                        <label className=\"participants-label\">Participants</label>\r\n                        <select\r\n                            name=\"participants\"\r\n                            value={treatyForm.participants}\r\n                            onChange={handleTreatyFormChange}\r\n                            className=\"login-input\"\r\n                            multiple\r\n                            disabled={treatySaving}\r\n                        >\r\n                            {getEmpireNames().map(e => (\r\n                                <option key={e} value={e}>{e}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    {account && account.username === \"GameMaster\" && (\r\n                        <div className=\"owner-select\">\r\n                            <label className=\"owner-label\">Owner:</label>\r\n                            <select\r\n                                name=\"owner\"\r\n                                value={treatyForm.owner}\r\n                                onChange={handleTreatyFormChange}\r\n                                className=\"login-input\"\r\n                                disabled={treatySaving}\r\n                            >\r\n                                {Object.keys(accounts).map(acc => (\r\n                                    <option key={acc} value={acc}>{acc}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                <label className=\"treaty-content-label\">Treaty Content</label>\r\n                <textarea\r\n                    name=\"content\"\r\n                    placeholder=\"Treaty Content\"\r\n                    value={treatyForm.content}\r\n                    onChange={handleTreatyFormChange}\r\n                    className=\"login-input\"\r\n                    rows={9}\r\n                    required\r\n                    disabled={treatySaving}\r\n                />\r\n                <div className=\"treaty-form-actions\">\r\n                    <button type=\"submit\" className=\"empire-save-btn\" disabled={treatySaving}>\r\n                        {treatyEditId ? \"Save Changes\" : \"Create Treaty\"}\r\n                    </button>\r\n                    <button type=\"button\" className=\"empire-back-btn\" onClick={handleCancelTreatyForm} disabled={treatySaving}>Cancel</button>\r\n                    {treatyError && <div className=\"login-error treaty-error\">{treatyError}</div>}\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    function renderTreatyView(treaty) {\r\n        const statusObj = TREATY_STATUSES.find(s => s.value === treaty.status);\r\n        return (\r\n            <div className=\"treaty-view card\">\r\n                <div className=\"treaty-view-header\">\r\n                    <h2 className=\"treaty-title\">{treaty.title}</h2>\r\n                    <span className=\"treaty-status\" style={{color: statusObj.color}}>{statusObj ? statusObj.label : treaty.status}</span>\r\n                </div>\r\n                <div className=\"treaty-view-owner\">\r\n                    Owner: {treaty.owner}\r\n                </div>\r\n                <div className=\"treaty-view-participants\">\r\n                    <b>Participants:</b> {treaty.participants && treaty.participants.length > 0 ? treaty.participants.join(', ') : <i>None</i>}\r\n                </div>\r\n                <div className=\"treaty-content-static\">\r\n                    {treaty.content}\r\n                </div>\r\n                <div className=\"treaty-view-actions\">\r\n                    <button className=\"empire-back-btn\" onClick={() => setTreatyViewId(null)}>Back</button>\r\n                    {canEditTreaty(treaty) && (\r\n                        <button className=\"empire-save-btn\" onClick={() => handleEditTreaty(treaty)}>Edit</button>\r\n                    )}\r\n                    {canTransferTreaty(treaty) && (\r\n                        <select\r\n                            value={treaty.owner}\r\n                            onChange={e => handleTransferTreatyOwner(treaty, e.target.value)}\r\n                            className=\"owner-transfer-select\"\r\n                        >\r\n                            {Object.keys(accounts).map(acc => (\r\n                                <option key={acc} value={acc}>{acc}</option>\r\n                            ))}\r\n                        </select>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Add tab for GameMaster\r\n    const showAccountsTab = account && account.username === \"GameMaster\";\r\n    const tabs = [\r\n        { key: 'channels', label: 'Channels' },\r\n        { key: 'empires', label: 'Empires' },\r\n        { key: 'treaties', label: 'Treaties' }\r\n    ];\r\n    if (showAccountsTab) {\r\n        tabs.push({ key: 'accounts', label: 'Manage Accounts' });\r\n        tabs.push({ key: 'manage-empires', label: 'Manage Empires' });\r\n    }\r\n\r\n    // Ref for account edit panel\r\n    const accountEditPanelRef = useRef(null);\r\n\r\n    // Scroll to edit panel when editAccount changes\r\n    useEffect(() => {\r\n        if (editAccount && accountEditPanelRef.current) {\r\n            accountEditPanelRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        }\r\n    }, [editAccount]);\r\n\r\n    // --- MODIFIED: Only allow delete if GM and permission enabled ---\r\n    function handleDeleteMessage(boardKey, msgIdx) {\r\n        if (!account || account.username !== \"GameMaster\" || !gmPermissions.canDeleteMessages) return;\r\n        if (!window.confirm(\"Delete this message?\")) return;\r\n        fetch('/api/messages/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ board: boardKey, index: Number(msgIdx) })\r\n        })\r\n        .then(res => res.json())\r\n        .then(() => {\r\n            fetch(`/api/messages?board=${encodeURIComponent(boardKey)}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [boardKey]: data\r\n                    }));\r\n                });\r\n        });\r\n    }\r\n\r\n    return (\r\n        <div className=\"app-container\">\r\n            <header className=\"header\">\r\n                <h1>Stellaris RP Diplomatic Message Boards</h1>\r\n                <div className=\"tabs-bar\">\r\n                    {tabs.map(tab => (\r\n                        <button\r\n                            key={tab.key}\r\n                            className={`tab-btn${activeTab === tab.key ? ' active' : ''}`}\r\n                            onClick={() => {\r\n                                setActiveTab(tab.key);\r\n                                setEmpirePage(null);\r\n                                setEditEmpire(null);\r\n                                setEditAccount(null);\r\n                                setTreatyEditId(null);\r\n                                setTreatyViewId(null);\r\n                                setShowTreatyForm(false);\r\n                            }}\r\n                        >\r\n                            {tab.label}\r\n                        </button>\r\n                    ))}\r\n                    {/* --- Hamburger menu at top right --- */}\r\n                    <div className=\"menu-dropdown-container\">\r\n                        <button\r\n                            className=\"menu-btn\"\r\n                            aria-label=\"Open menu\"\r\n                            onClick={handleMenuToggle}\r\n                        >\r\n                            <span className=\"menu-icon\">&#9776;</span>\r\n                        </button>\r\n                        {showMenu && (\r\n                            <div\r\n                                className=\"menu-dropdown\"\r\n                                ref={menuDropdownRef}\r\n                            >\r\n                                <button className=\"menu-dropdown-item logout-btn\" onClick={handleLogout}>\r\n                                    <span className=\"logout-icon\">&#x1F511;</span> Logout\r\n                                </button>\r\n                                <button className=\"menu-dropdown-item\" onClick={handleShowAbout}>\r\n                                    About\r\n                                </button>\r\n                                <button className=\"menu-dropdown-item\" onClick={handleShowTheme}>\r\n                                    Theme Switcher\r\n                                </button>\r\n                                {account && account.username === \"GameMaster\" && (\r\n                                    <button className=\"menu-dropdown-item\" onClick={handlePermissionsToggle}>\r\n                                        Manage Permissions\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                        {showPermissions && (\r\n                            <div\r\n                                className=\"menu-permissions-dropdown\"\r\n                                ref={permissionsDropdownRef}\r\n                            >\r\n                                <div className=\"menu-permissions-title\">GameMaster Permissions</div>\r\n                                <label className=\"menu-permissions-option\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={!!gmPermissions.canDeleteMessages}\r\n                                        onChange={e => handlePermissionChange('canDeleteMessages', e.target.checked)}\r\n                                    />\r\n                                    Allow deleting messages\r\n                                </label>\r\n                                {/* Add more GM toggles here if needed */}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n            <main className=\"main-content\">\r\n                {activeTab === 'treaties' ? (\r\n                    <section className=\"treaties-section card\">\r\n                        <div className=\"treaties-header\">\r\n                            <h2>Treaties, Contracts & Agreements</h2>\r\n                            {account && (\r\n                                <button\r\n                                    className=\"empire-save-btn\"\r\n                                    onClick={() => openTreatyDialog('new')}\r\n                                >\r\n                                    + Add New Treaty\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        {/* Dialogs */}\r\n                        {treatyDialog.open && treatyDialog.mode !== 'view' && (\r\n                            <TreatyDialog\r\n                                open={treatyDialog.open}\r\n                                mode={treatyDialog.mode}\r\n                                data={treatyDialog.data}\r\n                                onSave={handleTreatySave}\r\n                                onClose={closeTreatyDialog}\r\n                                error={treatyError}\r\n                                saving={treatySaving}\r\n                                empires={empires.map(e => e.name)}\r\n                                accounts={accounts}\r\n                            />\r\n                        )}\r\n                        {treatyDialog.open && treatyDialog.mode === 'view' && (\r\n                            <TreatyView\r\n                                treaty={treatyDialog.data}\r\n                                onBack={closeTreatyDialog}\r\n                                onEdit={() => openTreatyDialog('edit', treatyDialog.data)}\r\n                                onTransfer={newOwner => handleTreatyTransferOwner(treatyDialog.data.id, newOwner)}\r\n                                canEdit={canEditTreaty(treatyDialog.data)}\r\n                                canTransfer={canTransferTreaty(treatyDialog.data)}\r\n                                accounts={accounts}\r\n                            />\r\n                        )}\r\n                        {/* List */}\r\n                        <div className=\"treaties-list-container\">\r\n                            {!treatiesLoaded && <div className=\"login-loading\">Loading treaties...</div>}\r\n                            {treaties.length === 0 && treatiesLoaded && (\r\n                                <div className=\"no-messages\">No treaties yet.</div>\r\n                            )}\r\n                            <ul className=\"treaties-list\">\r\n                                {treaties.map(treaty => (\r\n                                    <li\r\n                                        key={treaty.id}\r\n                                        className=\"treaty-item\"\r\n                                        onClick={() => setTreatyDialog({ open: true, mode: 'view', data: treaty })}\r\n                                    >\r\n                                        <div className=\"treaty-info\">\r\n                                            <div className=\"treaty-title\">{treaty.title}</div>\r\n                                            <div className=\"treaty-meta\">\r\n                                                <div className=\"treaty-owner\">Owner: {treaty.owner}</div>\r\n                                                <div className=\"treaty-participants\">\r\n                                                    <b>Participants:</b> {treaty.participants?.join(', ') || <i>None</i>}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"treaty-content\">\r\n                                                {treaty.content.length > 180 ? treaty.content.slice(0,180) + '…' : treaty.content}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"treaty-actions\">\r\n                                            <span className=\"treaty-status\">\r\n                                                {({\r\n                                                    discussion: '🗨️ In Discussion',\r\n                                                    active: '✅ Active',\r\n                                                    broken: '❌ Broken',\r\n                                                    expired: '⌛ Expired',\r\n                                                    other: '❓ Other'\r\n                                                })[treaty.status] || treaty.status}\r\n                                            </span>\r\n                                            <span className=\"treaty-buttons\">\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    onClick={ev => { ev.stopPropagation(); setTreatyDialog({ open: true, mode: 'view', data: treaty }); }}\r\n                                                >View</button>\r\n                                                {canEditTreaty(treaty) && (\r\n                                                    <button\r\n                                                        className=\"empire-save-btn\"\r\n                                                        onClick={ev => { ev.stopPropagation(); openTreatyDialog('edit', treaty); }}\r\n                                                    >Edit</button>\r\n                                                )}\r\n                                            </span>\r\n                                        </div>\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        </div>\r\n                    </section>\r\n                ) : activeTab === 'manage-empires' && showAccountsTab ? (\r\n                    <section className=\"account-manage-section card\">\r\n                        <h2>Manage Empires</h2>\r\n                        <form onSubmit={handleCreateEmpire} className=\"account-form\">\r\n                            <div className=\"account-form-fields\">\r\n                                <input\r\n                                    placeholder=\"New empire name\"\r\n                                    value={newEmpireName}\r\n                                    onChange={e => setNewEmpireName(e.target.value)}\r\n                                    required\r\n                                    className=\"login-input\"\r\n                                    disabled={newEmpireLoading}\r\n                                />\r\n                                <button type=\"submit\" className=\"login-btn\" disabled={newEmpireLoading}>Create Empire</button>\r\n                            </div>\r\n                        </form>\r\n                        {newEmpireError && <div className=\"login-error\">{newEmpireError}</div>}\r\n                        <h3>Empires & Account Assignment</h3>\r\n                        <ul className=\"accounts-list\">\r\n                            {empires.map(emp => (\r\n                                <li\r\n                                    key={emp.name}\r\n                                    className=\"account-item\"\r\n                                >\r\n                                    <b>{emp.name}</b>\r\n                                    <span className=\"account-actions\">\r\n                                        <select\r\n                                            value={emp.account || ''}\r\n                                            onChange={e => {\r\n                                                const val = e.target.value;\r\n                                                if (val) handleLinkAccount(emp.name, val);\r\n                                                else handleUnlinkAccount(emp.name);\r\n                                            }}\r\n                                            className=\"account-select\"\r\n                                        >\r\n                                            <option value=\"\" className=\"account-option\">Select account...</option>\r\n                                            {Object.keys(accounts).map(accName => (\r\n                                                <option key={accName} value={accName} className=\"account-option\">\r\n                                                    {accName}\r\n                                                </option>\r\n                                            ))}\r\n                                        </select>\r\n                                        <button\r\n                                            className=\"account-manage-btn account-delete-btn\"\r\n                                            onClick={() => handleDeleteEmpire(emp.name)}\r\n                                            disabled={newEmpireLoading}\r\n                                        >Delete</button>\r\n                                    </span>\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    </section>\r\n                ) : activeTab === 'accounts' && showAccountsTab ? (\r\n                    <section className=\"account-manage-section card\">\r\n                        <h2>Manage Accounts</h2>\r\n                        <form onSubmit={handleCreateAccount} className=\"account-form\">\r\n                            <div className=\"account-form-fields\">\r\n                                <input\r\n                                    placeholder=\"Account name\"\r\n                                    value={newAccountName}\r\n                                    onChange={e => setNewAccountName(e.target.value)}\r\n                                    required\r\n                                    className=\"login-input\"\r\n                                    disabled={accountsTabLoading}\r\n                                />\r\n                                <input\r\n                                    type=\"password\"\r\n                                    placeholder=\"Password\"\r\n                                    value={newAccountPass}\r\n                                    onChange={e => setNewAccountPass(e.target.value)}\r\n                                    required\r\n                                    className=\"login-input\"\r\n                                    disabled={accountsTabLoading}\r\n                                />\r\n                                <button type=\"submit\" className=\"login-btn\" disabled={accountsTabLoading}>Create</button>\r\n                            </div>\r\n                        </form>\r\n                        {accountError && <div className=\"login-error\">{accountError}</div>}\r\n                        {accountSuccess && <div className=\"login-loading\" style={{color:'limegreen'}}>{accountSuccess}</div>}\r\n\r\n                        {/* Restore account list with Edit/Delete buttons */}\r\n                        <h3>All Accounts</h3>\r\n                        <ul className=\"accounts-list\">\r\n                            {Object.keys(accounts).map(acc => (\r\n                                <li\r\n                                    key={acc}\r\n                                    className=\"account-item\"\r\n                                >\r\n                                    <b>{acc}</b>\r\n                                    {acc !== \"GameMaster\" && (\r\n                                        <span className=\"account-actions\">\r\n                                            <button\r\n                                                className=\"account-manage-btn account-edit-btn\"\r\n                                                onClick={() => {\r\n                                                    setEditAccount(acc);\r\n                                                    setEditAccountName(acc);\r\n                                                    setEditAccountPass('');\r\n                                                    setEditAccountError('');\r\n                                                }}\r\n                                                disabled={editAccountLoading}\r\n                                            >Edit</button>\r\n                                            <button\r\n                                                className=\"account-manage-btn account-delete-btn\"\r\n                                                onClick={() => handleDeleteAccount(acc)}\r\n                                                disabled={editAccountLoading}\r\n                                            >Delete</button>\r\n                                        </span>\r\n                                    )}\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                        {editAccount && (\r\n                            <div\r\n                                className=\"account-edit-panel card\"\r\n                                ref={accountEditPanelRef}\r\n                            >\r\n                                <h3>Edit Account: <b>{editAccount}</b></h3>\r\n                                <form onSubmit={handleRenameAccount} className=\"edit-account-form\">\r\n                                    <label>\r\n                                        Rename to:\r\n                                        <input\r\n                                            value={editAccountName}\r\n                                            onChange={e => setEditAccountName(e.target.value)}\r\n                                            className=\"login-input\"\r\n                                            disabled={editAccountLoading}\r\n                                        />\r\n                                    </label>\r\n                                    <button type=\"submit\" className=\"empire-save-btn\" disabled={editAccountLoading}>Rename</button>\r\n                                </form>\r\n                                <form onSubmit={handleChangePassword} className=\"change-password-form\">\r\n                                    <label>\r\n                                        New Password:\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            value={editAccountPass}\r\n                                            onChange={e => setEditAccountPass(e.target.value)}\r\n                                            className=\"login-input\"\r\n                                            disabled={editAccountLoading}\r\n                                        />\r\n                                    </label>\r\n                                    <button type=\"submit\" className=\"empire-save-btn\" disabled={editAccountLoading}>Change Password</button>\r\n                                </form>\r\n                                {editAccountError && <div className=\"login-error\">{editAccountError}</div>}\r\n                                <button className=\"empire-back-btn\" onClick={() => setEditAccount(null)} disabled={editAccountLoading}>Cancel</button>\r\n                            </div>\r\n                        )}\r\n                    </section>\r\n                ) : activeTab === 'empires' ? (\r\n                    editEmpire ? (\r\n                        <section className=\"empires-info-section card\">\r\n                            <h2>Edit {editEmpire}</h2>\r\n                            <EmpireEditPanel name={editEmpire} onCancel={() => setEditEmpire(null)} />\r\n                        </section>\r\n                    ) : empirePage ? (\r\n                        <EmpirePanel name={empirePage} canEdit={account && account.username === empirePage} />\r\n                    ) : (\r\n                        <section className=\"empires-info-section card\">\r\n                            {/* Updated: Better alignment for title and total */}\r\n                            <div style={{\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                alignItems: 'center',\r\n                                marginBottom: '1.5rem',\r\n                                gap: '0.3rem'\r\n                            }}>\r\n                                <h2 className=\"section-title\" style={{margin: 0, textAlign: 'center'}}>Empires Overview</h2>\r\n                                <span style={{\r\n                                    color: '#aaa',\r\n                                    fontSize: '1.05rem',\r\n                                    fontWeight: 500,\r\n                                    textAlign: 'center'\r\n                                }}>\r\n                                    Total Empires: <b>{getEmpireNames().length}</b>\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"empires-info-list\" style={{display: 'flex', flexWrap: 'wrap', gap: '1.5rem', justifyContent: 'flex-start'}}>\r\n                                {getEmpireNames().map(e => {\r\n                                    const linkedAccount = getEmpireAccount(e);\r\n                                    const canEdit = account && (account.username === linkedAccount || account.username === \"GameMaster\");\r\n                                    return (\r\n                                        <div\r\n                                            key={e}\r\n                                            className=\"empire-info-card empire-list-card\"\r\n                                            style={{\r\n                                                minWidth: 260,\r\n                                                maxWidth: 340,\r\n                                                flex: '1 1 320px',\r\n                                                background: 'var(--primary-bg)',\r\n                                                border: '1.5px solid var(--accent)',\r\n                                                borderRadius: 12,\r\n                                                boxShadow: '0 2px 12px #0002',\r\n                                                padding: '1.2rem 1.2rem',\r\n                                                display: 'flex',\r\n                                                flexDirection: 'column',\r\n                                                gap: '0.7rem',\r\n                                                cursor: 'pointer'\r\n                                            }}\r\n                                            onClick={() => setEmpirePage(e)}\r\n                                        >\r\n                                            <h3 className=\"empire-info-title\" style={{margin: 0, color: 'var(--accent)', textAlign: 'center'}}>{e}</h3>\r\n                                            <div style={{color: '#b3cfff', fontWeight: 500, fontSize: '1.05em', textAlign: 'center', marginBottom: '0.5rem'}}>\r\n                                                {linkedAccount ? <span title=\"Assigned Account\">{linkedAccount}</span> : <i>Unassigned</i>}\r\n                                            </div>\r\n                                            <div className=\"empire-actions\" style={{display: 'flex', gap: '0.5rem', marginTop: '0.5rem', justifyContent: 'center'}}>\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    style={{minWidth: 80}}\r\n                                                    onClick={ev => {ev.stopPropagation(); setEmpirePage(e);}}\r\n                                                >View</button>\r\n                                                {canEdit && (\r\n                                                    <button\r\n                                                        className=\"empire-save-btn\"\r\n                                                        style={{minWidth: 80}}\r\n                                                        onClick={ev => {ev.stopPropagation(); setEditEmpire(e);}}\r\n                                                    >Edit</button>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </section>\r\n                    )\r\n                ) : (\r\n                    <>\r\n                        {!account ? (\r\n                            <section className=\"account-section card\">\r\n                                <h2 className=\"login-title\">Login</h2>\r\n                                <form onSubmit={handleLogin} className=\"account-form login-form\">\r\n                                    <div className=\"login-fields\">\r\n                                        <input\r\n                                            placeholder=\"Empire name\"\r\n                                            value={loginUser}\r\n                                            onChange={e => setLoginUser(e.target.value)}\r\n                                            required\r\n                                            disabled={!accountsLoaded}\r\n                                            className=\"login-input\"\r\n                                        />\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            placeholder=\"Password\"\r\n                                            value={loginPass}\r\n                                            onChange={e => setLoginPass(e.target.value)}\r\n                                            required\r\n                                            disabled={!accountsLoaded}\r\n                                            className=\"login-input\"\r\n                                        />\r\n                                    </div>\r\n                                    <button type=\"submit\" disabled={!accountsLoaded} className=\"login-btn\">Login</button>\r\n                                </form>\r\n                                {!accountsLoaded && <div className=\"login-loading\">Loading accounts...</div>}\r\n                                {error && <div className=\"login-error\">{error}</div>}\r\n                            </section>\r\n                        ) : (\r\n                            // Center the channels page\r\n                            <div style={{ display: 'flex', justifyContent: 'center', width: '100%' }}>\r\n                                <section className=\"boards-section\">\r\n                                    {/* Logout button at top right */}\r\n                                    {/* <div className=\"channels-header\">\r\n                                        <span style={{marginRight: 'auto', color: '#aaa', fontWeight: 500}}>\r\n                                            Logged in as <b>{account.username}</b>\r\n                                        </span>\r\n                                        <button\r\n                                            className=\"logout-btn\"\r\n                                            onClick={handleLogout}\r\n                                            title=\"Logout\"\r\n                                        >\r\n                                            <span className=\"logout-icon\">&#x1F511;</span> Logout\r\n                                        </button>\r\n                                    </div> */}\r\n                                    {/* Main area: boards/channels list left, text channel right */}\r\n                                    <div className=\"channels-main\">\r\n                                        <div className=\"channels-sidebar\">\r\n                                            <div className=\"boards-list card\">\r\n                                                <h2>\r\n                                                    {account && account.username === \"GameMaster\"\r\n                                                        ? \"All Boards\"\r\n                                                        : \"Your Diplomatic Channels\"}\r\n                                                </h2>\r\n                                                <div className=\"boards-list-header\">\r\n                                                    <span className=\"boards-list-count\">\r\n                                                        {filteredBoards.length} {filteredBoards.length === 1 ? \"channel\" : \"channels\"}\r\n                                                    </span>\r\n                                                </div>\r\n                                                <ul className=\"boards-list-ul\">\r\n                                                    {filteredBoards.length === 0 && (\r\n                                                        <li className=\"no-channels\">No channels available.</li>\r\n                                                    )}\r\n                                                    {filteredBoards.map(([a, b]) => {\r\n                                                        const key = a + '|' + b;\r\n                                                        return (\r\n                                                            <li key={key} className={`boards-list-item${selected === key ? ' active' : ''}`}>\r\n                                                                <button\r\n                                                                    className=\"board-btn\"\r\n                                                                    onClick={() => handleBoardSelect([a, b])}\r\n                                                                >\r\n                                                                    <span className=\"board-nations\">{a}</span>\r\n                                                                    <span className=\"board-arrow\">↔</span>\r\n                                                                    <span className=\"board-nations\">{b}</span>\r\n                                                                </button>\r\n                                                            </li>\r\n                                                        );\r\n                                                    })}\r\n                                                </ul>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"channels-content\">\r\n                                            <div className=\"board-messages card\">\r\n                                                {(selected && filteredBoards.length > 0) ? (\r\n                                                    <div className=\"board-messages-inner\">\r\n                                                        <div className=\"board-title-row\">\r\n                                                            <h2 className=\"board-title\">{selected.replace('|', ' ↔ ')}</h2>\r\n                                                        </div>\r\n                                                        <div className=\"messages-panel\">\r\n                                                            <div className=\"messages-list-container\">\r\n                                                                <ul className=\"messages-list\">\r\n                                                                    {(messages[selected] || []).length === 0 && <li className=\"no-messages\">No messages yet.</li>}\r\n                                                                    {(messages[selected] || []).map((msg, i) => {\r\n                                                                        const [partnerA, partnerB] = selected.split('|');\r\n                                                                        let partnerClass = '';\r\n                                                                        if (msg.author === partnerA) partnerClass = 'message-partnerA';\r\n                                                                        else if (msg.author === partnerB) partnerClass = 'message-partnerB';\r\n                                                                        return (\r\n                                                                            <li\r\n                                                                                key={i}\r\n                                                                                className={`message-item ${partnerClass}`}\r\n                                                                                style={{\r\n                                                                                    display: 'flex',\r\n                                                                                    alignItems: 'stretch',\r\n                                                                                    justifyContent: 'flex-start',\r\n                                                                                    gap: '0.7rem'\r\n                                                                                }}\r\n                                                                            >\r\n                                                                                <div style={{\r\n                                                                                    flex: 1,\r\n                                                                                    minWidth: 0,\r\n                                                                                    display: 'flex',\r\n                                                                                    flexDirection: 'column',\r\n                                                                                    gap: '0.15rem',\r\n                                                                                    justifyContent: 'center'\r\n                                                                                }}>\r\n                                                                                    <div className=\"message-meta\" style={{marginBottom: 0}}>\r\n                                                                                        <span className=\"message-author\">{msg.author}</span>\r\n                                                                                        <small className=\"message-date\">{new Date(msg.timestamp).toLocaleString()}</small>\r\n                                                                                    </div>\r\n                                                                                    <div className=\"message-text\">{msg.text}</div>\r\n                                                                                </div>\r\n                                                                                {account && account.username === \"GameMaster\" && gmPermissions.canDeleteMessages && (\r\n                                                                                    <div style={{\r\n                                                                                        display: 'flex',\r\n                                                                                        alignItems: 'center',\r\n                                                                                        justifyContent: 'center',\r\n                                                                                        minWidth: '2.5em',\r\n                                                                                        paddingLeft: '0.5em'\r\n                                                                                    }}>\r\n                                                                                        <button\r\n                                                                                            title=\"Delete message\"\r\n                                                                                            style={{\r\n                                                                                                background: 'none',\r\n                                                                                                border: 'none',\r\n                                                                                                color: '#ff4d4d',\r\n                                                                                                cursor: 'pointer',\r\n                                                                                                fontSize: '1.3em',\r\n                                                                                                display: 'flex',\r\n                                                                                                alignItems: 'center',\r\n                                                                                                height: '2.2em'\r\n                                                                                            }}\r\n                                                                                            onClick={e => {\r\n                                                                                                e.stopPropagation();\r\n                                                                                                handleDeleteMessage(selected, i);\r\n                                                                                            }}\r\n                                                                                        >\r\n                                                                                            <span role=\"img\" aria-label=\"Delete\">&#128465;</span>\r\n                                                                                        </button>\r\n                                                                                    </div>\r\n                                                                                )}\r\n                                                                            </li>\r\n                                                                        );\r\n                                                                    })}\r\n                                                                    <div ref={messagesEndRef} />\r\n                                                                </ul>\r\n                                                            </div>\r\n                                                            <form onSubmit={postMessage} className=\"message-form message-form-bottom\">\r\n                                                                <input\r\n                                                                    placeholder=\"Your empire\"\r\n                                                                    value={account.username}\r\n                                                                    disabled\r\n                                                                    required\r\n                                                                    className=\"author-input\"\r\n                                                                />\r\n                                                                <input\r\n                                                                    placeholder=\"Message\"\r\n                                                                    value={text}\r\n                                                                    onChange={e => setText(e.target.value)}\r\n                                                                    required\r\n                                                                    className=\"text-input\"\r\n                                                                />\r\n                                                                <button type=\"submit\" className=\"send-btn\">Send</button>\r\n                                                            </form>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <div className=\"no-messages\">Select a channel to view messages.</div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </section>\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </main>\r\n            <footer className=\"footer\">\r\n                <span>Stellaris RP Board &copy; {new Date().getFullYear()}</span>\r\n            </footer>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}