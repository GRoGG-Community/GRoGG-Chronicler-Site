{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'./App.css';import'./Treaties.css';import'./Empires.css';import'./Boards.css';import'./Accounts.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function getNationPairs(nations){const pairs=[];for(let i=0;i<nations.length;i++){for(let j=i+1;j<nations.length;j++){pairs.push([nations[i],nations[j]]);}}return pairs;}function App(){// Remove unused empireInput, selectedNation, author\nconst[empires,setEmpires]=useState([]);const[selected,setSelected]=useState(()=>{const saved=localStorage.getItem('stellarisSelectedBoard');return saved?saved:null;});const[messages,setMessages]=useState({});const[text,setText]=useState('');const pollingRef=useRef();const messagesEndRef=useRef(null);const[accounts,setAccounts]=useState({});const[accountsLoaded,setAccountsLoaded]=useState(false);const[account,setAccount]=useState(()=>{const saved=localStorage.getItem('stellarisAccount');return saved?JSON.parse(saved):null;});const[loginUser,setLoginUser]=useState('');const[loginPass,setLoginPass]=useState('');const[error,setError]=useState('');const[activeTab,setActiveTab]=useState('channels');const[empirePage,setEmpirePage]=useState(null);const[editEmpire,setEditEmpire]=useState(null);const[empireInfo,setEmpireInfo]=useState({});const[empireInfoLoaded,setEmpireInfoLoaded]=useState(false);// Account creation and management\nconst[newAccountName,setNewAccountName]=useState('');const[newAccountPass,setNewAccountPass]=useState('');const[accountError,setAccountError]=useState('');const[accountSuccess,setAccountSuccess]=useState('');const[accountsTabLoading,setAccountsTabLoading]=useState(false);const[editAccount,setEditAccount]=useState(null);const[editAccountName,setEditAccountName]=useState('');const[editAccountPass,setEditAccountPass]=useState('');const[editAccountError,setEditAccountError]=useState('');const[editAccountLoading,setEditAccountLoading]=useState(false);// Manage Empires tab\nconst[newEmpireName,setNewEmpireName]=useState('');const[newEmpireError,setNewEmpireError]=useState('');const[newEmpireLoading,setNewEmpireLoading]=useState(false);// --- Treaties State (NEW IMPLEMENTATION) ---\nconst[treaties,setTreaties]=useState([]);const[treatiesLoaded,setTreatiesLoaded]=useState(false);const[treatyDialog,setTreatyDialog]=useState({open:false,mode:null,data:null});const[treatyError,setTreatyError]=useState('');const[treatySaving,setTreatySaving]=useState(false);// --- Fetch treaties ---\nfunction fetchTreaties(){fetch('/treaties.json?ts='+Date.now()).then(res=>res.json()).then(data=>{setTreaties(Array.isArray(data)?data:[]);setTreatiesLoaded(true);}).catch(()=>setTreatiesLoaded(true));}useEffect(()=>{fetchTreaties();},[]);// --- Treaty CRUD ---\nfunction openTreatyDialog(mode){let data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setTreatyDialog({open:true,mode,data});setTreatyError('');}function closeTreatyDialog(){setTreatyDialog({open:false,mode:null,data:null});setTreatyError('');}function handleTreatySave(form){var _payload$participants;setTreatySaving(true);setTreatyError('');const payload={...form};if(!payload.title||!payload.content||!((_payload$participants=payload.participants)!==null&&_payload$participants!==void 0&&_payload$participants.length)){setTreatyError('Title, content, and at least one participant are required.');setTreatySaving(false);return;}if(!payload.owner)payload.owner=(account===null||account===void 0?void 0:account.username)||'';if(!payload.status)payload.status='discussion';if(!payload.id)payload.id=Date.now().toString();fetch('/api/treaties',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).then(res=>res.json()).then(data=>{if(data.success){// --- FIX: update treaties state locally, just like accounts ---\nsetTreaties(prev=>{// If editing, replace; if new, add\nconst idx=prev.findIndex(t=>t.id===payload.id);if(idx!==-1){const updated=[...prev];updated[idx]={...prev[idx],...payload};return updated;}else{return[...prev,payload];}});closeTreatyDialog();}else{setTreatyError(data.error||'Failed to save treaty');}}).catch(()=>setTreatyError('Failed to save treaty')).finally(()=>setTreatySaving(false));}function handleTreatyTransferOwner(id,newOwner){setTreatySaving(true);fetch('/api/treaties/transfer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,newOwner})}).then(res=>res.json()).then(data=>{if(data.success)fetchTreaties();}).finally(()=>setTreatySaving(false));}// --- Treaty Permissions ---\nfunction canEditTreaty(treaty){if(!account)return false;return account.username===treaty.owner||account.username===\"GameMaster\";}function canTransferTreaty(treaty){return account&&account.username===\"GameMaster\";}// --- Treaty Dialog UI ---\nfunction TreatyDialog(_ref){let{open,mode,data,onSave,onClose,error,saving,empires,accounts}=_ref;const[form,setForm]=useState(()=>data?{...data}:{title:'',content:'',participants:[],status:'discussion',owner:(account===null||account===void 0?void 0:account.username)||''});const[showParticipantsDropdown,setShowParticipantsDropdown]=useState(false);const dropdownBtnRef=useRef(null);const dropdownListRef=useRef(null);useEffect(()=>{if(data)setForm({...data});else setForm({title:'',content:'',participants:[],status:'discussion',owner:(account===null||account===void 0?void 0:account.username)||''});},[data,open]);// --- Dropdown close on outside click ---\nuseEffect(()=>{if(!showParticipantsDropdown)return;function handleClick(e){if(dropdownBtnRef.current&&!dropdownBtnRef.current.contains(e.target)&&dropdownListRef.current&&!dropdownListRef.current.contains(e.target)){setShowParticipantsDropdown(false);}}document.addEventListener('mousedown',handleClick);return()=>document.removeEventListener('mousedown',handleClick);},[showParticipantsDropdown]);// Keyboard navigation: close dropdown on Escape\nuseEffect(()=>{if(!showParticipantsDropdown)return;function handleKey(e){if(e.key===\"Escape\")setShowParticipantsDropdown(false);}document.addEventListener('keydown',handleKey);return()=>document.removeEventListener('keydown',handleKey);},[showParticipantsDropdown]);if(!open)return null;const isEdit=mode==='edit';const statuses=[{value:'discussion',label:'ðŸ—¨ï¸ In Discussion'},{value:'active',label:'âœ… Active'},{value:'broken',label:'âŒ Broken'},{value:'expired',label:'âŒ› Expired'},{value:'other',label:'â“ Other'}];// Helper for participants dropdown\nfunction toggleParticipant(name){setForm(f=>{const exists=f.participants.includes(name);return{...f,participants:exists?f.participants.filter(p=>p!==name):[...f.participants,name]};});}return/*#__PURE__*/_jsx(\"div\",{className:\"treaty-dialog-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-dialog\",children:[/*#__PURE__*/_jsx(\"h2\",{children:isEdit?'Edit Treaty':'New Treaty'}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:e=>{e.preventDefault();onSave(form);},children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Title:\",/*#__PURE__*/_jsx(\"input\",{value:form.title,onChange:e=>setForm(f=>({...f,title:e.target.value})),required:true,disabled:saving})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Status:\",/*#__PURE__*/_jsx(\"select\",{value:form.status,onChange:e=>setForm(f=>({...f,status:e.target.value})),disabled:saving,children:statuses.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.value,children:s.label},s.value))})]}),/*#__PURE__*/_jsxs(\"label\",{style:{position:'relative'},children:[\"Participants:\",/*#__PURE__*/_jsxs(\"div\",{className:\"participants-dropdown\",ref:dropdownBtnRef,tabIndex:0,style:{userSelect:'none',background:'var(--primary-bg)',border:'1px solid var(--border)',borderRadius:8,padding:'0.7rem 1rem',minHeight:'2.2rem',cursor:saving?'not-allowed':'pointer',marginBottom:'0.7rem',position:'relative',display:'flex',alignItems:'center',justifyContent:'space-between'}// Prevent the first click from toggling the first item\n,onMouseDown:e=>e.preventDefault(),onClick:e=>{if(!saving)setShowParticipantsDropdown(v=>!v);},\"aria-haspopup\":\"listbox\",\"aria-expanded\":showParticipantsDropdown,children:[/*#__PURE__*/_jsx(\"span\",{style:{color:form.participants.length?'var(--text)':'#aaa',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap',flex:1},children:form.participants.length?form.participants.join(', '):'Select participants...'}),/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:8,color:'#aaa',fontSize:'1.1em',pointerEvents:'none'},children:\"\\u25BC\"})]}),showParticipantsDropdown&&/*#__PURE__*/_jsx(\"div\",{className:\"participants-dropdown-list\",ref:dropdownListRef,style:{position:'absolute',left:0,right:0,top:'calc(100% + 8px)',zIndex:1001,background:'var(--card-bg)',border:'1.5px solid var(--accent)',borderRadius:10,boxShadow:'0 4px 24px #0005',minWidth:210,padding:'0.3rem 0',display:'flex',flexDirection:'column',gap:'0.2rem',maxHeight:220,overflowY:'auto'},onClick:e=>e.stopPropagation(),role:\"listbox\",children:empires.map((e,idx)=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"participants-dropdown-item\",style:{background:'none',border:'none',color:'var(--accent)',fontSize:'1.08rem',textAlign:'left',padding:'0.7rem 1.2rem',cursor:saving?'not-allowed':'pointer',borderRadius:7,transition:'background 0.15s, color 0.15s',width:'100%',display:'flex',alignItems:'center',gap:'0.7em',position:'relative',backgroundColor:form.participants.includes(e)?'rgba(0,191,255,0.10)':'transparent'},tabIndex:-1// Prevent the first click after opening from toggling the first item\n,onMouseDown:ev=>ev.preventDefault(),onClick:ev=>{ev.stopPropagation();if(!saving)toggleParticipant(e);},children:[/*#__PURE__*/_jsx(\"span\",{style:{display:'inline-flex',alignItems:'center',justifyContent:'center',width:22,height:22,borderRadius:5,border:'1.5px solid var(--accent)',background:form.participants.includes(e)?'var(--accent)':'var(--primary-bg)',marginRight:10,transition:'background 0.15s, border 0.15s'},children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:form.participants.includes(e),readOnly:true,tabIndex:-1,style:{accentColor:'var(--accent)',width:18,height:18,margin:0,pointerEvents:'none'}})}),/*#__PURE__*/_jsx(\"span\",{style:{color:form.participants.includes(e)?'#fff':'var(--accent)',fontWeight:form.participants.includes(e)?600:400,flex:1,textAlign:'left'},children:e})]},e))})]}),(account===null||account===void 0?void 0:account.username)===\"GameMaster\"&&/*#__PURE__*/_jsxs(\"label\",{children:[\"Owner:\",/*#__PURE__*/_jsx(\"select\",{value:form.owner,onChange:e=>setForm(f=>({...f,owner:e.target.value})),disabled:saving,children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsx(\"option\",{value:acc,children:acc},acc))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Content:\",/*#__PURE__*/_jsx(\"textarea\",{value:form.content,onChange:e=>setForm(f=>({...f,content:e.target.value})),rows:7,required:true,disabled:saving})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error treaty-error\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:saving,children:isEdit?\"Save Changes\":\"Create Treaty\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"empire-back-btn\",onClick:onClose,disabled:saving,children:\"Cancel\"})]})]})]})});}// --- Treaty View UI ---\nfunction TreatyView(_ref2){var _treaty$participants;let{treaty,onBack,onEdit,onTransfer,canEdit,canTransfer,accounts}=_ref2;if(!treaty)return null;const statuses={discussion:'ðŸ—¨ï¸ In Discussion',active:'âœ… Active',broken:'âŒ Broken',expired:'âŒ› Expired',other:'â“ Other'};return/*#__PURE__*/_jsx(\"div\",{className:\"treaty-dialog-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-dialog\",children:[/*#__PURE__*/_jsx(\"h2\",{children:treaty.title}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Status:\"}),\" \",statuses[treaty.status]||treaty.status]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Owner:\"}),\" \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",((_treaty$participants=treaty.participants)===null||_treaty$participants===void 0?void 0:_treaty$participants.join(', '))||/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{margin:'1em 0',whiteSpace:'pre-line'},children:treaty.content}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",style:{minWidth:110,maxWidth:160},onClick:onBack,children:\"Back\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{minWidth:110,maxWidth:160},onClick:onEdit,children:\"Edit\"})]})]})});}// --- Add tabs definition ---\nconst showAccountsTab=account&&account.username===\"GameMaster\";const tabs=[{key:'channels',label:'Channels'},{key:'empires',label:'Empires'},{key:'treaties',label:'Treaties'}];if(showAccountsTab){tabs.push({key:'accounts',label:'Manage Accounts'});tabs.push({key:'manage-empires',label:'Manage Empires'});}// --- Remove all treatyForm/treatyEditId/treatyViewId/setTreatyForm/setTreatyEditId/setTreatyViewId/setShowTreatyForm ---\n// --- Treaty Search/Filter/Sort/Pagination ---\nconst[treatySearch,setTreatySearch]=useState('');const[treatySort,setTreatySort]=useState('title');const[treatySortDir,setTreatySortDir]=useState('asc');const[treatyPage,setTreatyPage]=useState(1);const TREATIES_PER_PAGE=7;// --- Empire Search/Filter/Sort/Pagination ---\nconst[empireSearch,setEmpireSearch]=useState('');const[empireSort,setEmpireSort]=useState('name');const[empireSortDir,setEmpireSortDir]=useState('asc');const[empirePageNum,setEmpirePageNum]=useState(1);const EMPIRES_PER_PAGE=8;// --- Treaty Delete (GM only) ---\nfunction handleDeleteTreaty(id){if(!account||account.username!==\"GameMaster\")return;if(!window.confirm(\"Delete this treaty?\"))return;fetch('/api/treaties/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}).then(res=>res.json()).then(data=>{if(data.success)fetchTreaties();});}// --- Treaty Export/Copy ---\nfunction handleExportTreaties(){const blob=new Blob([JSON.stringify(treaties,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='treaties.json';a.click();URL.revokeObjectURL(url);}function handleCopyTreaty(treaty){navigator.clipboard.writeText(JSON.stringify(treaty,null,2));alert('Treaty copied to clipboard!');}// --- Empire Export/Copy/Rename ---\nfunction handleExportEmpires(){const blob=new Blob([JSON.stringify(empires,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='empires.json';a.click();URL.revokeObjectURL(url);}function handleCopyEmpire(empire){navigator.clipboard.writeText(JSON.stringify(empire,null,2));alert('Empire copied to clipboard!');}// Empire rename (GM only)\nfunction handleRenameEmpire(name){const newName=prompt('Enter new name for empire:',name);if(!newName||newName===name)return;fetch('/api/empires/rename',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,newName})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>prev.map(e=>e.name===name?{...e,name:newName}:e));setEmpireInfo(prev=>{const updated={...prev};if(updated[name]){updated[newName]=updated[name];delete updated[name];}return updated;});}else{alert(data.error||'Rename failed');}});}// --- Treaty/Empire Avatars ---\nfunction renderAvatar(name){// Simple initials avatar\nconst initials=name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase();return/*#__PURE__*/_jsx(\"span\",{style:{display:'inline-block',background:'var(--accent)',color:'#fff',borderRadius:'50%',width:28,height:28,textAlign:'center',lineHeight:'28px',fontWeight:700,marginRight:7,fontSize:'1em'},children:initials});}// --- Treaty/Empire Tooltips ---\nfunction Tooltip(_ref3){let{text}=_ref3;return/*#__PURE__*/_jsx(\"span\",{style:{position:'absolute',background:'#232b3a',color:'#fff',padding:'0.5em 1em',borderRadius:8,fontSize:'0.98em',zIndex:9999,boxShadow:'0 2px 8px #0005',top:'110%',left:0,whiteSpace:'pre-line'},children:text});}// --- Treaty Filter/Sort/Pagination ---\nconst filteredTreaties=treaties.filter(t=>{var _t$owner;return t.title.toLowerCase().includes(treatySearch.toLowerCase())||((_t$owner=t.owner)===null||_t$owner===void 0?void 0:_t$owner.toLowerCase().includes(treatySearch.toLowerCase()))||(t.participants||[]).some(p=>p.toLowerCase().includes(treatySearch.toLowerCase()));}).sort((a,b)=>{let vA=a[treatySort]||'';let vB=b[treatySort]||'';if(typeof vA==='string')vA=vA.toLowerCase();if(typeof vB==='string')vB=vB.toLowerCase();if(vA<vB)return treatySortDir==='asc'?-1:1;if(vA>vB)return treatySortDir==='asc'?1:-1;return 0;});const treatyTotalPages=Math.max(1,Math.ceil(filteredTreaties.length/TREATIES_PER_PAGE));const treatyPageTreaties=filteredTreaties.slice((treatyPage-1)*TREATIES_PER_PAGE,treatyPage*TREATIES_PER_PAGE);// --- Empire Filter/Sort/Pagination ---\nconst filteredEmpires=empires.filter(e=>e.name.toLowerCase().includes(empireSearch.toLowerCase())||(e.account||'').toLowerCase().includes(empireSearch.toLowerCase())).sort((a,b)=>{let vA=a[empireSort]||'';let vB=b[empireSort]||'';if(typeof vA==='string')vA=vA.toLowerCase();if(typeof vB==='string')vB=vB.toLowerCase();if(vA<vB)return empireSortDir==='asc'?-1:1;if(vA>vB)return empireSortDir==='asc'?1:-1;return 0;});const empireTotalPages=Math.max(1,Math.ceil(filteredEmpires.length/EMPIRES_PER_PAGE));const empirePageEmpires=filteredEmpires.slice((empirePageNum-1)*EMPIRES_PER_PAGE,empirePageNum*EMPIRES_PER_PAGE);// --- Restore menu handlers ---\nconst[showMenu,setShowMenu]=useState(false);const[showPermissions,setShowPermissions]=useState(false);const menuDropdownRef=useRef(null);const permissionsDropdownRef=useRef(null);function handleMenuToggle(){setShowMenu(v=>!v);setShowPermissions(false);}function handleMenuClose(){setShowMenu(false);setShowPermissions(false);}function handlePermissionsToggle(){setShowPermissions(v=>!v);}function handlePermissionChange(key,value){setGmPermissions(prev=>({...prev,[key]:value}));}function handleShowAbout(){alert(\"Stellaris RP Board\\n\\nCreated for roleplay and diplomacy.\\n\\nContact: admin@example.com\");handleMenuClose();}function handleShowTheme(){alert(\"Theme switcher coming soon!\");handleMenuClose();}// --- Restore menu close on outside click ---\nuseEffect(()=>{if(!showMenu&&!showPermissions)return;function handleMouseMove(e){if(menuDropdownRef.current&&permissionsDropdownRef.current&&!menuDropdownRef.current.contains(e.target)&&!permissionsDropdownRef.current.contains(e.target)){setShowMenu(false);setShowPermissions(false);}}document.addEventListener('mousedown',handleMouseMove);return()=>document.removeEventListener('mousedown',handleMouseMove);},[showMenu,showPermissions]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Stellaris RP Diplomatic Message Boards\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"tabs-bar\",children:[tabs.map(tab=>/*#__PURE__*/_jsx(\"button\",{className:`tab-btn${activeTab===tab.key?' active':''}`,onClick:()=>{setActiveTab(tab.key);setEmpirePage(null);setEditEmpire(null);setEditAccount(null);// Remove these obsolete calls:\n// setTreatyEditId(null);\n// setTreatyViewId(null);\n// setShowTreatyForm(false);\n// Only close treaty dialog:\nsetTreatyDialog({open:false,mode:null,data:null});setTreatyError('');},children:tab.label},tab.key)),/*#__PURE__*/_jsxs(\"div\",{className:\"menu-dropdown-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"menu-btn\",\"aria-label\":\"Open menu\",onClick:handleMenuToggle,children:/*#__PURE__*/_jsx(\"span\",{className:\"menu-icon\",children:\"\\u2630\"})}),showMenu&&/*#__PURE__*/_jsxs(\"div\",{className:\"menu-dropdown\",ref:menuDropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{className:\"menu-dropdown-item logout-btn\",onClick:handleLogout,children:[/*#__PURE__*/_jsx(\"span\",{className:\"logout-icon\",children:\"\\uD83D\\uDD11\"}),\" Logout\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handleShowAbout,children:\"About\"}),/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handleShowTheme,children:\"Theme Switcher\"}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handlePermissionsToggle,children:\"Manage Permissions\"})]}),showPermissions&&/*#__PURE__*/_jsxs(\"div\",{className:\"menu-permissions-dropdown\",ref:permissionsDropdownRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"menu-permissions-title\",children:\"GameMaster Permissions\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"menu-permissions-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!gmPermissions.canDeleteMessages,onChange:e=>handlePermissionChange('canDeleteMessages',e.target.checked)}),\"Allow deleting messages\"]})]})]})]})]}),/*#__PURE__*/_jsx(\"main\",{className:\"main-content\",children:activeTab==='treaties'?/*#__PURE__*/_jsxs(\"section\",{className:\"treaties-section card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Treaties, Contracts & Agreements\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.7em',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search treaties...\",value:treatySearch,onChange:e=>{setTreatySearch(e.target.value);setTreatyPage(1);},style:{minWidth:180,maxWidth:260}}),/*#__PURE__*/_jsxs(\"select\",{value:treatySort,onChange:e=>setTreatySort(e.target.value),style:{minWidth:110},children:[/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"option\",{value:\"status\",children:\"Status\"}),/*#__PURE__*/_jsx(\"option\",{value:\"owner\",children:\"Owner\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setTreatySortDir(d=>d==='asc'?'desc':'asc'),style:{minWidth:40},title:\"Toggle sort direction\",children:treatySortDir==='asc'?'â†‘':'â†“'}),/*#__PURE__*/_jsx(\"button\",{onClick:handleExportTreaties,style:{minWidth:40},title:\"Export treaties\",children:\"\\u2B73\"})]}),account&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>openTreatyDialog('new'),children:\"+ Add New Treaty\"})]}),treatyDialog.open&&treatyDialog.mode!=='view'&&/*#__PURE__*/_jsx(TreatyDialog,{open:treatyDialog.open,mode:treatyDialog.mode,data:treatyDialog.data,onSave:handleTreatySave,onClose:closeTreatyDialog,error:treatyError,saving:treatySaving,empires:empires.map(e=>e.name),accounts:accounts}),treatyDialog.open&&treatyDialog.mode==='view'&&/*#__PURE__*/_jsx(TreatyView,{treaty:treatyDialog.data,onBack:closeTreatyDialog,onEdit:()=>openTreatyDialog('edit',treatyDialog.data),onTransfer:newOwner=>handleTreatyTransferOwner(treatyDialog.data.id,newOwner),canEdit:canEditTreaty(treatyDialog.data),canTransfer:canTransferTreaty(treatyDialog.data),accounts:accounts}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-list-container\",children:[!treatiesLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",children:\"Loading treaties...\"}),filteredTreaties.length===0&&treatiesLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"no-messages\",children:\"No treaties found.\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"treaties-list\",children:treatyPageTreaties.map(treaty=>/*#__PURE__*/_jsxs(\"li\",{className:\"treaty-item\",style:{position:'relative'},onMouseEnter:e=>{const el=e.currentTarget;el._tooltip=document.createElement('div');el._tooltip.style.position='absolute';el._tooltip.style.top='100%';el._tooltip.style.left='0';el._tooltip.style.zIndex=9999;el._tooltip.style.background='#232b3a';el._tooltip.style.color='#fff';el._tooltip.style.padding='0.5em 1em';el._tooltip.style.borderRadius='8px';el._tooltip.style.fontSize='0.98em';el._tooltip.innerText=`${treaty.title}\\nOwner: ${treaty.owner}\\nStatus: ${treaty.status}\\nParticipants: ${(treaty.participants||[]).join(', ')}`;el.appendChild(el._tooltip);},onMouseLeave:e=>{const el=e.currentTarget;if(el._tooltip)el.removeChild(el._tooltip);},onClick:()=>setTreatyDialog({open:true,mode:'view',data:treaty}),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-info\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5em'},children:[renderAvatar(treaty.title),/*#__PURE__*/_jsx(\"div\",{className:\"treaty-title\",children:treaty.title})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-meta\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-owner\",children:[\"Owner: \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-participants\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",(treaty.participants||[]).map(renderAvatar)]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"treaty-content\",children:treaty.content.length>180?treaty.content.slice(0,180)+'â€¦':treaty.content})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-actions\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"treaty-status\",style:{background:{discussion:'#2c3446',active:'#0090c0',broken:'#c0392b',expired:'#888',other:'#555'}[treaty.status]||'#2c3446',color:'#fff'},children:{discussion:'ðŸ—¨ï¸ In Discussion',active:'âœ… Active',broken:'âŒ Broken',expired:'âŒ› Expired',other:'â“ Other'}[treaty.status]||treaty.status}),/*#__PURE__*/_jsxs(\"span\",{className:\"treaty-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",onClick:ev=>{ev.stopPropagation();setTreatyDialog({open:true,mode:'view',data:treaty});},children:\"View\"}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",onClick:ev=>{ev.stopPropagation();handleCopyTreaty(treaty);},title:\"Copy treaty\",children:\"Copy\"}),canEditTreaty(treaty)&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:ev=>{ev.stopPropagation();openTreatyDialog('edit',treaty);},children:\"Edit\"}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",style:{background:'#c0392b'},onClick:ev=>{ev.stopPropagation();handleDeleteTreaty(treaty.id);},children:\"Delete\"})]})]})]},treaty.id))}),treatyTotalPages>1&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.7em',justifyContent:'center',marginTop:'1em'},children:[/*#__PURE__*/_jsx(\"button\",{disabled:treatyPage===1,onClick:()=>setTreatyPage(treatyPage-1),children:\"Prev\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Page \",treatyPage,\" / \",treatyTotalPages]}),/*#__PURE__*/_jsx(\"button\",{disabled:treatyPage===treatyTotalPages,onClick:()=>setTreatyPage(treatyPage+1),children:\"Next\"})]})]})]}):activeTab==='empires'?editEmpire?/*#__PURE__*/_jsxs(\"section\",{className:\"empires-info-section card\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Edit \",editEmpire]}),/*#__PURE__*/_jsx(EmpireEditPanel,{name:editEmpire,onCancel:()=>setEditEmpire(null)})]}):empirePage?/*#__PURE__*/_jsx(EmpirePanel,{name:empirePage,canEdit:account&&account.username===empirePage}):/*#__PURE__*/_jsxs(\"section\",{className:\"empires-info-section card\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',alignItems:'center',marginBottom:'1.5rem',gap:'0.3rem'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",style:{margin:0,textAlign:'center'},children:\"Empires Overview\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#aaa',fontSize:'1.05rem',fontWeight:500,textAlign:'center'},children:[\"Total Empires: \",/*#__PURE__*/_jsx(\"b\",{children:filteredEmpires.length})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.7em',alignItems:'center',marginTop:'0.7em'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search empires...\",value:empireSearch,onChange:e=>{setEmpireSearch(e.target.value);setEmpirePageNum(1);},style:{minWidth:180,maxWidth:260}}),/*#__PURE__*/_jsxs(\"select\",{value:empireSort,onChange:e=>setEmpireSort(e.target.value),style:{minWidth:110},children:[/*#__PURE__*/_jsx(\"option\",{value:\"name\",children:\"Name\"}),/*#__PURE__*/_jsx(\"option\",{value:\"account\",children:\"Owner\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setEmpireSortDir(d=>d==='asc'?'desc':'asc'),style:{minWidth:40},title:\"Toggle sort direction\",children:empireSortDir==='asc'?'â†‘':'â†“'}),/*#__PURE__*/_jsx(\"button\",{onClick:handleExportEmpires,style:{minWidth:40},title:\"Export empires\",children:\"\\u2B73\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"empires-info-list\",style:{display:'flex',flexWrap:'wrap',gap:'1.5rem',justifyContent:'flex-start'},children:empirePageEmpires.map(e=>{const linkedAccount=getEmpireAccount(e.name);const canEdit=account&&(account.username===linkedAccount||account.username===\"GameMaster\");return/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-card empire-list-card\",style:{minWidth:260,maxWidth:340,flex:'1 1 320px',background:'var(--primary-bg)',border:'1.5px solid var(--accent)',borderRadius:12,boxShadow:'0 2px 12px #0002',padding:'1.2rem 1.2rem',display:'flex',flexDirection:'column',gap:'0.7rem',cursor:'pointer',position:'relative'},onMouseEnter:ev=>{const el=ev.currentTarget;el._tooltip=document.createElement('div');el._tooltip.style.position='absolute';el._tooltip.style.top='100%';el._tooltip.style.left='0';el._tooltip.style.zIndex=9999;el._tooltip.style.background='#232b3a';el._tooltip.style.color='#fff';el._tooltip.style.padding='0.5em 1em';el._tooltip.style.borderRadius='8px';el._tooltip.style.fontSize='0.98em';el._tooltip.innerText=`${e.name}\\nOwner: ${linkedAccount||'Unassigned'}`;el.appendChild(el._tooltip);},onMouseLeave:ev=>{const el=ev.currentTarget;if(el._tooltip)el.removeChild(el._tooltip);},onClick:()=>setEmpirePage(e.name),children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5em'},children:[renderAvatar(e.name),/*#__PURE__*/_jsx(\"h3\",{className:\"empire-info-title\",style:{margin:0,color:'var(--accent)',textAlign:'center'},children:e.name})]}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#b3cfff',fontWeight:500,fontSize:'1.05em',textAlign:'center',marginBottom:'0.5rem'},children:linkedAccount?/*#__PURE__*/_jsx(\"span\",{title:\"Assigned Account\",children:linkedAccount}):/*#__PURE__*/_jsx(\"i\",{children:\"Unassigned\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"empire-actions\",style:{display:'flex',gap:'0.5rem',marginTop:'0.5rem',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",style:{minWidth:80},onClick:ev=>{ev.stopPropagation();setEmpirePage(e.name);},children:\"View\"}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",onClick:ev=>{ev.stopPropagation();handleCopyEmpire(e);},title:\"Copy empire\",children:\"Copy\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{minWidth:80},onClick:ev=>{ev.stopPropagation();setEditEmpire(e.name);},children:\"Edit\"}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",style:{background:'#0090c0'},onClick:ev=>{ev.stopPropagation();handleRenameEmpire(e.name);},children:\"Rename\"})]})]},e.name);})}),empireTotalPages>1&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'0.7em',justifyContent:'center',marginTop:'1em'},children:[/*#__PURE__*/_jsx(\"button\",{disabled:empirePageNum===1,onClick:()=>setEmpirePageNum(empirePageNum-1),children:\"Prev\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Page \",empirePageNum,\" / \",empireTotalPages]}),/*#__PURE__*/_jsx(\"button\",{disabled:empirePageNum===empireTotalPages,onClick:()=>setEmpirePageNum(empirePageNum+1),children:\"Next\"})]})]}):/*#__PURE__*/_jsx(_Fragment,{children:!account?/*#__PURE__*/_jsxs(\"section\",{className:\"account-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"login-title\",children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"account-form login-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"login-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Empire name\",value:loginUser,onChange:e=>setLoginUser(e.target.value),required:true,disabled:!accountsLoaded,className:\"login-input\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:loginPass,onChange:e=>setLoginPass(e.target.value),required:true,disabled:!accountsLoaded,className:\"login-input\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!accountsLoaded,className:\"login-btn\",children:\"Login\"})]}),!accountsLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",children:\"Loading accounts...\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:error})]}):/*#__PURE__*/// Center the channels page\n_jsx(\"div\",{style:{display:'flex',justifyContent:'center',width:'100%'},children:/*#__PURE__*/_jsx(\"section\",{className:\"boards-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"channels-main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"channels-sidebar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"boards-list card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:account&&account.username===\"GameMaster\"?\"All Boards\":\"Your Diplomatic Channels\"}),/*#__PURE__*/_jsx(\"div\",{className:\"boards-list-header\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"boards-list-count\",children:[filteredBoards.length,\" \",filteredBoards.length===1?\"channel\":\"channels\"]})}),/*#__PURE__*/_jsxs(\"ul\",{className:\"boards-list-ul\",children:[filteredBoards.length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"no-channels\",children:\"No channels available.\"}),filteredBoards.map(_ref4=>{let[a,b]=_ref4;const key=a+'|'+b;return/*#__PURE__*/_jsx(\"li\",{className:`boards-list-item${selected===key?' active':''}`,children:/*#__PURE__*/_jsxs(\"button\",{className:\"board-btn\",onClick:()=>handleBoardSelect([a,b]),children:[/*#__PURE__*/_jsx(\"span\",{className:\"board-nations\",children:a}),/*#__PURE__*/_jsx(\"span\",{className:\"board-arrow\",children:\"\\u2194\"}),/*#__PURE__*/_jsx(\"span\",{className:\"board-nations\",children:b})]})},key);})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"channels-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"board-messages card\",children:selected&&filteredBoards.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"board-messages-inner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"board-title-row\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"board-title\",children:selected.replace('|',' â†” ')})}),/*#__PURE__*/_jsxs(\"div\",{className:\"messages-panel\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messages-list-container\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"messages-list\",children:[(messages[selected]||[]).length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"no-messages\",children:\"No messages yet.\"}),(messages[selected]||[]).map((msg,i)=>{const[partnerA,partnerB]=selected.split('|');let partnerClass='';if(msg.author===partnerA)partnerClass='message-partnerA';else if(msg.author===partnerB)partnerClass='message-partnerB';return/*#__PURE__*/_jsxs(\"li\",{className:`message-item ${partnerClass}`,style:{display:'flex',alignItems:'stretch',justifyContent:'flex-start',gap:'0.7rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,minWidth:0,display:'flex',flexDirection:'column',gap:'0.15rem',justifyContent:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-meta\",style:{marginBottom:0},children:[/*#__PURE__*/_jsx(\"span\",{className:\"message-author\",children:msg.author}),/*#__PURE__*/_jsx(\"small\",{className:\"message-date\",children:new Date(msg.timestamp).toLocaleString()})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-text\",children:msg.text})]}),account&&account.username===\"GameMaster\"&&gmPermissions.canDeleteMessages&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',minWidth:'2.5em',paddingLeft:'0.5em'},children:/*#__PURE__*/_jsx(\"button\",{title:\"Delete message\",style:{background:'none',border:'none',color:'#ff4d4d',cursor:'pointer',fontSize:'1.3em',display:'flex',alignItems:'center',height:'2.2em'},onClick:e=>{e.stopPropagation();handleDeleteMessage(selected,i);},children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Delete\",children:\"\\uD83D\\uDDD1\"})})})]},i);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:postMessage,className:\"message-form message-form-bottom\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Your empire\",value:account.username,disabled:true,required:true,className:\"author-input\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Message\",value:text,onChange:e=>setText(e.target.value),required:true,className:\"text-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"send-btn\",children:\"Send\"})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-messages\",children:\"Select a channel to view messages.\"})})})]})})})})}),/*#__PURE__*/_jsx(\"footer\",{className:\"footer\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"Stellaris RP Board \\xA9 \",new Date().getFullYear()]})})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getNationPairs","nations","pairs","i","length","j","push","App","empires","setEmpires","selected","setSelected","saved","localStorage","getItem","messages","setMessages","text","setText","pollingRef","messagesEndRef","accounts","setAccounts","accountsLoaded","setAccountsLoaded","account","setAccount","JSON","parse","loginUser","setLoginUser","loginPass","setLoginPass","error","setError","activeTab","setActiveTab","empirePage","setEmpirePage","editEmpire","setEditEmpire","empireInfo","setEmpireInfo","empireInfoLoaded","setEmpireInfoLoaded","newAccountName","setNewAccountName","newAccountPass","setNewAccountPass","accountError","setAccountError","accountSuccess","setAccountSuccess","accountsTabLoading","setAccountsTabLoading","editAccount","setEditAccount","editAccountName","setEditAccountName","editAccountPass","setEditAccountPass","editAccountError","setEditAccountError","editAccountLoading","setEditAccountLoading","newEmpireName","setNewEmpireName","newEmpireError","setNewEmpireError","newEmpireLoading","setNewEmpireLoading","treaties","setTreaties","treatiesLoaded","setTreatiesLoaded","treatyDialog","setTreatyDialog","open","mode","data","treatyError","setTreatyError","treatySaving","setTreatySaving","fetchTreaties","fetch","Date","now","then","res","json","Array","isArray","catch","openTreatyDialog","arguments","undefined","closeTreatyDialog","handleTreatySave","form","_payload$participants","payload","title","content","participants","owner","username","status","id","toString","method","headers","body","stringify","success","prev","idx","findIndex","t","updated","finally","handleTreatyTransferOwner","newOwner","canEditTreaty","treaty","canTransferTreaty","TreatyDialog","_ref","onSave","onClose","saving","setForm","showParticipantsDropdown","setShowParticipantsDropdown","dropdownBtnRef","dropdownListRef","handleClick","e","current","contains","target","document","addEventListener","removeEventListener","handleKey","key","isEdit","statuses","value","label","toggleParticipant","name","f","exists","includes","filter","p","className","children","onSubmit","preventDefault","onChange","required","disabled","map","s","style","position","ref","tabIndex","userSelect","background","border","borderRadius","padding","minHeight","cursor","marginBottom","display","alignItems","justifyContent","onMouseDown","onClick","v","color","overflow","textOverflow","whiteSpace","flex","join","marginLeft","fontSize","pointerEvents","left","right","top","zIndex","boxShadow","minWidth","flexDirection","gap","maxHeight","overflowY","stopPropagation","role","type","textAlign","transition","width","backgroundColor","ev","height","marginRight","checked","readOnly","accentColor","margin","fontWeight","Object","keys","acc","rows","TreatyView","_ref2","_treaty$participants","onBack","onEdit","onTransfer","canEdit","canTransfer","discussion","active","broken","expired","other","maxWidth","showAccountsTab","tabs","treatySearch","setTreatySearch","treatySort","setTreatySort","treatySortDir","setTreatySortDir","treatyPage","setTreatyPage","TREATIES_PER_PAGE","empireSearch","setEmpireSearch","empireSort","setEmpireSort","empireSortDir","setEmpireSortDir","empirePageNum","setEmpirePageNum","EMPIRES_PER_PAGE","handleDeleteTreaty","window","confirm","handleExportTreaties","blob","Blob","url","URL","createObjectURL","a","createElement","href","download","click","revokeObjectURL","handleCopyTreaty","navigator","clipboard","writeText","alert","handleExportEmpires","handleCopyEmpire","empire","handleRenameEmpire","newName","prompt","renderAvatar","initials","split","w","slice","toUpperCase","lineHeight","Tooltip","_ref3","filteredTreaties","_t$owner","toLowerCase","some","sort","b","vA","vB","treatyTotalPages","Math","max","ceil","treatyPageTreaties","filteredEmpires","empireTotalPages","empirePageEmpires","showMenu","setShowMenu","showPermissions","setShowPermissions","menuDropdownRef","permissionsDropdownRef","handleMenuToggle","handleMenuClose","handlePermissionsToggle","handlePermissionChange","setGmPermissions","handleShowAbout","handleShowTheme","handleMouseMove","tab","handleLogout","gmPermissions","canDeleteMessages","placeholder","d","onMouseEnter","el","currentTarget","_tooltip","innerText","appendChild","onMouseLeave","removeChild","marginTop","EmpireEditPanel","onCancel","EmpirePanel","flexWrap","linkedAccount","getEmpireAccount","handleLogin","filteredBoards","_ref4","handleBoardSelect","replace","msg","partnerA","partnerB","partnerClass","author","timestamp","toLocaleString","paddingLeft","handleDeleteMessage","postMessage","getFullYear"],"sources":["C:/Users/Admin/Dokumente/Stellaris/project/StellarisRP-Site/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport './App.css';\r\nimport './Treaties.css';\r\nimport './Empires.css';\r\nimport './Boards.css';\r\nimport './Accounts.css';\r\n\r\nfunction getNationPairs(nations) {\r\n    const pairs = [];\r\n    for (let i = 0; i < nations.length; i++) {\r\n        for (let j = i + 1; j < nations.length; j++) {\r\n            pairs.push([nations[i], nations[j]]);\r\n        }\r\n    }\r\n    return pairs;\r\n}\r\n\r\nfunction App() {\r\n    // Remove unused empireInput, selectedNation, author\r\n    const [empires, setEmpires] = useState([]);\r\n    const [selected, setSelected] = useState(() => {\r\n        const saved = localStorage.getItem('stellarisSelectedBoard');\r\n        return saved ? saved : null;\r\n    });\r\n    const [messages, setMessages] = useState({});\r\n    const [text, setText] = useState('');\r\n    const pollingRef = useRef();\r\n    const messagesEndRef = useRef(null);\r\n    const [accounts, setAccounts] = useState({});\r\n    const [accountsLoaded, setAccountsLoaded] = useState(false);\r\n    const [account, setAccount] = useState(() => {\r\n        const saved = localStorage.getItem('stellarisAccount');\r\n        return saved ? JSON.parse(saved) : null;\r\n    });\r\n    const [loginUser, setLoginUser] = useState('');\r\n    const [loginPass, setLoginPass] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [activeTab, setActiveTab] = useState('channels');\r\n    const [empirePage, setEmpirePage] = useState(null);\r\n    const [editEmpire, setEditEmpire] = useState(null);\r\n    const [empireInfo, setEmpireInfo] = useState({});\r\n    const [empireInfoLoaded, setEmpireInfoLoaded] = useState(false);\r\n\r\n    // Account creation and management\r\n    const [newAccountName, setNewAccountName] = useState('');\r\n    const [newAccountPass, setNewAccountPass] = useState('');\r\n    const [accountError, setAccountError] = useState('');\r\n    const [accountSuccess, setAccountSuccess] = useState('');\r\n    const [accountsTabLoading, setAccountsTabLoading] = useState(false);\r\n    const [editAccount, setEditAccount] = useState(null);\r\n    const [editAccountName, setEditAccountName] = useState('');\r\n    const [editAccountPass, setEditAccountPass] = useState('');\r\n    const [editAccountError, setEditAccountError] = useState('');\r\n    const [editAccountLoading, setEditAccountLoading] = useState(false);\r\n\r\n    // Manage Empires tab\r\n    const [newEmpireName, setNewEmpireName] = useState('');\r\n    const [newEmpireError, setNewEmpireError] = useState('');\r\n    const [newEmpireLoading, setNewEmpireLoading] = useState(false);\r\n\r\n    // --- Treaties State (NEW IMPLEMENTATION) ---\r\n    const [treaties, setTreaties] = useState([]);\r\n    const [treatiesLoaded, setTreatiesLoaded] = useState(false);\r\n    const [treatyDialog, setTreatyDialog] = useState({ open: false, mode: null, data: null });\r\n    const [treatyError, setTreatyError] = useState('');\r\n    const [treatySaving, setTreatySaving] = useState(false);\r\n\r\n    // --- Fetch treaties ---\r\n    function fetchTreaties() {\r\n        fetch('/treaties.json?ts=' + Date.now())\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setTreaties(Array.isArray(data) ? data : []);\r\n                setTreatiesLoaded(true);\r\n            })\r\n            .catch(() => setTreatiesLoaded(true));\r\n    }\r\n    useEffect(() => { fetchTreaties(); }, []);\r\n\r\n    // --- Treaty CRUD ---\r\n    function openTreatyDialog(mode, data = null) {\r\n        setTreatyDialog({ open: true, mode, data });\r\n        setTreatyError('');\r\n    }\r\n    function closeTreatyDialog() {\r\n        setTreatyDialog({ open: false, mode: null, data: null });\r\n        setTreatyError('');\r\n    }\r\n    function handleTreatySave(form) {\r\n        setTreatySaving(true);\r\n        setTreatyError('');\r\n        const payload = { ...form };\r\n        if (!payload.title || !payload.content || !payload.participants?.length) {\r\n            setTreatyError('Title, content, and at least one participant are required.');\r\n            setTreatySaving(false);\r\n            return;\r\n        }\r\n        if (!payload.owner) payload.owner = account?.username || '';\r\n        if (!payload.status) payload.status = 'discussion';\r\n        if (!payload.id) payload.id = Date.now().toString();\r\n\r\n        fetch('/api/treaties', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload)\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                // --- FIX: update treaties state locally, just like accounts ---\r\n                setTreaties(prev => {\r\n                    // If editing, replace; if new, add\r\n                    const idx = prev.findIndex(t => t.id === payload.id);\r\n                    if (idx !== -1) {\r\n                        const updated = [...prev];\r\n                        updated[idx] = { ...prev[idx], ...payload };\r\n                        return updated;\r\n                    } else {\r\n                        return [...prev, payload];\r\n                    }\r\n                });\r\n                closeTreatyDialog();\r\n            } else {\r\n                setTreatyError(data.error || 'Failed to save treaty');\r\n            }\r\n        })\r\n        .catch(() => setTreatyError('Failed to save treaty'))\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n    function handleTreatyTransferOwner(id, newOwner) {\r\n        setTreatySaving(true);\r\n        fetch('/api/treaties/transfer', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ id, newOwner })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) fetchTreaties();\r\n        })\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n\r\n    // --- Treaty Permissions ---\r\n    function canEditTreaty(treaty) {\r\n        if (!account) return false;\r\n        return account.username === treaty.owner || account.username === \"GameMaster\";\r\n    }\r\n    function canTransferTreaty(treaty) {\r\n        return account && account.username === \"GameMaster\";\r\n    }\r\n\r\n    // --- Treaty Dialog UI ---\r\n    function TreatyDialog({ open, mode, data, onSave, onClose, error, saving, empires, accounts }) {\r\n        const [form, setForm] = useState(() => data ? { ...data } : {\r\n            title: '', content: '', participants: [], status: 'discussion', owner: account?.username || ''\r\n        });\r\n        const [showParticipantsDropdown, setShowParticipantsDropdown] = useState(false);\r\n        const dropdownBtnRef = useRef(null);\r\n        const dropdownListRef = useRef(null);\r\n\r\n        useEffect(() => {\r\n            if (data) setForm({ ...data });\r\n            else setForm({ title: '', content: '', participants: [], status: 'discussion', owner: account?.username || '' });\r\n        }, [data, open]);\r\n\r\n        // --- Dropdown close on outside click ---\r\n        useEffect(() => {\r\n            if (!showParticipantsDropdown) return;\r\n            function handleClick(e) {\r\n                if (\r\n                    dropdownBtnRef.current &&\r\n                    !dropdownBtnRef.current.contains(e.target) &&\r\n                    dropdownListRef.current &&\r\n                    !dropdownListRef.current.contains(e.target)\r\n                ) {\r\n                    setShowParticipantsDropdown(false);\r\n                }\r\n            }\r\n            document.addEventListener('mousedown', handleClick);\r\n            return () => document.removeEventListener('mousedown', handleClick);\r\n        }, [showParticipantsDropdown]);\r\n\r\n        // Keyboard navigation: close dropdown on Escape\r\n        useEffect(() => {\r\n            if (!showParticipantsDropdown) return;\r\n            function handleKey(e) {\r\n                if (e.key === \"Escape\") setShowParticipantsDropdown(false);\r\n            }\r\n            document.addEventListener('keydown', handleKey);\r\n            return () => document.removeEventListener('keydown', handleKey);\r\n        }, [showParticipantsDropdown]);\r\n\r\n        if (!open) return null;\r\n\r\n        const isEdit = mode === 'edit';\r\n        const statuses = [\r\n            { value: 'discussion', label: 'ðŸ—¨ï¸ In Discussion' },\r\n            { value: 'active', label: 'âœ… Active' },\r\n            { value: 'broken', label: 'âŒ Broken' },\r\n            { value: 'expired', label: 'âŒ› Expired' },\r\n            { value: 'other', label: 'â“ Other' }\r\n        ];\r\n\r\n        // Helper for participants dropdown\r\n        function toggleParticipant(name) {\r\n            setForm(f => {\r\n                const exists = f.participants.includes(name);\r\n                return {\r\n                    ...f,\r\n                    participants: exists\r\n                        ? f.participants.filter(p => p !== name)\r\n                        : [...f.participants, name]\r\n                };\r\n            });\r\n        }\r\n\r\n        return (\r\n            <div className=\"treaty-dialog-overlay\">\r\n                <div className=\"treaty-dialog\">\r\n                    <h2>{isEdit ? 'Edit Treaty' : 'New Treaty'}</h2>\r\n                    <form onSubmit={e => { e.preventDefault(); onSave(form); }}>\r\n                        <label>\r\n                            Title:\r\n                            <input\r\n                                value={form.title}\r\n                                onChange={e => setForm(f => ({ ...f, title: e.target.value }))}\r\n                                required\r\n                                disabled={saving}\r\n                            />\r\n                        </label>\r\n                        <label>\r\n                            Status:\r\n                            <select\r\n                                value={form.status}\r\n                                onChange={e => setForm(f => ({ ...f, status: e.target.value }))}\r\n                                disabled={saving}\r\n                            >\r\n                                {statuses.map(s => (\r\n                                    <option key={s.value} value={s.value}>{s.label}</option>\r\n                                ))}\r\n                            </select>\r\n                        </label>\r\n                        <label style={{ position: 'relative' }}>\r\n                            Participants:\r\n                            <div\r\n                                className=\"participants-dropdown\"\r\n                                ref={dropdownBtnRef}\r\n                                tabIndex={0}\r\n                                style={{\r\n                                    userSelect: 'none',\r\n                                    background: 'var(--primary-bg)',\r\n                                    border: '1px solid var(--border)',\r\n                                    borderRadius: 8,\r\n                                    padding: '0.7rem 1rem',\r\n                                    minHeight: '2.2rem',\r\n                                    cursor: saving ? 'not-allowed' : 'pointer',\r\n                                    marginBottom: '0.7rem',\r\n                                    position: 'relative',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'space-between'\r\n                                }}\r\n                                // Prevent the first click from toggling the first item\r\n                                onMouseDown={e => e.preventDefault()}\r\n                                onClick={e => {\r\n                                    if (!saving) setShowParticipantsDropdown(v => !v);\r\n                                }}\r\n                                aria-haspopup=\"listbox\"\r\n                                aria-expanded={showParticipantsDropdown}\r\n                            >\r\n                                <span style={{\r\n                                    color: form.participants.length ? 'var(--text)' : '#aaa',\r\n                                    overflow: 'hidden',\r\n                                    textOverflow: 'ellipsis',\r\n                                    whiteSpace: 'nowrap',\r\n                                    flex: 1\r\n                                }}>\r\n                                    {form.participants.length\r\n                                        ? form.participants.join(', ')\r\n                                        : 'Select participants...'}\r\n                                </span>\r\n                                <span style={{ marginLeft: 8, color: '#aaa', fontSize: '1.1em', pointerEvents: 'none' }}>â–¼</span>\r\n                            </div>\r\n                            {showParticipantsDropdown && (\r\n                                <div\r\n                                    className=\"participants-dropdown-list\"\r\n                                    ref={dropdownListRef}\r\n                                    style={{\r\n                                        position: 'absolute',\r\n                                        left: 0,\r\n                                        right: 0,\r\n                                        top: 'calc(100% + 8px)',\r\n                                        zIndex: 1001,\r\n                                        background: 'var(--card-bg)',\r\n                                        border: '1.5px solid var(--accent)',\r\n                                        borderRadius: 10,\r\n                                        boxShadow: '0 4px 24px #0005',\r\n                                        minWidth: 210,\r\n                                        padding: '0.3rem 0',\r\n                                        display: 'flex',\r\n                                        flexDirection: 'column',\r\n                                        gap: '0.2rem',\r\n                                        maxHeight: 220,\r\n                                        overflowY: 'auto'\r\n                                    }}\r\n                                    onClick={e => e.stopPropagation()}\r\n                                    role=\"listbox\"\r\n                                >\r\n                                    {empires.map((e, idx) => (\r\n                                        <button\r\n                                            key={e}\r\n                                            type=\"button\"\r\n                                            className=\"participants-dropdown-item\"\r\n                                            style={{\r\n                                                background: 'none',\r\n                                                border: 'none',\r\n                                                color: 'var(--accent)',\r\n                                                fontSize: '1.08rem',\r\n                                                textAlign: 'left',\r\n                                                padding: '0.7rem 1.2rem',\r\n                                                cursor: saving ? 'not-allowed' : 'pointer',\r\n                                                borderRadius: 7,\r\n                                                transition: 'background 0.15s, color 0.15s',\r\n                                                width: '100%',\r\n                                                display: 'flex',\r\n                                                alignItems: 'center',\r\n                                                gap: '0.7em',\r\n                                                position: 'relative',\r\n                                                backgroundColor: form.participants.includes(e) ? 'rgba(0,191,255,0.10)' : 'transparent'\r\n                                            }}\r\n                                            tabIndex={-1}\r\n                                            // Prevent the first click after opening from toggling the first item\r\n                                            onMouseDown={ev => ev.preventDefault()}\r\n                                            onClick={ev => {\r\n                                                ev.stopPropagation();\r\n                                                if (!saving) toggleParticipant(e);\r\n                                            }}\r\n                                        >\r\n                                            <span style={{\r\n                                                display: 'inline-flex',\r\n                                                alignItems: 'center',\r\n                                                justifyContent: 'center',\r\n                                                width: 22,\r\n                                                height: 22,\r\n                                                borderRadius: 5,\r\n                                                border: '1.5px solid var(--accent)',\r\n                                                background: form.participants.includes(e) ? 'var(--accent)' : 'var(--primary-bg)',\r\n                                                marginRight: 10,\r\n                                                transition: 'background 0.15s, border 0.15s'\r\n                                            }}>\r\n                                                <input\r\n                                                    type=\"checkbox\"\r\n                                                    checked={form.participants.includes(e)}\r\n                                                    readOnly\r\n                                                    tabIndex={-1}\r\n                                                    style={{\r\n                                                        accentColor: 'var(--accent)',\r\n                                                        width: 18,\r\n                                                        height: 18,\r\n                                                        margin: 0,\r\n                                                        pointerEvents: 'none'\r\n                                                    }}\r\n                                                />\r\n                                            </span>\r\n                                            <span style={{\r\n                                                color: form.participants.includes(e) ? '#fff' : 'var(--accent)',\r\n                                                fontWeight: form.participants.includes(e) ? 600 : 400,\r\n                                                flex: 1,\r\n                                                textAlign: 'left'\r\n                                            }}>\r\n                                                {e}\r\n                                            </span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </label>\r\n                        {account?.username === \"GameMaster\" && (\r\n                            <label>\r\n                                Owner:\r\n                                <select\r\n                                    value={form.owner}\r\n                                    onChange={e => setForm(f => ({ ...f, owner: e.target.value }))}\r\n                                    disabled={saving}\r\n                                >\r\n                                    {Object.keys(accounts).map(acc => (\r\n                                        <option key={acc} value={acc}>{acc}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </label>\r\n                        )}\r\n                        <label>\r\n                            Content:\r\n                            <textarea\r\n                                value={form.content}\r\n                                onChange={e => setForm(f => ({ ...f, content: e.target.value }))}\r\n                                rows={7}\r\n                                required\r\n                                disabled={saving}\r\n                            />\r\n                        </label>\r\n                        {error && <div className=\"login-error treaty-error\">{error}</div>}\r\n                        <div className=\"treaty-form-actions\">\r\n                            <button type=\"submit\" className=\"empire-save-btn\" disabled={saving}>\r\n                                {isEdit ? \"Save Changes\" : \"Create Treaty\"}\r\n                            </button>\r\n                            <button type=\"button\" className=\"empire-back-btn\" onClick={onClose} disabled={saving}>Cancel</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- Treaty View UI ---\r\n    function TreatyView({ treaty, onBack, onEdit, onTransfer, canEdit, canTransfer, accounts }) {\r\n        if (!treaty) return null;\r\n        const statuses = {\r\n            discussion: 'ðŸ—¨ï¸ In Discussion',\r\n            active: 'âœ… Active',\r\n            broken: 'âŒ Broken',\r\n            expired: 'âŒ› Expired',\r\n            other: 'â“ Other'\r\n        };\r\n        return (\r\n            <div className=\"treaty-dialog-overlay\">\r\n                <div className=\"treaty-dialog\">\r\n                    <h2>{treaty.title}</h2>\r\n                    <div><b>Status:</b> {statuses[treaty.status] || treaty.status}</div>\r\n                    <div><b>Owner:</b> {treaty.owner}</div>\r\n                    <div><b>Participants:</b> {treaty.participants?.join(', ') || <i>None</i>}</div>\r\n                    <div style={{margin: '1em 0', whiteSpace: 'pre-line'}}>{treaty.content}</div>\r\n                    <div className=\"treaty-form-actions\">\r\n                        <button className=\"empire-back-btn\" style={{minWidth: 110, maxWidth: 160}} onClick={onBack}>Back</button>\r\n                        {canEdit && <button className=\"empire-save-btn\" style={{minWidth: 110, maxWidth: 160}} onClick={onEdit}>Edit</button>}\r\n                        {/* The owner transfer dropdown is intentionally removed from view mode */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- Add tabs definition ---\r\n    const showAccountsTab = account && account.username === \"GameMaster\";\r\n    const tabs = [\r\n        { key: 'channels', label: 'Channels' },\r\n        { key: 'empires', label: 'Empires' },\r\n        { key: 'treaties', label: 'Treaties' }\r\n    ];\r\n    if (showAccountsTab) {\r\n        tabs.push({ key: 'accounts', label: 'Manage Accounts' });\r\n        tabs.push({ key: 'manage-empires', label: 'Manage Empires' });\r\n    }\r\n\r\n    // --- Remove all treatyForm/treatyEditId/treatyViewId/setTreatyForm/setTreatyEditId/setTreatyViewId/setShowTreatyForm ---\r\n\r\n    // --- Treaty Search/Filter/Sort/Pagination ---\r\n    const [treatySearch, setTreatySearch] = useState('');\r\n    const [treatySort, setTreatySort] = useState('title');\r\n    const [treatySortDir, setTreatySortDir] = useState('asc');\r\n    const [treatyPage, setTreatyPage] = useState(1);\r\n    const TREATIES_PER_PAGE = 7;\r\n\r\n    // --- Empire Search/Filter/Sort/Pagination ---\r\n    const [empireSearch, setEmpireSearch] = useState('');\r\n    const [empireSort, setEmpireSort] = useState('name');\r\n    const [empireSortDir, setEmpireSortDir] = useState('asc');\r\n    const [empirePageNum, setEmpirePageNum] = useState(1);\r\n    const EMPIRES_PER_PAGE = 8;\r\n\r\n    // --- Treaty Delete (GM only) ---\r\n    function handleDeleteTreaty(id) {\r\n        if (!account || account.username !== \"GameMaster\") return;\r\n        if (!window.confirm(\"Delete this treaty?\")) return;\r\n        fetch('/api/treaties/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ id })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) fetchTreaties();\r\n        });\r\n    }\r\n\r\n    // --- Treaty Export/Copy ---\r\n    function handleExportTreaties() {\r\n        const blob = new Blob([JSON.stringify(treaties, null, 2)], { type: 'application/json' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = 'treaties.json';\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n    }\r\n    function handleCopyTreaty(treaty) {\r\n        navigator.clipboard.writeText(JSON.stringify(treaty, null, 2));\r\n        alert('Treaty copied to clipboard!');\r\n    }\r\n\r\n    // --- Empire Export/Copy/Rename ---\r\n    function handleExportEmpires() {\r\n        const blob = new Blob([JSON.stringify(empires, null, 2)], { type: 'application/json' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = 'empires.json';\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n    }\r\n    function handleCopyEmpire(empire) {\r\n        navigator.clipboard.writeText(JSON.stringify(empire, null, 2));\r\n        alert('Empire copied to clipboard!');\r\n    }\r\n    // Empire rename (GM only)\r\n    function handleRenameEmpire(name) {\r\n        const newName = prompt('Enter new name for empire:', name);\r\n        if (!newName || newName === name) return;\r\n        fetch('/api/empires/rename', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, newName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev => prev.map(e => e.name === name ? { ...e, name: newName } : e));\r\n                setEmpireInfo(prev => {\r\n                    const updated = { ...prev };\r\n                    if (updated[name]) {\r\n                        updated[newName] = updated[name];\r\n                        delete updated[name];\r\n                    }\r\n                    return updated;\r\n                });\r\n            } else {\r\n                alert(data.error || 'Rename failed');\r\n            }\r\n        });\r\n    }\r\n\r\n    // --- Treaty/Empire Avatars ---\r\n    function renderAvatar(name) {\r\n        // Simple initials avatar\r\n        const initials = name.split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();\r\n        return (\r\n            <span style={{\r\n                display: 'inline-block',\r\n                background: 'var(--accent)',\r\n                color: '#fff',\r\n                borderRadius: '50%',\r\n                width: 28,\r\n                height: 28,\r\n                textAlign: 'center',\r\n                lineHeight: '28px',\r\n                fontWeight: 700,\r\n                marginRight: 7,\r\n                fontSize: '1em'\r\n            }}>{initials}</span>\r\n        );\r\n    }\r\n\r\n    // --- Treaty/Empire Tooltips ---\r\n    function Tooltip({ text }) {\r\n        return (\r\n            <span style={{\r\n                position: 'absolute',\r\n                background: '#232b3a',\r\n                color: '#fff',\r\n                padding: '0.5em 1em',\r\n                borderRadius: 8,\r\n                fontSize: '0.98em',\r\n                zIndex: 9999,\r\n                boxShadow: '0 2px 8px #0005',\r\n                top: '110%',\r\n                left: 0,\r\n                whiteSpace: 'pre-line'\r\n            }}>{text}</span>\r\n        );\r\n    }\r\n\r\n    // --- Treaty Filter/Sort/Pagination ---\r\n    const filteredTreaties = treaties\r\n        .filter(t =>\r\n            t.title.toLowerCase().includes(treatySearch.toLowerCase()) ||\r\n            t.owner?.toLowerCase().includes(treatySearch.toLowerCase()) ||\r\n            (t.participants || []).some(p => p.toLowerCase().includes(treatySearch.toLowerCase()))\r\n        )\r\n        .sort((a, b) => {\r\n            let vA = a[treatySort] || '';\r\n            let vB = b[treatySort] || '';\r\n            if (typeof vA === 'string') vA = vA.toLowerCase();\r\n            if (typeof vB === 'string') vB = vB.toLowerCase();\r\n            if (vA < vB) return treatySortDir === 'asc' ? -1 : 1;\r\n            if (vA > vB) return treatySortDir === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n    const treatyTotalPages = Math.max(1, Math.ceil(filteredTreaties.length / TREATIES_PER_PAGE));\r\n    const treatyPageTreaties = filteredTreaties.slice((treatyPage-1)*TREATIES_PER_PAGE, treatyPage*TREATIES_PER_PAGE);\r\n\r\n    // --- Empire Filter/Sort/Pagination ---\r\n    const filteredEmpires = empires\r\n        .filter(e =>\r\n            e.name.toLowerCase().includes(empireSearch.toLowerCase()) ||\r\n            (e.account || '').toLowerCase().includes(empireSearch.toLowerCase())\r\n        )\r\n        .sort((a, b) => {\r\n            let vA = a[empireSort] || '';\r\n            let vB = b[empireSort] || '';\r\n            if (typeof vA === 'string') vA = vA.toLowerCase();\r\n            if (typeof vB === 'string') vB = vB.toLowerCase();\r\n            if (vA < vB) return empireSortDir === 'asc' ? -1 : 1;\r\n            if (vA > vB) return empireSortDir === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n    const empireTotalPages = Math.max(1, Math.ceil(filteredEmpires.length / EMPIRES_PER_PAGE));\r\n    const empirePageEmpires = filteredEmpires.slice((empirePageNum-1)*EMPIRES_PER_PAGE, empirePageNum*EMPIRES_PER_PAGE);\r\n\r\n    // --- Restore menu handlers ---\r\n    const [showMenu, setShowMenu] = useState(false);\r\n    const [showPermissions, setShowPermissions] = useState(false);\r\n    const menuDropdownRef = useRef(null);\r\n    const permissionsDropdownRef = useRef(null);\r\n\r\n    function handleMenuToggle() {\r\n        setShowMenu(v => !v);\r\n        setShowPermissions(false);\r\n    }\r\n    function handleMenuClose() {\r\n        setShowMenu(false);\r\n        setShowPermissions(false);\r\n    }\r\n    function handlePermissionsToggle() {\r\n        setShowPermissions(v => !v);\r\n    }\r\n    function handlePermissionChange(key, value) {\r\n        setGmPermissions(prev => ({ ...prev, [key]: value }));\r\n    }\r\n    function handleShowAbout() {\r\n        alert(\"Stellaris RP Board\\n\\nCreated for roleplay and diplomacy.\\n\\nContact: admin@example.com\");\r\n        handleMenuClose();\r\n    }\r\n    function handleShowTheme() {\r\n        alert(\"Theme switcher coming soon!\");\r\n        handleMenuClose();\r\n    }\r\n\r\n    // --- Restore menu close on outside click ---\r\n    useEffect(() => {\r\n        if (!showMenu && !showPermissions) return;\r\n        function handleMouseMove(e) {\r\n            if (\r\n                menuDropdownRef.current &&\r\n                permissionsDropdownRef.current &&\r\n                !menuDropdownRef.current.contains(e.target) &&\r\n                !permissionsDropdownRef.current.contains(e.target)\r\n            ) {\r\n                setShowMenu(false);\r\n                setShowPermissions(false);\r\n            }\r\n        }\r\n        document.addEventListener('mousedown', handleMouseMove);\r\n        return () => document.removeEventListener('mousedown', handleMouseMove);\r\n    }, [showMenu, showPermissions]);\r\n\r\n    return (\r\n        <div className=\"app-container\">\r\n            <header className=\"header\">\r\n                <h1>Stellaris RP Diplomatic Message Boards</h1>\r\n                <div className=\"tabs-bar\">\r\n                    {tabs.map(tab => (\r\n                        <button\r\n                            key={tab.key}\r\n                            className={`tab-btn${activeTab === tab.key ? ' active' : ''}`}\r\n                            onClick={() => {\r\n                                setActiveTab(tab.key);\r\n                                setEmpirePage(null);\r\n                                setEditEmpire(null);\r\n                                setEditAccount(null);\r\n                                // Remove these obsolete calls:\r\n                                // setTreatyEditId(null);\r\n                                // setTreatyViewId(null);\r\n                                // setShowTreatyForm(false);\r\n                                // Only close treaty dialog:\r\n                                setTreatyDialog({ open: false, mode: null, data: null });\r\n                                setTreatyError('');\r\n                            }}\r\n                        >\r\n                            {tab.label}\r\n                        </button>\r\n                    ))}\r\n                    {/* --- Hamburger menu at top right --- */}\r\n                    <div className=\"menu-dropdown-container\">\r\n                        <button\r\n                            className=\"menu-btn\"\r\n                            aria-label=\"Open menu\"\r\n                            onClick={handleMenuToggle}\r\n                        >\r\n                            <span className=\"menu-icon\">&#9776;</span>\r\n                        </button>\r\n                        {showMenu && (\r\n                            <div\r\n                                className=\"menu-dropdown\"\r\n                                ref={menuDropdownRef}\r\n                            >\r\n                                <button className=\"menu-dropdown-item logout-btn\" onClick={handleLogout}>\r\n                                    <span className=\"logout-icon\">&#x1F511;</span> Logout\r\n                                </button>\r\n                                <button className=\"menu-dropdown-item\" onClick={handleShowAbout}>\r\n                                    About\r\n                                </button>\r\n                                <button className=\"menu-dropdown-item\" onClick={handleShowTheme}>\r\n                                    Theme Switcher\r\n                                </button>\r\n                                {account && account.username === \"GameMaster\" && (\r\n                                    <button className=\"menu-dropdown-item\" onClick={handlePermissionsToggle}>\r\n                                        Manage Permissions\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                        {showPermissions && (\r\n                            <div\r\n                                className=\"menu-permissions-dropdown\"\r\n                                ref={permissionsDropdownRef}\r\n                            >\r\n                                <div className=\"menu-permissions-title\">GameMaster Permissions</div>\r\n                                <label className=\"menu-permissions-option\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={!!gmPermissions.canDeleteMessages}\r\n                                        onChange={e => handlePermissionChange('canDeleteMessages', e.target.checked)}\r\n                                    />\r\n                                    Allow deleting messages\r\n                                </label>\r\n                                {/* Add more GM toggles here if needed */}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n            <main className=\"main-content\">\r\n                {activeTab === 'treaties' ? (\r\n                    <section className=\"treaties-section card\">\r\n                        <div className=\"treaties-header\">\r\n                            <h2>Treaties, Contracts & Agreements</h2>\r\n                            <div style={{display:'flex',gap:'0.7em',alignItems:'center'}}>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search treaties...\"\r\n                                    value={treatySearch}\r\n                                    onChange={e => { setTreatySearch(e.target.value); setTreatyPage(1); }}\r\n                                    style={{minWidth:180,maxWidth:260}}\r\n                                />\r\n                                <select\r\n                                    value={treatySort}\r\n                                    onChange={e => setTreatySort(e.target.value)}\r\n                                    style={{minWidth:110}}\r\n                                >\r\n                                    <option value=\"title\">Title</option>\r\n                                    <option value=\"status\">Status</option>\r\n                                    <option value=\"owner\">Owner</option>\r\n                                </select>\r\n                                <button\r\n                                    onClick={() => setTreatySortDir(d => d === 'asc' ? 'desc' : 'asc')}\r\n                                    style={{minWidth:40}}\r\n                                    title=\"Toggle sort direction\"\r\n                                >{treatySortDir === 'asc' ? 'â†‘' : 'â†“'}</button>\r\n                                <button onClick={handleExportTreaties} style={{minWidth:40}} title=\"Export treaties\">â­³</button>\r\n                            </div>\r\n                            {account && (\r\n                                <button\r\n                                    className=\"empire-save-btn\"\r\n                                    onClick={() => openTreatyDialog('new')}\r\n                                >\r\n                                    + Add New Treaty\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        {/* Dialogs */}\r\n                        {treatyDialog.open && treatyDialog.mode !== 'view' && (\r\n                            <TreatyDialog\r\n                                open={treatyDialog.open}\r\n                                mode={treatyDialog.mode}\r\n                                data={treatyDialog.data}\r\n                                onSave={handleTreatySave}\r\n                                onClose={closeTreatyDialog}\r\n                                error={treatyError}\r\n                                saving={treatySaving}\r\n                                empires={empires.map(e => e.name)}\r\n                                accounts={accounts}\r\n                            />\r\n                        )}\r\n                        {treatyDialog.open && treatyDialog.mode === 'view' && (\r\n                            <TreatyView\r\n                                treaty={treatyDialog.data}\r\n                                onBack={closeTreatyDialog}\r\n                                onEdit={() => openTreatyDialog('edit', treatyDialog.data)}\r\n                                onTransfer={newOwner => handleTreatyTransferOwner(treatyDialog.data.id, newOwner)}\r\n                                canEdit={canEditTreaty(treatyDialog.data)}\r\n                                canTransfer={canTransferTreaty(treatyDialog.data)}\r\n                                accounts={accounts}\r\n                            />\r\n                        )}\r\n                        {/* List */}\r\n                        <div className=\"treaties-list-container\">\r\n                            {!treatiesLoaded && <div className=\"login-loading\">Loading treaties...</div>}\r\n                            {filteredTreaties.length === 0 && treatiesLoaded && (\r\n                                <div className=\"no-messages\">No treaties found.</div>\r\n                            )}\r\n                            <ul className=\"treaties-list\">\r\n                                {treatyPageTreaties.map(treaty => (\r\n                                    <li\r\n                                        key={treaty.id}\r\n                                        className=\"treaty-item\"\r\n                                        style={{position:'relative'}}\r\n                                        onMouseEnter={e => {\r\n                                            const el = e.currentTarget;\r\n                                            el._tooltip = document.createElement('div');\r\n                                            el._tooltip.style.position = 'absolute';\r\n                                            el._tooltip.style.top = '100%';\r\n                                            el._tooltip.style.left = '0';\r\n                                            el._tooltip.style.zIndex = 9999;\r\n                                            el._tooltip.style.background = '#232b3a';\r\n                                            el._tooltip.style.color = '#fff';\r\n                                            el._tooltip.style.padding = '0.5em 1em';\r\n                                            el._tooltip.style.borderRadius = '8px';\r\n                                            el._tooltip.style.fontSize = '0.98em';\r\n                                            el._tooltip.innerText = `${treaty.title}\\nOwner: ${treaty.owner}\\nStatus: ${treaty.status}\\nParticipants: ${(treaty.participants||[]).join(', ')}`;\r\n                                            el.appendChild(el._tooltip);\r\n                                        }}\r\n                                        onMouseLeave={e => {\r\n                                            const el = e.currentTarget;\r\n                                            if (el._tooltip) el.removeChild(el._tooltip);\r\n                                        }}\r\n                                        onClick={() => setTreatyDialog({ open: true, mode: 'view', data: treaty })}\r\n                                    >\r\n                                        <div className=\"treaty-info\">\r\n                                            <div style={{display:'flex',alignItems:'center',gap:'0.5em'}}>\r\n                                                {renderAvatar(treaty.title)}\r\n                                                <div className=\"treaty-title\">{treaty.title}</div>\r\n                                            </div>\r\n                                            <div className=\"treaty-meta\">\r\n                                                <div className=\"treaty-owner\">Owner: {treaty.owner}</div>\r\n                                                <div className=\"treaty-participants\">\r\n                                                    <b>Participants:</b> {(treaty.participants||[]).map(renderAvatar)}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"treaty-content\">\r\n                                                {treaty.content.length > 180 ? treaty.content.slice(0,180) + 'â€¦' : treaty.content}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"treaty-actions\">\r\n                                            <span className=\"treaty-status\" style={{\r\n                                                background: {\r\n                                                    discussion:'#2c3446',\r\n                                                    active:'#0090c0',\r\n                                                    broken:'#c0392b',\r\n                                                    expired:'#888',\r\n                                                    other:'#555'\r\n                                                }[treaty.status] || '#2c3446',\r\n                                                color:'#fff'\r\n                                            }}>\r\n                                                {({\r\n                                                    discussion: 'ðŸ—¨ï¸ In Discussion',\r\n                                                    active: 'âœ… Active',\r\n                                                    broken: 'âŒ Broken',\r\n                                                    expired: 'âŒ› Expired',\r\n                                                    other: 'â“ Other'\r\n                                                })[treaty.status] || treaty.status}\r\n                                            </span>\r\n                                            <span className=\"treaty-buttons\">\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    onClick={ev => { ev.stopPropagation(); setTreatyDialog({ open: true, mode: 'view', data: treaty }); }}\r\n                                                >View</button>\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    onClick={ev => { ev.stopPropagation(); handleCopyTreaty(treaty); }}\r\n                                                    title=\"Copy treaty\"\r\n                                                >Copy</button>\r\n                                                {canEditTreaty(treaty) && (\r\n                                                    <button\r\n                                                        className=\"empire-save-btn\"\r\n                                                        onClick={ev => { ev.stopPropagation(); openTreatyDialog('edit', treaty); }}\r\n                                                    >Edit</button>\r\n                                                )}\r\n                                                {account && account.username === \"GameMaster\" && (\r\n                                                    <button\r\n                                                        className=\"empire-back-btn\"\r\n                                                        style={{background:'#c0392b'}}\r\n                                                        onClick={ev => { ev.stopPropagation(); handleDeleteTreaty(treaty.id); }}\r\n                                                    >Delete</button>\r\n                                                )}\r\n                                            </span>\r\n                                        </div>\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                            {/* Treaty Pagination */}\r\n                            {treatyTotalPages > 1 && (\r\n                                <div style={{display:'flex',gap:'0.7em',justifyContent:'center',marginTop:'1em'}}>\r\n                                    <button disabled={treatyPage===1} onClick={()=>setTreatyPage(treatyPage-1)}>Prev</button>\r\n                                    <span>Page {treatyPage} / {treatyTotalPages}</span>\r\n                                    <button disabled={treatyPage===treatyTotalPages} onClick={()=>setTreatyPage(treatyPage+1)}>Next</button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </section>\r\n                ) : activeTab === 'empires' ? (\r\n                    editEmpire ? (\r\n                        <section className=\"empires-info-section card\">\r\n                            <h2>Edit {editEmpire}</h2>\r\n                            <EmpireEditPanel name={editEmpire} onCancel={() => setEditEmpire(null)} />\r\n                        </section>\r\n                    ) : empirePage ? (\r\n                        <EmpirePanel name={empirePage} canEdit={account && account.username === empirePage} />\r\n                    ) : (\r\n                        <section className=\"empires-info-section card\">\r\n                            <div style={{\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                alignItems: 'center',\r\n                                marginBottom: '1.5rem',\r\n                                gap: '0.3rem'\r\n                            }}>\r\n                                <h2 className=\"section-title\" style={{margin: 0, textAlign: 'center'}}>Empires Overview</h2>\r\n                                <span style={{\r\n                                    color: '#aaa',\r\n                                    fontSize: '1.05rem',\r\n                                    fontWeight: 500,\r\n                                    textAlign: 'center'\r\n                                }}>\r\n                                    Total Empires: <b>{filteredEmpires.length}</b>\r\n                                </span>\r\n                                <div style={{display:'flex',gap:'0.7em',alignItems:'center',marginTop:'0.7em'}}>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Search empires...\"\r\n                                        value={empireSearch}\r\n                                        onChange={e => { setEmpireSearch(e.target.value); setEmpirePageNum(1); }}\r\n                                        style={{minWidth:180,maxWidth:260}}\r\n                                    />\r\n                                    <select\r\n                                        value={empireSort}\r\n                                        onChange={e => setEmpireSort(e.target.value)}\r\n                                        style={{minWidth:110}}\r\n                                    >\r\n                                        <option value=\"name\">Name</option>\r\n                                        <option value=\"account\">Owner</option>\r\n                                    </select>\r\n                                    <button\r\n                                        onClick={() => setEmpireSortDir(d => d === 'asc' ? 'desc' : 'asc')}\r\n                                        style={{minWidth:40}}\r\n                                        title=\"Toggle sort direction\"\r\n                                    >{empireSortDir === 'asc' ? 'â†‘' : 'â†“'}</button>\r\n                                    <button onClick={handleExportEmpires} style={{minWidth:40}} title=\"Export empires\">â­³</button>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"empires-info-list\" style={{display: 'flex', flexWrap: 'wrap', gap: '1.5rem', justifyContent: 'flex-start'}}>\r\n                                {empirePageEmpires.map(e => {\r\n                                    const linkedAccount = getEmpireAccount(e.name);\r\n                                    const canEdit = account && (account.username === linkedAccount || account.username === \"GameMaster\");\r\n                                    return (\r\n                                        <div\r\n                                            key={e.name}\r\n                                            className=\"empire-info-card empire-list-card\"\r\n                                            style={{\r\n                                                minWidth: 260,\r\n                                                maxWidth: 340,\r\n                                                flex: '1 1 320px',\r\n                                                background: 'var(--primary-bg)',\r\n                                                border: '1.5px solid var(--accent)',\r\n                                                borderRadius: 12,\r\n                                                boxShadow: '0 2px 12px #0002',\r\n                                                padding: '1.2rem 1.2rem',\r\n                                                display: 'flex',\r\n                                                flexDirection: 'column',\r\n                                                gap: '0.7rem',\r\n                                                cursor: 'pointer',\r\n                                                position:'relative'\r\n                                            }}\r\n                                            onMouseEnter={ev => {\r\n                                                const el = ev.currentTarget;\r\n                                                el._tooltip = document.createElement('div');\r\n                                                el._tooltip.style.position = 'absolute';\r\n                                                el._tooltip.style.top = '100%';\r\n                                                el._tooltip.style.left = '0';\r\n                                                el._tooltip.style.zIndex = 9999;\r\n                                                el._tooltip.style.background = '#232b3a';\r\n                                                el._tooltip.style.color = '#fff';\r\n                                                el._tooltip.style.padding = '0.5em 1em';\r\n                                                el._tooltip.style.borderRadius = '8px';\r\n                                                el._tooltip.style.fontSize = '0.98em';\r\n                                                el._tooltip.innerText = `${e.name}\\nOwner: ${linkedAccount || 'Unassigned'}`;\r\n                                                el.appendChild(el._tooltip);\r\n                                            }}\r\n                                            onMouseLeave={ev => {\r\n                                                const el = ev.currentTarget;\r\n                                                if (el._tooltip) el.removeChild(el._tooltip);\r\n                                            }}\r\n                                            onClick={() => setEmpirePage(e.name)}\r\n                                        >\r\n                                            <div style={{display:'flex',alignItems:'center',gap:'0.5em'}}>\r\n                                                {renderAvatar(e.name)}\r\n                                                <h3 className=\"empire-info-title\" style={{margin: 0, color: 'var(--accent)', textAlign: 'center'}}>{e.name}</h3>\r\n                                            </div>\r\n                                            <div style={{color: '#b3cfff', fontWeight: 500, fontSize: '1.05em', textAlign: 'center', marginBottom: '0.5rem'}}>\r\n                                                {linkedAccount ? <span title=\"Assigned Account\">{linkedAccount}</span> : <i>Unassigned</i>}\r\n                                            </div>\r\n                                            <div className=\"empire-actions\" style={{display: 'flex', gap: '0.5rem', marginTop: '0.5rem', justifyContent: 'center'}}>\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    style={{minWidth: 80}}\r\n                                                    onClick={ev => {ev.stopPropagation(); setEmpirePage(e.name);}}\r\n                                                >View</button>\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    onClick={ev => {ev.stopPropagation(); handleCopyEmpire(e);}}\r\n                                                    title=\"Copy empire\"\r\n                                                >Copy</button>\r\n                                                {canEdit && (\r\n                                                    <button\r\n                                                        className=\"empire-save-btn\"\r\n                                                        style={{minWidth: 80}}\r\n                                                        onClick={ev => {ev.stopPropagation(); setEditEmpire(e.name);}}\r\n                                                    >Edit</button>\r\n                                                )}\r\n                                                {account && account.username === \"GameMaster\" && (\r\n                                                    <button\r\n                                                        className=\"empire-back-btn\"\r\n                                                        style={{background:'#0090c0'}}\r\n                                                        onClick={ev => {ev.stopPropagation(); handleRenameEmpire(e.name);}}\r\n                                                    >Rename</button>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                            {/* Empire Pagination */}\r\n                            {empireTotalPages > 1 && (\r\n                                <div style={{display:'flex',gap:'0.7em',justifyContent:'center',marginTop:'1em'}}>\r\n                                    <button disabled={empirePageNum===1} onClick={()=>setEmpirePageNum(empirePageNum-1)}>Prev</button>\r\n                                    <span>Page {empirePageNum} / {empireTotalPages}</span>\r\n                                    <button disabled={empirePageNum===empireTotalPages} onClick={()=>setEmpirePageNum(empirePageNum+1)}>Next</button>\r\n                                </div>\r\n                            )}\r\n                        </section>\r\n                    )\r\n                ) : (\r\n                    <>\r\n                        {!account ? (\r\n                            <section className=\"account-section card\">\r\n                                <h2 className=\"login-title\">Login</h2>\r\n                                <form onSubmit={handleLogin} className=\"account-form login-form\">\r\n                                    <div className=\"login-fields\">\r\n                                        <input\r\n                                            placeholder=\"Empire name\"\r\n                                            value={loginUser}\r\n                                            onChange={e => setLoginUser(e.target.value)}\r\n                                            required\r\n                                            disabled={!accountsLoaded}\r\n                                            className=\"login-input\"\r\n                                        />\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            placeholder=\"Password\"\r\n                                            value={loginPass}\r\n                                            onChange={e => setLoginPass(e.target.value)}\r\n                                            required\r\n                                            disabled={!accountsLoaded}\r\n                                            className=\"login-input\"\r\n                                        />\r\n                                    </div>\r\n                                    <button type=\"submit\" disabled={!accountsLoaded} className=\"login-btn\">Login</button>\r\n                                </form>\r\n                                {!accountsLoaded && <div className=\"login-loading\">Loading accounts...</div>}\r\n                                {error && <div className=\"login-error\">{error}</div>}\r\n                            </section>\r\n                        ) : (\r\n                            // Center the channels page\r\n                            <div style={{ display: 'flex', justifyContent: 'center', width: '100%' }}>\r\n                                <section className=\"boards-section\">\r\n                                    {/* Logout button at top right */}\r\n                                    {/* <div className=\"channels-header\">\r\n                                        <span style={{marginRight: 'auto', color: '#aaa', fontWeight: 500}}>\r\n                                            Logged in as <b>{account.username}</b>\r\n                                        </span>\r\n                                        <button\r\n                                            className=\"logout-btn\"\r\n                                            onClick={handleLogout}\r\n                                            title=\"Logout\"\r\n                                        >\r\n                                            <span className=\"logout-icon\">&#x1F511;</span> Logout\r\n                                        </button>\r\n                                    </div> */}\r\n                                    {/* Main area: boards/channels list left, text channel right */}\r\n                                    <div className=\"channels-main\">\r\n                                        <div className=\"channels-sidebar\">\r\n                                            <div className=\"boards-list card\">\r\n                                                <h2>\r\n                                                    {account && account.username === \"GameMaster\"\r\n                                                        ? \"All Boards\"\r\n                                                        : \"Your Diplomatic Channels\"}\r\n                                                </h2>\r\n                                                <div className=\"boards-list-header\">\r\n                                                    <span className=\"boards-list-count\">\r\n                                                        {filteredBoards.length} {filteredBoards.length === 1 ? \"channel\" : \"channels\"}\r\n                                                    </span>\r\n                                                </div>\r\n                                                <ul className=\"boards-list-ul\">\r\n                                                    {filteredBoards.length === 0 && (\r\n                                                        <li className=\"no-channels\">No channels available.</li>\r\n                                                    )}\r\n                                                    {filteredBoards.map(([a, b]) => {\r\n                                                        const key = a + '|' + b;\r\n                                                        return (\r\n                                                            <li key={key} className={`boards-list-item${selected === key ? ' active' : ''}`}>\r\n                                                                <button\r\n                                                                    className=\"board-btn\"\r\n                                                                    onClick={() => handleBoardSelect([a, b])}\r\n                                                                >\r\n                                                                    <span className=\"board-nations\">{a}</span>\r\n                                                                    <span className=\"board-arrow\">â†”</span>\r\n                                                                    <span className=\"board-nations\">{b}</span>\r\n                                                                </button>\r\n                                                            </li>\r\n                                                        );\r\n                                                    })}\r\n                                                </ul>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"channels-content\">\r\n                                            <div className=\"board-messages card\">\r\n                                                {(selected && filteredBoards.length > 0) ? (\r\n                                                    <div className=\"board-messages-inner\">\r\n                                                        <div className=\"board-title-row\">\r\n                                                            <h2 className=\"board-title\">{selected.replace('|', ' â†” ')}</h2>\r\n                                                        </div>\r\n                                                        <div className=\"messages-panel\">\r\n                                                            <div className=\"messages-list-container\">\r\n                                                                <ul className=\"messages-list\">\r\n                                                                    {(messages[selected] || []).length === 0 && <li className=\"no-messages\">No messages yet.</li>}\r\n                                                                    {(messages[selected] || []).map((msg, i) => {\r\n                                                                        const [partnerA, partnerB] = selected.split('|');\r\n                                                                        let partnerClass = '';\r\n                                                                        if (msg.author === partnerA) partnerClass = 'message-partnerA';\r\n                                                                        else if (msg.author === partnerB) partnerClass = 'message-partnerB';\r\n                                                                        return (\r\n                                                                            <li\r\n                                                                                key={i}\r\n                                                                                className={`message-item ${partnerClass}`}\r\n                                                                                style={{\r\n                                                                                    display: 'flex',\r\n                                                                                    alignItems: 'stretch',\r\n                                                                                    justifyContent: 'flex-start',\r\n                                                                                    gap: '0.7rem'\r\n                                                                                }}\r\n                                                                            >\r\n                                                                                <div style={{\r\n                                                                                    flex: 1,\r\n                                                                                    minWidth: 0,\r\n                                                                                    display: 'flex',\r\n                                                                                    flexDirection: 'column',\r\n                                                                                    gap: '0.15rem',\r\n                                                                                    justifyContent: 'center'\r\n                                                                                }}>\r\n                                                                                    <div className=\"message-meta\" style={{marginBottom: 0}}>\r\n                                                                                        <span className=\"message-author\">{msg.author}</span>\r\n                                                                                        <small className=\"message-date\">{new Date(msg.timestamp).toLocaleString()}</small>\r\n                                                                                    </div>\r\n                                                                                    <div className=\"message-text\">{msg.text}</div>\r\n                                                                                </div>\r\n                                                                                {account && account.username === \"GameMaster\" && gmPermissions.canDeleteMessages && (\r\n                                                                                    <div style={{\r\n                                                                                        display: 'flex',\r\n                                                                                        alignItems: 'center',\r\n                                                                                        justifyContent: 'center',\r\n                                                                                        minWidth: '2.5em',\r\n                                                                                        paddingLeft: '0.5em'\r\n                                                                                    }}>\r\n                                                                                        <button\r\n                                                                                            title=\"Delete message\"\r\n                                                                                            style={{\r\n                                                                                                background: 'none',\r\n                                                                                                border: 'none',\r\n                                                                                                color: '#ff4d4d',\r\n                                                                                                cursor: 'pointer',\r\n                                                                                                fontSize: '1.3em',\r\n                                                                                                display: 'flex',\r\n                                                                                                alignItems: 'center',\r\n                                                                                                height: '2.2em'\r\n                                                                                            }}\r\n                                                                                            onClick={e => {\r\n                                                                                                e.stopPropagation();\r\n                                                                                                handleDeleteMessage(selected, i);\r\n                                                                                            }}\r\n                                                                                        >\r\n                                                                                            <span role=\"img\" aria-label=\"Delete\">&#128465;</span>\r\n                                                                                        </button>\r\n                                                                                    </div>\r\n                                                                                )}\r\n                                                                            </li>\r\n                                                                        );\r\n                                                                    })}\r\n                                                                    <div ref={messagesEndRef} />\r\n                                                                </ul>\r\n                                                            </div>\r\n                                                            <form onSubmit={postMessage} className=\"message-form message-form-bottom\">\r\n                                                                <input\r\n                                                                    placeholder=\"Your empire\"\r\n                                                                    value={account.username}\r\n                                                                    disabled\r\n                                                                    required\r\n                                                                    className=\"author-input\"\r\n                                                                />\r\n                                                                <input\r\n                                                                    placeholder=\"Message\"\r\n                                                                    value={text}\r\n                                                                    onChange={e => setText(e.target.value)}\r\n                                                                    required\r\n                                                                    className=\"text-input\"\r\n                                                                />\r\n                                                                <button type=\"submit\" className=\"send-btn\">Send</button>\r\n                                                            </form>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <div className=\"no-messages\">Select a channel to view messages.</div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </section>\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </main>\r\n            <footer className=\"footer\">\r\n                <span>Stellaris RP Board &copy; {new Date().getFullYear()}</span>\r\n            </footer>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}