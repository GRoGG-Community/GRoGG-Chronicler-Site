{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import'./App.css';import'./Treaties.css';import'./Empires.css';import'./Boards.css';import'./Accounts.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function getNationPairs(nations){const pairs=[];for(let i=0;i<nations.length;i++){for(let j=i+1;j<nations.length;j++){pairs.push([nations[i],nations[j]]);}}return pairs;}function App(){// Remove unused empireInput, selectedNation, author\nconst[empires,setEmpires]=useState([]);const[selected,setSelected]=useState(()=>{const saved=localStorage.getItem('stellarisSelectedBoard');return saved?saved:null;});const[messages,setMessages]=useState({});const[text,setText]=useState('');const pollingRef=useRef();const messagesEndRef=useRef(null);const[accounts,setAccounts]=useState({});const[accountsLoaded,setAccountsLoaded]=useState(false);const[account,setAccount]=useState(()=>{const saved=localStorage.getItem('stellarisAccount');return saved?JSON.parse(saved):null;});const[loginUser,setLoginUser]=useState('');const[loginPass,setLoginPass]=useState('');const[error,setError]=useState('');const[activeTab,setActiveTab]=useState('channels');const[empirePage,setEmpirePage]=useState(null);const[editEmpire,setEditEmpire]=useState(null);const[empireInfo,setEmpireInfo]=useState({});const[empireInfoLoaded,setEmpireInfoLoaded]=useState(false);// Account creation and management\nconst[newAccountName,setNewAccountName]=useState('');const[newAccountPass,setNewAccountPass]=useState('');const[accountError,setAccountError]=useState('');const[accountSuccess,setAccountSuccess]=useState('');const[accountsTabLoading,setAccountsTabLoading]=useState(false);const[editAccount,setEditAccount]=useState(null);const[editAccountName,setEditAccountName]=useState('');const[editAccountPass,setEditAccountPass]=useState('');const[editAccountError,setEditAccountError]=useState('');const[editAccountLoading,setEditAccountLoading]=useState(false);// Manage Empires tab\nconst[newEmpireName,setNewEmpireName]=useState('');const[newEmpireError,setNewEmpireError]=useState('');const[newEmpireLoading,setNewEmpireLoading]=useState(false);// --- Treaties State (NEW IMPLEMENTATION) ---\nconst[treaties,setTreaties]=useState([]);const[treatiesLoaded,setTreatiesLoaded]=useState(false);const[treatyDialog,setTreatyDialog]=useState({open:false,mode:null,data:null});const[treatyError,setTreatyError]=useState('');const[treatySaving,setTreatySaving]=useState(false);// --- Fetch treaties ---\nfunction fetchTreaties(){fetch('/treaties.json?ts='+Date.now()).then(res=>res.json()).then(data=>{setTreaties(Array.isArray(data)?data:[]);setTreatiesLoaded(true);}).catch(()=>setTreatiesLoaded(true));}useEffect(()=>{fetchTreaties();},[]);// --- Treaty CRUD ---\nfunction openTreatyDialog(mode){let data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setTreatyDialog({open:true,mode,data});setTreatyError('');}function closeTreatyDialog(){setTreatyDialog({open:false,mode:null,data:null});setTreatyError('');}function handleTreatySave(form){var _payload$participants;setTreatySaving(true);setTreatyError('');const payload={...form};if(!payload.title||!payload.content||!((_payload$participants=payload.participants)!==null&&_payload$participants!==void 0&&_payload$participants.length)){setTreatyError('Title, content, and at least one participant are required.');setTreatySaving(false);return;}if(!payload.owner)payload.owner=(account===null||account===void 0?void 0:account.username)||'';if(!payload.status)payload.status='discussion';if(!payload.id)payload.id=Date.now().toString();fetch('/api/treaties',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).then(res=>res.json()).then(data=>{if(data.success){// --- FIX: update treaties state locally, just like accounts ---\nsetTreaties(prev=>{// If editing, replace; if new, add\nconst idx=prev.findIndex(t=>t.id===payload.id);if(idx!==-1){const updated=[...prev];updated[idx]={...prev[idx],...payload};return updated;}else{return[...prev,payload];}});closeTreatyDialog();}else{setTreatyError(data.error||'Failed to save treaty');}}).catch(()=>setTreatyError('Failed to save treaty')).finally(()=>setTreatySaving(false));}function handleTreatyTransferOwner(id,newOwner){setTreatySaving(true);fetch('/api/treaties/transfer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,newOwner})}).then(res=>res.json()).then(data=>{if(data.success){setTreaties(prev=>prev.map(t=>t.id===id?{...t,owner:newOwner}:t));closeTreatyDialog();}}).finally(()=>setTreatySaving(false));}// --- Treaty Permissions ---\nfunction canEditTreaty(treaty){if(!account)return false;return account.username===treaty.owner||account.username===\"GameMaster\";}function canTransferTreaty(treaty){return account&&account.username===\"GameMaster\";}// --- Treaty Dialog UI ---\nfunction TreatyDialog(_ref){let{open,mode,data,onSave,onClose,error,saving,empires,accounts}=_ref;const[form,setForm]=useState(()=>data?{...data}:{title:'',content:'',participants:[],status:'discussion',owner:(account===null||account===void 0?void 0:account.username)||''});const[showParticipantsDropdown,setShowParticipantsDropdown]=useState(false);const dropdownBtnRef=useRef(null);const dropdownListRef=useRef(null);useEffect(()=>{if(data)setForm({...data});else setForm({title:'',content:'',participants:[],status:'discussion',owner:(account===null||account===void 0?void 0:account.username)||''});},[data,open]);// --- Dropdown close on outside click ---\nuseEffect(()=>{if(!showParticipantsDropdown)return;function handleClick(e){if(dropdownBtnRef.current&&!dropdownBtnRef.current.contains(e.target)&&dropdownListRef.current&&!dropdownListRef.current.contains(e.target)){setShowParticipantsDropdown(false);}}document.addEventListener('mousedown',handleClick);return()=>document.removeEventListener('mousedown',handleClick);},[showParticipantsDropdown]);// Keyboard navigation: close dropdown on Escape\nuseEffect(()=>{if(!showParticipantsDropdown)return;function handleKey(e){if(e.key===\"Escape\")setShowParticipantsDropdown(false);}document.addEventListener('keydown',handleKey);return()=>document.removeEventListener('keydown',handleKey);},[showParticipantsDropdown]);if(!open)return null;const isEdit=mode==='edit';const statuses=[{value:'discussion',label:'🗨️ In Discussion'},{value:'active',label:'✅ Active'},{value:'broken',label:'❌ Broken'},{value:'expired',label:'⌛ Expired'},{value:'other',label:'❓ Other'}];// Helper for participants dropdown\nfunction toggleParticipant(name){setForm(f=>{const exists=f.participants.includes(name);return{...f,participants:exists?f.participants.filter(p=>p!==name):[...f.participants,name]};});}return/*#__PURE__*/_jsx(\"div\",{className:\"treaty-dialog-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-dialog\",children:[/*#__PURE__*/_jsx(\"h2\",{children:isEdit?'Edit Treaty':'New Treaty'}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:e=>{e.preventDefault();onSave(form);},children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Title:\",/*#__PURE__*/_jsx(\"input\",{value:form.title,onChange:e=>setForm(f=>({...f,title:e.target.value})),required:true,disabled:saving})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Status:\",/*#__PURE__*/_jsx(\"select\",{value:form.status,onChange:e=>setForm(f=>({...f,status:e.target.value})),disabled:saving,children:statuses.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.value,children:s.label},s.value))})]}),/*#__PURE__*/_jsxs(\"label\",{style:{position:'relative'},children:[\"Participants:\",/*#__PURE__*/_jsxs(\"div\",{className:\"participants-dropdown\",ref:dropdownBtnRef,tabIndex:0,style:{userSelect:'none',background:'var(--primary-bg)',border:'1px solid var(--border)',borderRadius:8,padding:'0.7rem 1rem',minHeight:'2.2rem',cursor:saving?'not-allowed':'pointer',marginBottom:'0.7rem',position:'relative',display:'flex',alignItems:'center',justifyContent:'space-between'}// Prevent the first click from toggling the first item\n,onMouseDown:e=>e.preventDefault(),onClick:e=>{if(!saving)setShowParticipantsDropdown(v=>!v);},\"aria-haspopup\":\"listbox\",\"aria-expanded\":showParticipantsDropdown,children:[/*#__PURE__*/_jsx(\"span\",{style:{color:form.participants.length?'var(--text)':'#aaa',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap',flex:1},children:form.participants.length?form.participants.join(', '):'Select participants...'}),/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:8,color:'#aaa',fontSize:'1.1em',pointerEvents:'none'},children:\"\\u25BC\"})]}),showParticipantsDropdown&&/*#__PURE__*/_jsx(\"div\",{className:\"participants-dropdown-list\",ref:dropdownListRef,style:{position:'absolute',left:0,right:0,top:'calc(100% + 8px)',zIndex:1001,background:'var(--card-bg)',border:'1.5px solid var(--accent)',borderRadius:10,boxShadow:'0 4px 24px #0005',minWidth:210,padding:'0.3rem 0',display:'flex',flexDirection:'column',gap:'0.2rem',maxHeight:220,overflowY:'auto'},onClick:e=>e.stopPropagation(),role:\"listbox\",children:empires.map((e,idx)=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"participants-dropdown-item\",style:{background:'none',border:'none',color:'var(--accent)',fontSize:'1.08rem',textAlign:'left',padding:'0.7rem 1.2rem',cursor:saving?'not-allowed':'pointer',borderRadius:7,transition:'background 0.15s, color 0.15s',width:'100%',display:'flex',alignItems:'center',gap:'0.7em',position:'relative',backgroundColor:form.participants.includes(e)?'rgba(0,191,255,0.10)':'transparent'},tabIndex:-1// Prevent the first click after opening from toggling the first item\n,onMouseDown:ev=>ev.preventDefault(),onClick:ev=>{ev.stopPropagation();if(!saving)toggleParticipant(e);},children:[/*#__PURE__*/_jsx(\"span\",{style:{display:'inline-flex',alignItems:'center',justifyContent:'center',width:22,height:22,borderRadius:5,border:'1.5px solid var(--accent)',background:form.participants.includes(e)?'var(--accent)':'var(--primary-bg)',marginRight:10,transition:'background 0.15s, border 0.15s'},children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:form.participants.includes(e),readOnly:true,tabIndex:-1,style:{accentColor:'var(--accent)',width:18,height:18,margin:0,pointerEvents:'none'}})}),/*#__PURE__*/_jsx(\"span\",{style:{color:form.participants.includes(e)?'#fff':'var(--accent)',fontWeight:form.participants.includes(e)?600:400,flex:1,textAlign:'left'},children:e})]},e))})]}),(account===null||account===void 0?void 0:account.username)===\"GameMaster\"&&/*#__PURE__*/_jsxs(\"label\",{children:[\"Owner:\",/*#__PURE__*/_jsx(\"select\",{value:form.owner,onChange:e=>setForm(f=>({...f,owner:e.target.value})),disabled:saving,children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsx(\"option\",{value:acc,children:acc},acc))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Content:\",/*#__PURE__*/_jsx(\"textarea\",{value:form.content,onChange:e=>setForm(f=>({...f,content:e.target.value})),rows:7,required:true,disabled:saving})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error treaty-error\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:saving,children:isEdit?\"Save Changes\":\"Create Treaty\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"empire-back-btn\",onClick:onClose,disabled:saving,children:\"Cancel\"})]})]})]})});}// --- Treaty View UI ---\nfunction TreatyView(_ref2){var _treaty$participants;let{treaty,onBack,onEdit,onTransfer,canEdit,canTransfer,accounts}=_ref2;if(!treaty)return null;const statuses={discussion:'🗨️ In Discussion',active:'✅ Active',broken:'❌ Broken',expired:'⌛ Expired',other:'❓ Other'};return/*#__PURE__*/_jsx(\"div\",{className:\"treaty-dialog-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-dialog\",children:[/*#__PURE__*/_jsx(\"h2\",{children:treaty.title}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Status:\"}),\" \",statuses[treaty.status]||treaty.status]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Owner:\"}),\" \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",((_treaty$participants=treaty.participants)===null||_treaty$participants===void 0?void 0:_treaty$participants.join(', '))||/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{margin:'1em 0',whiteSpace:'pre-line'},children:treaty.content}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",style:{minWidth:110,maxWidth:160},onClick:onBack,children:\"Back\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{minWidth:110,maxWidth:160},onClick:onEdit,children:\"Edit\"})]})]})});}// --- NEW: Permissions state for GameMaster ---\nconst[showMenu,setShowMenu]=useState(false);const[showPermissions,setShowPermissions]=useState(false);const[gmPermissions,setGmPermissions]=useState(()=>{// Persist in localStorage\nconst saved=localStorage.getItem('stellarisGmPermissions');return saved?JSON.parse(saved):{canDeleteMessages:true};});// Save GM permissions to localStorage\nuseEffect(()=>{localStorage.setItem('stellarisGmPermissions',JSON.stringify(gmPermissions));},[gmPermissions]);// --- NEW: Menu handlers ---\nfunction handleMenuToggle(){setShowMenu(v=>!v);setShowPermissions(false);}function handleMenuClose(){setShowMenu(false);setShowPermissions(false);}// Keep menu open when hovering either dropdown or permissions\nconst menuDropdownRef=useRef(null);const permissionsDropdownRef=useRef(null);// Close menu only if mouse leaves both dropdowns\nuseEffect(()=>{if(!showMenu&&!showPermissions)return;function handleMouseMove(e){if(menuDropdownRef.current&&permissionsDropdownRef.current&&!menuDropdownRef.current.contains(e.target)&&!permissionsDropdownRef.current.contains(e.target)){setShowMenu(false);setShowPermissions(false);}}document.addEventListener('mousedown',handleMouseMove);return()=>document.removeEventListener('mousedown',handleMouseMove);},[showMenu,showPermissions]);function handlePermissionsToggle(){setShowPermissions(v=>!v);}function handlePermissionChange(key,value){setGmPermissions(prev=>({...prev,[key]:value}));}// --- NEW: Other menu options ---\nfunction handleShowAbout(){alert(\"Stellaris RP Board\\n\\nCreated for roleplay and diplomacy.\\n\\nContact: admin@example.com\");handleMenuClose();}function handleShowTheme(){alert(\"Theme switcher coming soon!\");handleMenuClose();}// --- NEW: Theme toggle ---\nconst[theme,setTheme]=useState(()=>localStorage.getItem('stellarisTheme')||'dark');useEffect(()=>{document.body.setAttribute('data-theme',theme);localStorage.setItem('stellarisTheme',theme);},[theme]);function handleThemeToggle(){setTheme(t=>t==='dark'?'light':'dark');}// Only load empireInfo when switching to the Empires tab and not viewing/editing any empire.\n// This prevents any reloads while editing or viewing an empire.\nuseEffect(()=>{if(activeTab==='empires'&&!editEmpire&&!empirePage){// Add cache-busting query param\nfetch(`/empireInfo.json?ts=${Date.now()}`).then(res=>res.json()).then(data=>{setEmpireInfo(data&&typeof data==='object'?data:{});setEmpireInfoLoaded(true);}).catch(()=>setEmpireInfoLoaded(true));}// Only run when switching tabs, or leaving view/edit mode\n},[activeTab,editEmpire,empirePage]);// --- NEW: Search Empires ---\nconst[empireSearch,setEmpireSearch]=useState('');function getEmpireNames(){const names=empires.map(e=>e.name);if(!empireSearch.trim())return names;return names.filter(n=>n.toLowerCase().includes(empireSearch.trim().toLowerCase()));}// Helper: get boards from linked empires\nfunction getLinkedBoards(){const names=getEmpireNames();return getNationPairs(names);}// Helper: get account linked to empire\nfunction getEmpireAccount(empireName){const emp=empires.find(e=>e.name===empireName);return emp&&emp.account?emp.account:null;}// Only show boards for the empire assigned to the logged-in account, except GameMaster sees all\nconst filteredBoards=account?account.username===\"GameMaster\"?getLinkedBoards():getLinkedBoards().filter(_ref3=>{let[a,b]=_ref3;return getEmpireAccount(a)===account.username||getEmpireAccount(b)===account.username;}):[];// GameMaster: link/unlink accounts to empires\nfunction handleLinkAccount(empireName,accountName){fetch('/api/empires/link',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({empireName,accountName})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>prev.map(e=>e.name===empireName?{...e,account:accountName}:e));}});}function handleUnlinkAccount(empireName){fetch('/api/empires/unlink',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({empireName})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>prev.map(e=>e.name===empireName?{...e,account:null}:e));}});}// Save selected board to localStorage\nfunction handleBoardSelect(pair){const key=pair.join('|');setSelected(key);localStorage.setItem('stellarisSelectedBoard',key);}// Fetch messages for the selected board from the server\nuseEffect(()=>{// Only poll messages if on channels tab and not editing/viewing empire\nif(!selected||activeTab!=='channels'||editEmpire||empirePage){// Stop polling if not in correct state\nif(pollingRef.current){clearInterval(pollingRef.current);pollingRef.current=null;}return;}// Use selected as key\nconst key=selected;// Function to fetch messages\nconst fetchMessages=()=>{fetch(`/api/messages?board=${encodeURIComponent(key)}`).then(res=>{if(!res.ok)throw new Error('Network response was not ok');return res.json();}).then(data=>{setMessages(prev=>({...prev,[key]:data}));}).catch(err=>{setMessages(prev=>({...prev,[key]:[]}));console.error('Failed to fetch messages:',err);});};// Initial fetch\nfetchMessages();// Set up polling\npollingRef.current=setInterval(fetchMessages,2000);// Cleanup on unmount or when selected/activeTab/editEmpire/empirePage changes\nreturn()=>{if(pollingRef.current){clearInterval(pollingRef.current);pollingRef.current=null;}};},[selected,activeTab,editEmpire,empirePage]);// Scroll to bottom only when messages actually change for the selected board\nconst prevMessagesLengthRef=useRef(0);useEffect(()=>{if(!selected)return;const currentMessages=messages[selected]||[];if(currentMessages.length!==prevMessagesLengthRef.current){if(messagesEndRef.current){messagesEndRef.current.scrollIntoView({behavior:'auto'});}prevMessagesLengthRef.current=currentMessages.length;}},[messages,selected]);// When posting, always use the logged-in account's empire name\nfunction postMessage(e){e.preventDefault();if(!selected||!account||!text.trim())return;const key=selected;const msg={board:key,author:account.username,text,timestamp:Date.now()};fetch('/api/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(msg)}).then(res=>res.json()).then(()=>{fetch(`/api/messages?board=${encodeURIComponent(key)}`).then(res=>res.json()).then(data=>{setMessages(prev=>({...prev,[key]:data}));});});setText('');}// Fetch accounts from server (accounts.json)\nuseEffect(()=>{fetch('/accounts.json').then(res=>res.json()).then(data=>{setAccounts(data);setAccountsLoaded(true);}).catch(()=>setAccountsLoaded(true));},[]);// Load empires from empires.json\nuseEffect(()=>{fetch('/empires.json').then(res=>res.json()).then(data=>{setEmpires(Array.isArray(data)?data:[]);});},[]);// Fetch treaties from backend\nuseEffect(()=>{fetch('/treaties.json').then(res=>res.json()).then(data=>{setTreaties(Array.isArray(data)?data:[]);setTreatiesLoaded(true);}).catch(()=>setTreatiesLoaded(true));},[]);function handleLogin(e){e.preventDefault();// Wait until accounts are loaded\nif(!accountsLoaded){setError('Accounts are still loading, please wait...');return;}const username=loginUser.trim();const password=loginPass.trim();if(!accounts[username]){setError('Invalid credentials');return;}if(accounts[username]!==password){setError('Invalid credentials');return;}setAccount({username});localStorage.setItem('stellarisAccount',JSON.stringify({username}));setError('');}function handleLogout(){setAccount(null);localStorage.removeItem('stellarisAccount');}// Save empire info to backend and update local state\nfunction saveEmpireInfo(name,info){return fetch('/api/empireInfo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,info})}).then(res=>res.json()).then(()=>{// After saving, reload from backend with cache-busting param\nreturn fetch(`/empireInfo.json?ts=${Date.now()}`).then(res=>res.json()).then(data=>{setEmpireInfo(data&&typeof data==='object'?data:{});});});}// Edit panel for empire info\nfunction EmpireEditPanel(_ref4){let{name,onCancel}=_ref4;// Only initialize edit state from empireInfo[name] when the component mounts\nconst info=empireInfo[name]||{};const[edit,setEdit]=useState(info);// Do NOT use useEffect to update edit state from empireInfo.\n// This ensures the text fields are not reset while editing.\nfunction handleChange(e){setEdit({...edit,[e.target.name]:e.target.value});}function handleSave(e){e.preventDefault();saveEmpireInfo(name,edit).then(()=>{onCancel();});}return/*#__PURE__*/_jsxs(\"form\",{className:\"empire-edit-form\",onSubmit:handleSave,children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Lore:\",/*#__PURE__*/_jsx(\"textarea\",{name:\"lore\",value:edit.lore||'',onChange:handleChange,rows:3})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Stats:\",/*#__PURE__*/_jsx(\"input\",{name:\"stats\",value:edit.stats||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Ethics:\",/*#__PURE__*/_jsx(\"input\",{name:\"ethics\",value:edit.ethics||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Civics:\",/*#__PURE__*/_jsx(\"input\",{name:\"civics\",value:edit.civics||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Special Info:\",/*#__PURE__*/_jsx(\"input\",{name:\"special\",value:edit.special||'',onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',marginTop:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"empire-back-btn\",onClick:onCancel,children:\"Cancel\"})]})]});}// View panel for empire info\nfunction EmpirePanel(_ref5){let{name,canEdit}=_ref5;const info=empireInfo[name]||{};return/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-card empire-info-page\",style:{maxWidth:420,margin:'2rem auto',background:'var(--card-bg)',border:'1.5px solid var(--accent)',borderRadius:14,boxShadow:'0 2px 16px #0002',padding:'2rem 2rem',display:'flex',flexDirection:'column',alignItems:'stretch',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"empire-info-title\",style:{marginBottom:0},children:name}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#b3cfff',fontWeight:500,marginBottom:'1.2rem',fontSize:'1.08em',textAlign:'center'},children:[\"Owner: \",/*#__PURE__*/_jsx(\"span\",{style:{color:'#fff'},children:getEmpireAccount(name)||/*#__PURE__*/_jsx(\"i\",{children:\"Unassigned\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-details\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Lore:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.lore||/*#__PURE__*/_jsx(\"i\",{children:\"No lore set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Stats:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.stats||/*#__PURE__*/_jsx(\"i\",{children:\"No stats set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Ethics:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.ethics||/*#__PURE__*/_jsx(\"i\",{children:\"No ethics set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Civics:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.civics||/*#__PURE__*/_jsx(\"i\",{children:\"No civics set.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Special Info:\"}),\" \",/*#__PURE__*/_jsx(\"div\",{className:\"empire-info-field\",children:info.special||/*#__PURE__*/_jsx(\"i\",{children:\"No special info set.\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem',marginTop:'1.5rem',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",onClick:()=>setEmpirePage(null),children:\"Back to Empires\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>setEditEmpire(name),children:\"Edit\"})]})]});}// Defensive: ensure empireInfo is always an object\nuseEffect(()=>{if(!empireInfo||typeof empireInfo!=='object'||Array.isArray(empireInfo)){setEmpireInfo({});}},[empireInfo]);// Defensive: ensure accounts is always an object\nuseEffect(()=>{if(!accounts||typeof accounts!=='object'||Array.isArray(accounts)){setAccounts({});}},[accounts]);// Add API to create new account\nfunction handleCreateAccount(e){e.preventDefault();setAccountError('');setAccountSuccess('');const name=newAccountName.trim();const pass=newAccountPass.trim();if(!name||!pass){setAccountError('Name and password required');return;}if(accounts[name]){setAccountError('Account already exists');return;}setAccountsTabLoading(true);fetch('/api/accounts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,pass})}).then(res=>res.json()).then(data=>{if(data.success){setAccounts(prev=>({...prev,[name]:pass}));// Remove: setEmpires(prev => prev.includes(name) ? prev : [...prev, name]);\nsetAccountSuccess('Account created');setNewAccountName('');setNewAccountPass('');}else{setAccountError(data.error||'Failed to create account');}}).catch(()=>setAccountError('Failed to create account')).finally(()=>setAccountsTabLoading(false));}// API: Rename account\nfunction handleRenameAccount(e){e.preventDefault();setEditAccountError('');setEditAccountLoading(true);const oldName=editAccount;const newName=editAccountName.trim();if(!newName||newName===oldName){setEditAccountError('Enter a new name');setEditAccountLoading(false);return;}fetch('/api/accounts/rename',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({oldName,newName})}).then(res=>res.json()).then(data=>{if(data.success){// Update local state\nsetAccounts(prev=>{const updated={...prev};updated[newName]=updated[oldName];delete updated[oldName];return updated;});setEmpires(prev=>prev.map(e=>e===oldName?newName:e));setEditAccount(null);}else{setEditAccountError(data.error||'Rename failed');}}).catch(()=>setEditAccountError('Rename failed')).finally(()=>setEditAccountLoading(false));}// API: Change password\nfunction handleChangePassword(e){e.preventDefault();setEditAccountError('');setEditAccountLoading(true);const name=editAccount;const pass=editAccountPass.trim();if(!pass){setEditAccountError('Enter a new password');setEditAccountLoading(false);return;}fetch('/api/accounts/password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,pass})}).then(res=>res.json()).then(data=>{if(data.success){setAccounts(prev=>({...prev,[name]:pass}));setEditAccount(null);}else{setEditAccountError(data.error||'Password change failed');}}).catch(()=>setEditAccountError('Password change failed')).finally(()=>setEditAccountLoading(false));}// API: Delete account\nfunction handleDeleteAccount(name){if(!window.confirm(`Delete account \"${name}\"? This cannot be undone.`))return;setEditAccountLoading(true);fetch('/api/accounts/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})}).then(res=>res.json()).then(data=>{if(data.success){setAccounts(prev=>{const updated={...prev};delete updated[name];return updated;});setEmpires(prev=>prev.filter(e=>e!==name));setEditAccount(null);}else{alert(data.error||'Delete failed');}}).catch(()=>alert('Delete failed')).finally(()=>setEditAccountLoading(false));}// API: Create new empire\nfunction handleCreateEmpire(e){e.preventDefault();setNewEmpireError('');setNewEmpireLoading(true);const name=newEmpireName.trim();if(!name){setNewEmpireError('Empire name required');setNewEmpireLoading(false);return;}if(empires.some(e=>e.name===name)){setNewEmpireError('Empire already exists');setNewEmpireLoading(false);return;}fetch('/api/empires/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>[...prev,{name,account:null}]);setNewEmpireName('');}else{setNewEmpireError(data.error||'Failed to create empire');}}).catch(()=>setNewEmpireError('Failed to create empire')).finally(()=>setNewEmpireLoading(false));}// API: Delete empire\nfunction handleDeleteEmpire(name){if(!window.confirm(`Delete empire \"${name}\"? This cannot be undone.`))return;setNewEmpireLoading(true);fetch('/api/empires/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})}).then(res=>res.json()).then(data=>{if(data.success){setEmpires(prev=>{const updated=prev.filter(e=>e.name!==name);// If the selected board involves the deleted empire, clear selection\nif(selected){const[a,b]=selected.split('|');if(a===name||b===name){setSelected(null);localStorage.removeItem('stellarisSelectedBoard');}}return updated;});}else{setNewEmpireError(data.error||'Failed to delete empire');}}).catch(()=>setNewEmpireError('Failed to delete empire')).finally(()=>setNewEmpireLoading(false));}// Treaties: permissions\nfunction canEditTreaty(treaty){if(!account)return false;return account.username===treaty.owner||account.username===\"GameMaster\";}function canTransferTreaty(treaty){return account&&account.username===\"GameMaster\";}// Treaties: open new form\nfunction handleAddTreaty(){setTreatyDialog({open:true,mode:'new',data:null});setTreatyError('');}// Treaties: open edit\nfunction handleEditTreaty(treaty){setTreatyDialog({open:true,mode:'edit',data:treaty});setTreatyError('');}// Treaties: open view\nfunction handleViewTreaty(treaty){setTreatyDialog({open:true,mode:'view',data:treaty});setTreatyError('');}// Treaties: cancel form\nfunction handleCancelTreatyForm(){setTreatyDialog({open:false,mode:null,data:null});setTreatyError('');}// Treaties: save (create or update)\nfunction handleSaveTreaty(e){e.preventDefault();setTreatyError('');setTreatySaving(true);const isEdit=treatyEditId!=null;const form={...treatyForm};if(!form.title.trim()||!form.content.trim()||!form.participants.length){setTreatyError('Title, content, and at least one participant are required.');setTreatySaving(false);return;}if(!form.owner)form.owner=account?account.username:'';if(!form.status)form.status='discussion';if(!form.id)form.id=isEdit?treatyEditId:Date.now().toString();fetch('/api/treaties',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)}).then(res=>res.json()).then(data=>{if(data.success){// Always fetch the latest treaties from /treaties.json after save\nreturn fetch('/treaties.json?ts='+Date.now()).then(res=>res.json()).then(data2=>{setTreaties(Array.isArray(data2)?data2:[]);setTreatyForm(null);setTreatyEditId(null);setShowTreatyForm(false);setTreatyViewId(form.id);});}else{setTreatyError(data.error||'Failed to save treaty');}}).catch(()=>setTreatyError('Failed to save treaty')).finally(()=>setTreatySaving(false));}// Treaties: transfer ownership (GM only)\nfunction handleTransferTreatyOwner(treaty,newOwner){if(!canTransferTreaty(treaty))return;setTreatySaving(true);fetch('/api/treaties/transfer',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:treaty.id,newOwner})}).then(res=>res.json()).then(data=>{if(data.success){return fetch('/treaties.json').then(res=>res.json()).then(data2=>setTreaties(Array.isArray(data2)?data2:[]));}}).finally(()=>setTreatySaving(false));}// Treaties: form field change\nfunction handleTreatyFormChange(e){const{name,value,type,options}=e.target;if(type==='select-multiple'){const vals=Array.from(options).filter(o=>o.selected).map(o=>o.value);setTreatyForm(f=>({...f,[name]:vals}));}else{setTreatyForm(f=>({...f,[name]:value}));}}// Treaties: render\nfunction renderTreatyForm(){if(!treatyForm)return null;return/*#__PURE__*/_jsxs(\"form\",{className:\"treaty-form card\",onSubmit:handleSaveTreaty,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-header\",children:[/*#__PURE__*/_jsx(\"input\",{name:\"title\",placeholder:\"Treaty Title\",value:treatyForm.title,onChange:handleTreatyFormChange,className:\"login-input\",required:true,disabled:treatySaving}),/*#__PURE__*/_jsx(\"select\",{name:\"status\",value:treatyForm.status,onChange:handleTreatyFormChange,className:\"login-input\",disabled:treatySaving,children:TREATY_STATUSES.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.value,children:s.label},s.value))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-participants\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"participants-select\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"participants-label\",children:\"Participants\"}),/*#__PURE__*/_jsx(\"select\",{name:\"participants\",value:treatyForm.participants,onChange:handleTreatyFormChange,className:\"login-input\",multiple:true,disabled:treatySaving,children:getEmpireNames().map(e=>/*#__PURE__*/_jsx(\"option\",{value:e,children:e},e))})]}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"owner-select\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"owner-label\",children:\"Owner:\"}),/*#__PURE__*/_jsx(\"select\",{name:\"owner\",value:treatyForm.owner,onChange:handleTreatyFormChange,className:\"login-input\",disabled:treatySaving,children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsx(\"option\",{value:acc,children:acc},acc))})]})]}),/*#__PURE__*/_jsx(\"label\",{className:\"treaty-content-label\",children:\"Treaty Content\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"content\",placeholder:\"Treaty Content\",value:treatyForm.content,onChange:handleTreatyFormChange,className:\"login-input\",rows:9,required:true,disabled:treatySaving}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:treatySaving,children:treatyEditId?\"Save Changes\":\"Create Treaty\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"empire-back-btn\",onClick:handleCancelTreatyForm,disabled:treatySaving,children:\"Cancel\"}),treatyError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error treaty-error\",children:treatyError})]})]});}function renderTreatyView(treaty){const statusObj=TREATY_STATUSES.find(s=>s.value===treaty.status);return/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"treaty-title\",children:treaty.title}),/*#__PURE__*/_jsx(\"span\",{className:\"treaty-status\",style:{color:statusObj.color},children:statusObj?statusObj.label:treaty.status})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-owner\",children:[\"Owner: \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-participants\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",treaty.participants&&treaty.participants.length>0?treaty.participants.join(', '):/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"treaty-content-static\",children:treaty.content}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-view-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",onClick:()=>setTreatyViewId(null),children:\"Back\"}),canEditTreaty(treaty)&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>handleEditTreaty(treaty),children:\"Edit\"}),canTransferTreaty(treaty)&&/*#__PURE__*/_jsx(\"select\",{value:treaty.owner,onChange:e=>handleTransferTreatyOwner(treaty,e.target.value),className:\"owner-transfer-select\",children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsx(\"option\",{value:acc,children:acc},acc))})]})]});}// Add tab for GameMaster\nconst showAccountsTab=account&&account.username===\"GameMaster\";const tabs=[{key:'channels',label:'Channels'},{key:'empires',label:'Empires'},{key:'treaties',label:'Treaties'}];if(showAccountsTab){tabs.push({key:'accounts',label:'Manage Accounts'});tabs.push({key:'manage-empires',label:'Manage Empires'});}// Ref for account edit panel\nconst accountEditPanelRef=useRef(null);// Scroll to edit panel when editAccount changes\nuseEffect(()=>{if(editAccount&&accountEditPanelRef.current){accountEditPanelRef.current.scrollIntoView({behavior:'smooth',block:'center'});}},[editAccount]);// --- MODIFIED: Only allow delete if GM and permission enabled ---\nfunction handleDeleteMessage(boardKey,msgIdx){if(!account||account.username!==\"GameMaster\"||!gmPermissions.canDeleteMessages)return;if(!window.confirm(\"Delete this message?\"))return;fetch('/api/messages/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({board:boardKey,index:Number(msgIdx)})}).then(res=>res.json()).then(()=>{fetch(`/api/messages?board=${encodeURIComponent(boardKey)}`).then(res=>res.json()).then(data=>{setMessages(prev=>({...prev,[boardKey]:data}));});});}// --- NEW: Show Password toggle ---\nconst[showLoginPass,setShowLoginPass]=useState(false);const[showAccountPass,setShowAccountPass]=useState(false);const[showEditAccountPass,setShowEditAccountPass]=useState(false);return/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Stellaris RP Diplomatic Message Boards\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"tabs-bar\",children:[tabs.map(tab=>/*#__PURE__*/_jsx(\"button\",{className:`tab-btn${activeTab===tab.key?' active':''}`,onClick:()=>{setActiveTab(tab.key);setEmpirePage(null);setEditEmpire(null);setEditAccount(null);setTreatyEditId(null);setTreatyViewId(null);setShowTreatyForm(false);},children:tab.label},tab.key)),/*#__PURE__*/_jsxs(\"div\",{className:\"menu-dropdown-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"menu-btn\",\"aria-label\":\"Open menu\",onClick:handleMenuToggle,children:/*#__PURE__*/_jsx(\"span\",{className:\"menu-icon\",children:\"\\u2630\"})}),showMenu&&/*#__PURE__*/_jsxs(\"div\",{className:\"menu-dropdown\",ref:menuDropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{className:\"menu-dropdown-item logout-btn\",onClick:handleLogout,children:[/*#__PURE__*/_jsx(\"span\",{className:\"logout-icon\",children:\"\\uD83D\\uDD11\"}),\" Logout\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handleShowAbout,children:\"About\"}),/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handleShowTheme,children:\"Theme Switcher\"}),account&&account.username===\"GameMaster\"&&/*#__PURE__*/_jsx(\"button\",{className:\"menu-dropdown-item\",onClick:handlePermissionsToggle,children:\"Manage Permissions\"})]}),showPermissions&&/*#__PURE__*/_jsxs(\"div\",{className:\"menu-permissions-dropdown\",ref:permissionsDropdownRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"menu-permissions-title\",children:\"GameMaster Permissions\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"menu-permissions-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!gmPermissions.canDeleteMessages,onChange:e=>handlePermissionChange('canDeleteMessages',e.target.checked)}),\"Allow deleting messages\"]})]})]})]})]}),/*#__PURE__*/_jsx(\"main\",{className:\"main-content\",children:activeTab==='treaties'?/*#__PURE__*/_jsxs(\"section\",{className:\"treaties-section card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Treaties, Contracts & Agreements\"}),account&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:()=>openTreatyDialog('new'),children:\"+ Add New Treaty\"})]}),treatyDialog.open&&treatyDialog.mode!=='view'&&/*#__PURE__*/_jsx(TreatyDialog,{open:treatyDialog.open,mode:treatyDialog.mode,data:treatyDialog.data,onSave:handleTreatySave,onClose:closeTreatyDialog,error:treatyError,saving:treatySaving,empires:empires.map(e=>e.name),accounts:accounts}),treatyDialog.open&&treatyDialog.mode==='view'&&/*#__PURE__*/_jsx(TreatyView,{treaty:treatyDialog.data,onBack:closeTreatyDialog,onEdit:()=>openTreatyDialog('edit',treatyDialog.data),onTransfer:newOwner=>handleTreatyTransferOwner(treatyDialog.data.id,newOwner),canEdit:canEditTreaty(treatyDialog.data),canTransfer:canTransferTreaty(treatyDialog.data),accounts:accounts}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaties-list-container\",children:[!treatiesLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",children:\"Loading treaties...\"}),treaties.length===0&&treatiesLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"no-messages\",children:\"No treaties yet.\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"treaties-list\",children:treaties.map(treaty=>{var _treaty$participants2;return/*#__PURE__*/_jsxs(\"li\",{className:\"treaty-item\",onClick:()=>setTreatyDialog({open:true,mode:'view',data:treaty}),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"treaty-title\",children:treaty.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-meta\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-owner\",children:[\"Owner: \",treaty.owner]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-participants\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Participants:\"}),\" \",((_treaty$participants2=treaty.participants)===null||_treaty$participants2===void 0?void 0:_treaty$participants2.join(', '))||/*#__PURE__*/_jsx(\"i\",{children:\"None\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"treaty-content\",children:treaty.content.length>180?treaty.content.slice(0,180)+'…':treaty.content})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"treaty-actions\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"treaty-status\",children:{discussion:'🗨️ In Discussion',active:'✅ Active',broken:'❌ Broken',expired:'⌛ Expired',other:'❓ Other'}[treaty.status]||treaty.status}),/*#__PURE__*/_jsxs(\"span\",{className:\"treaty-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",onClick:ev=>{ev.stopPropagation();setTreatyDialog({open:true,mode:'view',data:treaty});},children:\"View\"}),canEditTreaty(treaty)&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",onClick:ev=>{ev.stopPropagation();openTreatyDialog('edit',treaty);},children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{background:'#555'},onClick:ev=>{ev.stopPropagation();handleCopyTreaty(treaty);},title:\"Copy treaty\",children:\"Copy\"})]})]})]},treaty.id);})})]})]}):activeTab==='manage-empires'&&showAccountsTab?/*#__PURE__*/_jsxs(\"section\",{className:\"account-manage-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Manage Empires\"}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleCreateEmpire,className:\"account-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"account-form-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"New empire name\",value:newEmpireName,onChange:e=>setNewEmpireName(e.target.value),required:true,className:\"login-input\",disabled:newEmpireLoading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-btn\",disabled:newEmpireLoading,children:\"Create Empire\"})]})}),newEmpireError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:newEmpireError}),/*#__PURE__*/_jsx(\"h3\",{children:\"Empires & Account Assignment\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"accounts-list\",children:empires.map(emp=>/*#__PURE__*/_jsxs(\"li\",{className:\"account-item\",children:[/*#__PURE__*/_jsx(\"b\",{children:emp.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"account-actions\",children:[/*#__PURE__*/_jsxs(\"select\",{value:emp.account||'',onChange:e=>{const val=e.target.value;if(val)handleLinkAccount(emp.name,val);else handleUnlinkAccount(emp.name);},className:\"account-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",className:\"account-option\",children:\"Select account...\"}),Object.keys(accounts).map(accName=>/*#__PURE__*/_jsx(\"option\",{value:accName,className:\"account-option\",children:accName},accName))]}),/*#__PURE__*/_jsx(\"button\",{className:\"account-manage-btn account-delete-btn\",onClick:()=>handleDeleteEmpire(emp.name),disabled:newEmpireLoading,children:\"Delete\"})]})]},emp.name))})]}):activeTab==='accounts'&&showAccountsTab?/*#__PURE__*/_jsxs(\"section\",{className:\"account-manage-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Manage Accounts\"}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleCreateAccount,className:\"account-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"account-form-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Account name\",value:newAccountName,onChange:e=>setNewAccountName(e.target.value),required:true,className:\"login-input\",disabled:accountsTabLoading}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:newAccountPass,onChange:e=>setNewAccountPass(e.target.value),required:true,className:\"login-input\",disabled:accountsTabLoading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-btn\",disabled:accountsTabLoading,children:\"Create\"})]})}),accountError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:accountError}),accountSuccess&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",style:{color:'limegreen'},children:accountSuccess}),/*#__PURE__*/_jsx(\"h3\",{children:\"All Accounts\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"accounts-list\",children:Object.keys(accounts).map(acc=>/*#__PURE__*/_jsxs(\"li\",{className:\"account-item\",children:[/*#__PURE__*/_jsx(\"b\",{children:acc}),acc!==\"GameMaster\"&&/*#__PURE__*/_jsxs(\"span\",{className:\"account-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"account-manage-btn account-edit-btn\",onClick:()=>{setEditAccount(acc);setEditAccountName(acc);setEditAccountPass('');setEditAccountError('');},disabled:editAccountLoading,children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"account-manage-btn account-delete-btn\",onClick:()=>handleDeleteAccount(acc),disabled:editAccountLoading,children:\"Delete\"})]})]},acc))}),editAccount&&/*#__PURE__*/_jsxs(\"div\",{className:\"account-edit-panel card\",ref:accountEditPanelRef,children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Edit Account: \",/*#__PURE__*/_jsx(\"b\",{children:editAccount})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleRenameAccount,className:\"edit-account-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Rename to:\",/*#__PURE__*/_jsx(\"input\",{value:editAccountName,onChange:e=>setEditAccountName(e.target.value),className:\"login-input\",disabled:editAccountLoading})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:editAccountLoading,children:\"Rename\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleChangePassword,className:\"change-password-form\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"New Password:\",/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:editAccountPass,onChange:e=>setEditAccountPass(e.target.value),className:\"login-input\",disabled:editAccountLoading})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"empire-save-btn\",disabled:editAccountLoading,children:\"Change Password\"})]}),editAccountError&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:editAccountError}),/*#__PURE__*/_jsx(\"button\",{className:\"empire-back-btn\",onClick:()=>setEditAccount(null),disabled:editAccountLoading,children:\"Cancel\"})]})]}):activeTab==='empires'?editEmpire?/*#__PURE__*/_jsxs(\"section\",{className:\"empires-info-section card\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Edit \",editEmpire]}),/*#__PURE__*/_jsx(EmpireEditPanel,{name:editEmpire,onCancel:()=>setEditEmpire(null)})]}):empirePage?/*#__PURE__*/_jsx(EmpirePanel,{name:empirePage,canEdit:account&&account.username===empirePage}):/*#__PURE__*/_jsxs(\"section\",{className:\"empires-info-section card\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',alignItems:'center',marginBottom:'1.5rem',gap:'0.3rem'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",style:{margin:0,textAlign:'center'},children:\"Empires Overview\"}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#aaa',fontSize:'1.05rem',fontWeight:500,textAlign:'center'},children:[\"Total Empires: \",/*#__PURE__*/_jsx(\"b\",{children:getEmpireNames().length})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search empires...\",value:empireSearch,onChange:e=>setEmpireSearch(e.target.value),style:{marginTop:'0.7em',padding:'0.5em 1em',borderRadius:8,border:'1px solid var(--border)',background:'var(--primary-bg)',color:'var(--text)',fontSize:'1em',maxWidth:320}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"empires-info-list\",style:{display:'flex',flexWrap:'wrap',gap:'1.5rem',justifyContent:'flex-start'},children:getEmpireNames().map(e=>{const linkedAccount=getEmpireAccount(e);const canEdit=account&&(account.username===linkedAccount||account.username===\"GameMaster\");return/*#__PURE__*/_jsxs(\"div\",{className:\"empire-info-card empire-list-card\",style:{minWidth:260,maxWidth:340,flex:'1 1 320px',background:'var(--primary-bg)',border:'1.5px solid var(--accent)',borderRadius:12,boxShadow:'0 2px 12px #0002',padding:'1.2rem 1.2rem',display:'flex',flexDirection:'column',gap:'0.7rem',cursor:'pointer'},onClick:()=>setEmpirePage(e),children:[/*#__PURE__*/_jsx(\"h3\",{className:\"empire-info-title\",style:{margin:0,color:'var(--accent)',textAlign:'center'},children:e}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#b3cfff',fontWeight:500,fontSize:'1.05em',textAlign:'center',marginBottom:'0.5rem'},children:linkedAccount?/*#__PURE__*/_jsx(\"span\",{title:\"Assigned Account\",children:linkedAccount}):/*#__PURE__*/_jsx(\"i\",{children:\"Unassigned\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"empire-actions\",style:{display:'flex',gap:'0.5rem',marginTop:'0.5rem',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"empire-view-btn\",style:{minWidth:80},onClick:ev=>{ev.stopPropagation();setEmpirePage(e);},children:\"View\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{className:\"empire-save-btn\",style:{minWidth:80},onClick:ev=>{ev.stopPropagation();setEditEmpire(e);},children:\"Edit\"})]})]},e);})})]}):/*#__PURE__*/_jsx(_Fragment,{children:!account?/*#__PURE__*/_jsxs(\"section\",{className:\"account-section card\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"login-title\",children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"account-form login-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"login-fields\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Empire name\",value:loginUser,onChange:e=>setLoginUser(e.target.value),required:true,disabled:!accountsLoaded,className:\"login-input\"}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:showLoginPass?\"text\":\"password\",placeholder:\"Password\",value:loginPass,onChange:e=>setLoginPass(e.target.value),required:true,disabled:!accountsLoaded,className:\"login-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{position:'absolute',right:8,top:8,background:'none',border:'none',color:'#aaa',cursor:'pointer'},tabIndex:-1,onClick:()=>setShowLoginPass(v=>!v),children:showLoginPass?'🙈':'👁️'})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!accountsLoaded,className:\"login-btn\",children:\"Login\"})]}),!accountsLoaded&&/*#__PURE__*/_jsx(\"div\",{className:\"login-loading\",children:\"Loading accounts...\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"login-error\",children:error})]}):/*#__PURE__*/// Center the channels page\n_jsx(\"div\",{style:{display:'flex',justifyContent:'center',width:'100%'},children:/*#__PURE__*/_jsx(\"section\",{className:\"boards-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"channels-main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"channels-sidebar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"boards-list card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:account&&account.username===\"GameMaster\"?\"All Boards\":\"Your Diplomatic Channels\"}),/*#__PURE__*/_jsx(\"div\",{className:\"boards-list-header\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"boards-list-count\",children:[filteredBoards.length,\" \",filteredBoards.length===1?\"channel\":\"channels\"]})}),/*#__PURE__*/_jsxs(\"ul\",{className:\"boards-list-ul\",children:[filteredBoards.length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"no-channels\",children:\"No channels available.\"}),filteredBoards.map(_ref6=>{let[a,b]=_ref6;const key=a+'|'+b;return/*#__PURE__*/_jsx(\"li\",{className:`boards-list-item${selected===key?' active':''}`,children:/*#__PURE__*/_jsxs(\"button\",{className:\"board-btn\",onClick:()=>handleBoardSelect([a,b]),children:[/*#__PURE__*/_jsx(\"span\",{className:\"board-nations\",children:a}),/*#__PURE__*/_jsx(\"span\",{className:\"board-arrow\",children:\"\\u2194\"}),/*#__PURE__*/_jsx(\"span\",{className:\"board-nations\",children:b})]})},key);})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"channels-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"board-messages card\",children:selected&&filteredBoards.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"board-messages-inner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"board-title-row\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"board-title\",children:selected.replace('|',' ↔ ')})}),/*#__PURE__*/_jsxs(\"div\",{className:\"messages-panel\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messages-list-container\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"messages-list\",children:[(messages[selected]||[]).length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"no-messages\",children:\"No messages yet.\"}),(messages[selected]||[]).map((msg,i)=>{const[partnerA,partnerB]=selected.split('|');let partnerClass='';if(msg.author===partnerA)partnerClass='message-partnerA';else if(msg.author===partnerB)partnerClass='message-partnerB';return/*#__PURE__*/_jsxs(\"li\",{className:`message-item ${partnerClass}`,style:{display:'flex',alignItems:'stretch',justifyContent:'flex-start',gap:'0.7rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,minWidth:0,display:'flex',flexDirection:'column',gap:'0.15rem',justifyContent:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-meta\",style:{marginBottom:0},children:[/*#__PURE__*/_jsx(\"span\",{className:\"message-author\",children:msg.author}),/*#__PURE__*/_jsx(\"small\",{className:\"message-date\",children:new Date(msg.timestamp).toLocaleString()})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-text\",children:msg.text})]}),account&&account.username===\"GameMaster\"&&gmPermissions.canDeleteMessages&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',minWidth:'2.5em',paddingLeft:'0.5em'},children:/*#__PURE__*/_jsx(\"button\",{title:\"Delete message\",style:{background:'none',border:'none',color:'#ff4d4d',cursor:'pointer',fontSize:'1.3em',display:'flex',alignItems:'center',height:'2.2em'},onClick:e=>{e.stopPropagation();handleDeleteMessage(selected,i);},children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Delete\",children:\"\\uD83D\\uDDD1\"})})})]},i);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:postMessage,className:\"message-form message-form-bottom\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Your empire\",value:account.username,disabled:true,required:true,className:\"author-input\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Message\",value:text,onChange:e=>setText(e.target.value),required:true,className:\"text-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"send-btn\",children:\"Send\"})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-messages\",children:\"Select a channel to view messages.\"})})})]})})})})}),/*#__PURE__*/_jsx(\"footer\",{className:\"footer\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"Stellaris RP Board \\xA9 \",new Date().getFullYear()]})})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getNationPairs","nations","pairs","i","length","j","push","App","empires","setEmpires","selected","setSelected","saved","localStorage","getItem","messages","setMessages","text","setText","pollingRef","messagesEndRef","accounts","setAccounts","accountsLoaded","setAccountsLoaded","account","setAccount","JSON","parse","loginUser","setLoginUser","loginPass","setLoginPass","error","setError","activeTab","setActiveTab","empirePage","setEmpirePage","editEmpire","setEditEmpire","empireInfo","setEmpireInfo","empireInfoLoaded","setEmpireInfoLoaded","newAccountName","setNewAccountName","newAccountPass","setNewAccountPass","accountError","setAccountError","accountSuccess","setAccountSuccess","accountsTabLoading","setAccountsTabLoading","editAccount","setEditAccount","editAccountName","setEditAccountName","editAccountPass","setEditAccountPass","editAccountError","setEditAccountError","editAccountLoading","setEditAccountLoading","newEmpireName","setNewEmpireName","newEmpireError","setNewEmpireError","newEmpireLoading","setNewEmpireLoading","treaties","setTreaties","treatiesLoaded","setTreatiesLoaded","treatyDialog","setTreatyDialog","open","mode","data","treatyError","setTreatyError","treatySaving","setTreatySaving","fetchTreaties","fetch","Date","now","then","res","json","Array","isArray","catch","openTreatyDialog","arguments","undefined","closeTreatyDialog","handleTreatySave","form","_payload$participants","payload","title","content","participants","owner","username","status","id","toString","method","headers","body","stringify","success","prev","idx","findIndex","t","updated","finally","handleTreatyTransferOwner","newOwner","map","canEditTreaty","treaty","canTransferTreaty","TreatyDialog","_ref","onSave","onClose","saving","setForm","showParticipantsDropdown","setShowParticipantsDropdown","dropdownBtnRef","dropdownListRef","handleClick","e","current","contains","target","document","addEventListener","removeEventListener","handleKey","key","isEdit","statuses","value","label","toggleParticipant","name","f","exists","includes","filter","p","className","children","onSubmit","preventDefault","onChange","required","disabled","s","style","position","ref","tabIndex","userSelect","background","border","borderRadius","padding","minHeight","cursor","marginBottom","display","alignItems","justifyContent","onMouseDown","onClick","v","color","overflow","textOverflow","whiteSpace","flex","join","marginLeft","fontSize","pointerEvents","left","right","top","zIndex","boxShadow","minWidth","flexDirection","gap","maxHeight","overflowY","stopPropagation","role","type","textAlign","transition","width","backgroundColor","ev","height","marginRight","checked","readOnly","accentColor","margin","fontWeight","Object","keys","acc","rows","TreatyView","_ref2","_treaty$participants","onBack","onEdit","onTransfer","canEdit","canTransfer","discussion","active","broken","expired","other","maxWidth","showMenu","setShowMenu","showPermissions","setShowPermissions","gmPermissions","setGmPermissions","canDeleteMessages","setItem","handleMenuToggle","handleMenuClose","menuDropdownRef","permissionsDropdownRef","handleMouseMove","handlePermissionsToggle","handlePermissionChange","handleShowAbout","alert","handleShowTheme","theme","setTheme","setAttribute","handleThemeToggle","empireSearch","setEmpireSearch","getEmpireNames","names","trim","n","toLowerCase","getLinkedBoards","getEmpireAccount","empireName","emp","find","filteredBoards","_ref3","a","b","handleLinkAccount","accountName","handleUnlinkAccount","handleBoardSelect","pair","clearInterval","fetchMessages","encodeURIComponent","ok","Error","err","console","setInterval","prevMessagesLengthRef","currentMessages","scrollIntoView","behavior","postMessage","msg","board","author","timestamp","handleLogin","password","handleLogout","removeItem","saveEmpireInfo","info","EmpireEditPanel","_ref4","onCancel","edit","setEdit","handleChange","handleSave","lore","stats","ethics","civics","special","marginTop","EmpirePanel","_ref5","handleCreateAccount","pass","handleRenameAccount","oldName","newName","handleChangePassword","handleDeleteAccount","window","confirm","handleCreateEmpire","some","handleDeleteEmpire","split","handleAddTreaty","handleEditTreaty","handleViewTreaty","handleCancelTreatyForm","handleSaveTreaty","treatyEditId","treatyForm","data2","setTreatyForm","setTreatyEditId","setShowTreatyForm","setTreatyViewId","handleTransferTreatyOwner","handleTreatyFormChange","options","vals","from","o","renderTreatyForm","placeholder","TREATY_STATUSES","multiple","renderTreatyView","statusObj","showAccountsTab","tabs","accountEditPanelRef","block","handleDeleteMessage","boardKey","msgIdx","index","Number","showLoginPass","setShowLoginPass","showAccountPass","setShowAccountPass","showEditAccountPass","setShowEditAccountPass","tab","_treaty$participants2","slice","handleCopyTreaty","val","accName","flexWrap","linkedAccount","_ref6","replace","partnerA","partnerB","partnerClass","toLocaleString","paddingLeft","getFullYear"],"sources":["C:/Users/Admin/Dokumente/Stellaris/project/StellarisRP-Site/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport './App.css';\r\nimport './Treaties.css';\r\nimport './Empires.css';\r\nimport './Boards.css';\r\nimport './Accounts.css';\r\n\r\nfunction getNationPairs(nations) {\r\n    const pairs = [];\r\n    for (let i = 0; i < nations.length; i++) {\r\n        for (let j = i + 1; j < nations.length; j++) {\r\n            pairs.push([nations[i], nations[j]]);\r\n        }\r\n    }\r\n    return pairs;\r\n}\r\n\r\nfunction App() {\r\n    // Remove unused empireInput, selectedNation, author\r\n    const [empires, setEmpires] = useState([]);\r\n    const [selected, setSelected] = useState(() => {\r\n        const saved = localStorage.getItem('stellarisSelectedBoard');\r\n        return saved ? saved : null;\r\n    });\r\n    const [messages, setMessages] = useState({});\r\n    const [text, setText] = useState('');\r\n    const pollingRef = useRef();\r\n    const messagesEndRef = useRef(null);\r\n    const [accounts, setAccounts] = useState({});\r\n    const [accountsLoaded, setAccountsLoaded] = useState(false);\r\n    const [account, setAccount] = useState(() => {\r\n        const saved = localStorage.getItem('stellarisAccount');\r\n        return saved ? JSON.parse(saved) : null;\r\n    });\r\n    const [loginUser, setLoginUser] = useState('');\r\n    const [loginPass, setLoginPass] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [activeTab, setActiveTab] = useState('channels');\r\n    const [empirePage, setEmpirePage] = useState(null);\r\n    const [editEmpire, setEditEmpire] = useState(null);\r\n    const [empireInfo, setEmpireInfo] = useState({});\r\n    const [empireInfoLoaded, setEmpireInfoLoaded] = useState(false);\r\n\r\n    // Account creation and management\r\n    const [newAccountName, setNewAccountName] = useState('');\r\n    const [newAccountPass, setNewAccountPass] = useState('');\r\n    const [accountError, setAccountError] = useState('');\r\n    const [accountSuccess, setAccountSuccess] = useState('');\r\n    const [accountsTabLoading, setAccountsTabLoading] = useState(false);\r\n    const [editAccount, setEditAccount] = useState(null);\r\n    const [editAccountName, setEditAccountName] = useState('');\r\n    const [editAccountPass, setEditAccountPass] = useState('');\r\n    const [editAccountError, setEditAccountError] = useState('');\r\n    const [editAccountLoading, setEditAccountLoading] = useState(false);\r\n\r\n    // Manage Empires tab\r\n    const [newEmpireName, setNewEmpireName] = useState('');\r\n    const [newEmpireError, setNewEmpireError] = useState('');\r\n    const [newEmpireLoading, setNewEmpireLoading] = useState(false);\r\n\r\n    // --- Treaties State (NEW IMPLEMENTATION) ---\r\n    const [treaties, setTreaties] = useState([]);\r\n    const [treatiesLoaded, setTreatiesLoaded] = useState(false);\r\n    const [treatyDialog, setTreatyDialog] = useState({ open: false, mode: null, data: null });\r\n    const [treatyError, setTreatyError] = useState('');\r\n    const [treatySaving, setTreatySaving] = useState(false);\r\n\r\n    // --- Fetch treaties ---\r\n    function fetchTreaties() {\r\n        fetch('/treaties.json?ts=' + Date.now())\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setTreaties(Array.isArray(data) ? data : []);\r\n                setTreatiesLoaded(true);\r\n            })\r\n            .catch(() => setTreatiesLoaded(true));\r\n    }\r\n    useEffect(() => { fetchTreaties(); }, []);\r\n\r\n    // --- Treaty CRUD ---\r\n    function openTreatyDialog(mode, data = null) {\r\n        setTreatyDialog({ open: true, mode, data });\r\n        setTreatyError('');\r\n    }\r\n    function closeTreatyDialog() {\r\n        setTreatyDialog({ open: false, mode: null, data: null });\r\n        setTreatyError('');\r\n    }\r\n    function handleTreatySave(form) {\r\n        setTreatySaving(true);\r\n        setTreatyError('');\r\n        const payload = { ...form };\r\n        if (!payload.title || !payload.content || !payload.participants?.length) {\r\n            setTreatyError('Title, content, and at least one participant are required.');\r\n            setTreatySaving(false);\r\n            return;\r\n        }\r\n        if (!payload.owner) payload.owner = account?.username || '';\r\n        if (!payload.status) payload.status = 'discussion';\r\n        if (!payload.id) payload.id = Date.now().toString();\r\n\r\n        fetch('/api/treaties', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload)\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                // --- FIX: update treaties state locally, just like accounts ---\r\n                setTreaties(prev => {\r\n                    // If editing, replace; if new, add\r\n                    const idx = prev.findIndex(t => t.id === payload.id);\r\n                    if (idx !== -1) {\r\n                        const updated = [...prev];\r\n                        updated[idx] = { ...prev[idx], ...payload };\r\n                        return updated;\r\n                    } else {\r\n                        return [...prev, payload];\r\n                    }\r\n                });\r\n                closeTreatyDialog();\r\n            } else {\r\n                setTreatyError(data.error || 'Failed to save treaty');\r\n            }\r\n        })\r\n        .catch(() => setTreatyError('Failed to save treaty'))\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n    function handleTreatyTransferOwner(id, newOwner) {\r\n        setTreatySaving(true);\r\n        fetch('/api/treaties/transfer', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ id, newOwner })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setTreaties(prev => prev.map(t => t.id === id ? { ...t, owner: newOwner } : t));\r\n                closeTreatyDialog();\r\n            }\r\n        })\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n\r\n    // --- Treaty Permissions ---\r\n    function canEditTreaty(treaty) {\r\n        if (!account) return false;\r\n        return account.username === treaty.owner || account.username === \"GameMaster\";\r\n    }\r\n    function canTransferTreaty(treaty) {\r\n        return account && account.username === \"GameMaster\";\r\n    }\r\n\r\n    // --- Treaty Dialog UI ---\r\n    function TreatyDialog({ open, mode, data, onSave, onClose, error, saving, empires, accounts }) {\r\n        const [form, setForm] = useState(() => data ? { ...data } : {\r\n            title: '', content: '', participants: [], status: 'discussion', owner: account?.username || ''\r\n        });\r\n        const [showParticipantsDropdown, setShowParticipantsDropdown] = useState(false);\r\n        const dropdownBtnRef = useRef(null);\r\n        const dropdownListRef = useRef(null);\r\n\r\n        useEffect(() => {\r\n            if (data) setForm({ ...data });\r\n            else setForm({ title: '', content: '', participants: [], status: 'discussion', owner: account?.username || '' });\r\n        }, [data, open]);\r\n\r\n        // --- Dropdown close on outside click ---\r\n        useEffect(() => {\r\n            if (!showParticipantsDropdown) return;\r\n            function handleClick(e) {\r\n                if (\r\n                    dropdownBtnRef.current &&\r\n                    !dropdownBtnRef.current.contains(e.target) &&\r\n                    dropdownListRef.current &&\r\n                    !dropdownListRef.current.contains(e.target)\r\n                ) {\r\n                    setShowParticipantsDropdown(false);\r\n                }\r\n            }\r\n            document.addEventListener('mousedown', handleClick);\r\n            return () => document.removeEventListener('mousedown', handleClick);\r\n        }, [showParticipantsDropdown]);\r\n\r\n        // Keyboard navigation: close dropdown on Escape\r\n        useEffect(() => {\r\n            if (!showParticipantsDropdown) return;\r\n            function handleKey(e) {\r\n                if (e.key === \"Escape\") setShowParticipantsDropdown(false);\r\n            }\r\n            document.addEventListener('keydown', handleKey);\r\n            return () => document.removeEventListener('keydown', handleKey);\r\n        }, [showParticipantsDropdown]);\r\n\r\n        if (!open) return null;\r\n\r\n        const isEdit = mode === 'edit';\r\n        const statuses = [\r\n            { value: 'discussion', label: '🗨️ In Discussion' },\r\n            { value: 'active', label: '✅ Active' },\r\n            { value: 'broken', label: '❌ Broken' },\r\n            { value: 'expired', label: '⌛ Expired' },\r\n            { value: 'other', label: '❓ Other' }\r\n        ];\r\n\r\n        // Helper for participants dropdown\r\n        function toggleParticipant(name) {\r\n            setForm(f => {\r\n                const exists = f.participants.includes(name);\r\n                return {\r\n                    ...f,\r\n                    participants: exists\r\n                        ? f.participants.filter(p => p !== name)\r\n                        : [...f.participants, name]\r\n                };\r\n            });\r\n        }\r\n\r\n        return (\r\n            <div className=\"treaty-dialog-overlay\">\r\n                <div className=\"treaty-dialog\">\r\n                    <h2>{isEdit ? 'Edit Treaty' : 'New Treaty'}</h2>\r\n                    <form onSubmit={e => { e.preventDefault(); onSave(form); }}>\r\n                        <label>\r\n                            Title:\r\n                            <input\r\n                                value={form.title}\r\n                                onChange={e => setForm(f => ({ ...f, title: e.target.value }))}\r\n                                required\r\n                                disabled={saving}\r\n                            />\r\n                        </label>\r\n                        <label>\r\n                            Status:\r\n                            <select\r\n                                value={form.status}\r\n                                onChange={e => setForm(f => ({ ...f, status: e.target.value }))}\r\n                                disabled={saving}\r\n                            >\r\n                                {statuses.map(s => (\r\n                                    <option key={s.value} value={s.value}>{s.label}</option>\r\n                                ))}\r\n                            </select>\r\n                        </label>\r\n                        <label style={{ position: 'relative' }}>\r\n                            Participants:\r\n                            <div\r\n                                className=\"participants-dropdown\"\r\n                                ref={dropdownBtnRef}\r\n                                tabIndex={0}\r\n                                style={{\r\n                                    userSelect: 'none',\r\n                                    background: 'var(--primary-bg)',\r\n                                    border: '1px solid var(--border)',\r\n                                    borderRadius: 8,\r\n                                    padding: '0.7rem 1rem',\r\n                                    minHeight: '2.2rem',\r\n                                    cursor: saving ? 'not-allowed' : 'pointer',\r\n                                    marginBottom: '0.7rem',\r\n                                    position: 'relative',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'space-between'\r\n                                }}\r\n                                // Prevent the first click from toggling the first item\r\n                                onMouseDown={e => e.preventDefault()}\r\n                                onClick={e => {\r\n                                    if (!saving) setShowParticipantsDropdown(v => !v);\r\n                                }}\r\n                                aria-haspopup=\"listbox\"\r\n                                aria-expanded={showParticipantsDropdown}\r\n                            >\r\n                                <span style={{\r\n                                    color: form.participants.length ? 'var(--text)' : '#aaa',\r\n                                    overflow: 'hidden',\r\n                                    textOverflow: 'ellipsis',\r\n                                    whiteSpace: 'nowrap',\r\n                                    flex: 1\r\n                                }}>\r\n                                    {form.participants.length\r\n                                        ? form.participants.join(', ')\r\n                                        : 'Select participants...'}\r\n                                </span>\r\n                                <span style={{ marginLeft: 8, color: '#aaa', fontSize: '1.1em', pointerEvents: 'none' }}>▼</span>\r\n                            </div>\r\n                            {showParticipantsDropdown && (\r\n                                <div\r\n                                    className=\"participants-dropdown-list\"\r\n                                    ref={dropdownListRef}\r\n                                    style={{\r\n                                        position: 'absolute',\r\n                                        left: 0,\r\n                                        right: 0,\r\n                                        top: 'calc(100% + 8px)',\r\n                                        zIndex: 1001,\r\n                                        background: 'var(--card-bg)',\r\n                                        border: '1.5px solid var(--accent)',\r\n                                        borderRadius: 10,\r\n                                        boxShadow: '0 4px 24px #0005',\r\n                                        minWidth: 210,\r\n                                        padding: '0.3rem 0',\r\n                                        display: 'flex',\r\n                                        flexDirection: 'column',\r\n                                        gap: '0.2rem',\r\n                                        maxHeight: 220,\r\n                                        overflowY: 'auto'\r\n                                    }}\r\n                                    onClick={e => e.stopPropagation()}\r\n                                    role=\"listbox\"\r\n                                >\r\n                                    {empires.map((e, idx) => (\r\n                                        <button\r\n                                            key={e}\r\n                                            type=\"button\"\r\n                                            className=\"participants-dropdown-item\"\r\n                                            style={{\r\n                                                background: 'none',\r\n                                                border: 'none',\r\n                                                color: 'var(--accent)',\r\n                                                fontSize: '1.08rem',\r\n                                                textAlign: 'left',\r\n                                                padding: '0.7rem 1.2rem',\r\n                                                cursor: saving ? 'not-allowed' : 'pointer',\r\n                                                borderRadius: 7,\r\n                                                transition: 'background 0.15s, color 0.15s',\r\n                                                width: '100%',\r\n                                                display: 'flex',\r\n                                                alignItems: 'center',\r\n                                                gap: '0.7em',\r\n                                                position: 'relative',\r\n                                                backgroundColor: form.participants.includes(e) ? 'rgba(0,191,255,0.10)' : 'transparent'\r\n                                            }}\r\n                                            tabIndex={-1}\r\n                                            // Prevent the first click after opening from toggling the first item\r\n                                            onMouseDown={ev => ev.preventDefault()}\r\n                                            onClick={ev => {\r\n                                                ev.stopPropagation();\r\n                                                if (!saving) toggleParticipant(e);\r\n                                            }}\r\n                                        >\r\n                                            <span style={{\r\n                                                display: 'inline-flex',\r\n                                                alignItems: 'center',\r\n                                                justifyContent: 'center',\r\n                                                width: 22,\r\n                                                height: 22,\r\n                                                borderRadius: 5,\r\n                                                border: '1.5px solid var(--accent)',\r\n                                                background: form.participants.includes(e) ? 'var(--accent)' : 'var(--primary-bg)',\r\n                                                marginRight: 10,\r\n                                                transition: 'background 0.15s, border 0.15s'\r\n                                            }}>\r\n                                                <input\r\n                                                    type=\"checkbox\"\r\n                                                    checked={form.participants.includes(e)}\r\n                                                    readOnly\r\n                                                    tabIndex={-1}\r\n                                                    style={{\r\n                                                        accentColor: 'var(--accent)',\r\n                                                        width: 18,\r\n                                                        height: 18,\r\n                                                        margin: 0,\r\n                                                        pointerEvents: 'none'\r\n                                                    }}\r\n                                                />\r\n                                            </span>\r\n                                            <span style={{\r\n                                                color: form.participants.includes(e) ? '#fff' : 'var(--accent)',\r\n                                                fontWeight: form.participants.includes(e) ? 600 : 400,\r\n                                                flex: 1,\r\n                                                textAlign: 'left'\r\n                                            }}>\r\n                                                {e}\r\n                                            </span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </label>\r\n                        {account?.username === \"GameMaster\" && (\r\n                            <label>\r\n                                Owner:\r\n                                <select\r\n                                    value={form.owner}\r\n                                    onChange={e => setForm(f => ({ ...f, owner: e.target.value }))}\r\n                                    disabled={saving}\r\n                                >\r\n                                    {Object.keys(accounts).map(acc => (\r\n                                        <option key={acc} value={acc}>{acc}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </label>\r\n                        )}\r\n                        <label>\r\n                            Content:\r\n                            <textarea\r\n                                value={form.content}\r\n                                onChange={e => setForm(f => ({ ...f, content: e.target.value }))}\r\n                                rows={7}\r\n                                required\r\n                                disabled={saving}\r\n                            />\r\n                        </label>\r\n                        {error && <div className=\"login-error treaty-error\">{error}</div>}\r\n                        <div className=\"treaty-form-actions\">\r\n                            <button type=\"submit\" className=\"empire-save-btn\" disabled={saving}>\r\n                                {isEdit ? \"Save Changes\" : \"Create Treaty\"}\r\n                            </button>\r\n                            <button type=\"button\" className=\"empire-back-btn\" onClick={onClose} disabled={saving}>Cancel</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- Treaty View UI ---\r\n    function TreatyView({ treaty, onBack, onEdit, onTransfer, canEdit, canTransfer, accounts }) {\r\n        if (!treaty) return null;\r\n        const statuses = {\r\n            discussion: '🗨️ In Discussion',\r\n            active: '✅ Active',\r\n            broken: '❌ Broken',\r\n            expired: '⌛ Expired',\r\n            other: '❓ Other'\r\n        };\r\n        return (\r\n            <div className=\"treaty-dialog-overlay\">\r\n                <div className=\"treaty-dialog\">\r\n                    <h2>{treaty.title}</h2>\r\n                    <div><b>Status:</b> {statuses[treaty.status] || treaty.status}</div>\r\n                    <div><b>Owner:</b> {treaty.owner}</div>\r\n                    <div><b>Participants:</b> {treaty.participants?.join(', ') || <i>None</i>}</div>\r\n                    <div style={{margin: '1em 0', whiteSpace: 'pre-line'}}>{treaty.content}</div>\r\n                    <div className=\"treaty-form-actions\">\r\n                        <button className=\"empire-back-btn\" style={{minWidth: 110, maxWidth: 160}} onClick={onBack}>Back</button>\r\n                        {canEdit && <button className=\"empire-save-btn\" style={{minWidth: 110, maxWidth: 160}} onClick={onEdit}>Edit</button>}\r\n                        {/* The owner transfer dropdown is intentionally removed from view mode */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- NEW: Permissions state for GameMaster ---\r\n    const [showMenu, setShowMenu] = useState(false);\r\n    const [showPermissions, setShowPermissions] = useState(false);\r\n    const [gmPermissions, setGmPermissions] = useState(() => {\r\n        // Persist in localStorage\r\n        const saved = localStorage.getItem('stellarisGmPermissions');\r\n        return saved ? JSON.parse(saved) : { canDeleteMessages: true };\r\n    });\r\n\r\n    // Save GM permissions to localStorage\r\n    useEffect(() => {\r\n        localStorage.setItem('stellarisGmPermissions', JSON.stringify(gmPermissions));\r\n    }, [gmPermissions]);\r\n\r\n    // --- NEW: Menu handlers ---\r\n    function handleMenuToggle() {\r\n        setShowMenu(v => !v);\r\n        setShowPermissions(false);\r\n    }\r\n    function handleMenuClose() {\r\n        setShowMenu(false);\r\n        setShowPermissions(false);\r\n    }\r\n    // Keep menu open when hovering either dropdown or permissions\r\n    const menuDropdownRef = useRef(null);\r\n    const permissionsDropdownRef = useRef(null);\r\n\r\n    // Close menu only if mouse leaves both dropdowns\r\n    useEffect(() => {\r\n        if (!showMenu && !showPermissions) return;\r\n        function handleMouseMove(e) {\r\n            if (\r\n                menuDropdownRef.current &&\r\n                permissionsDropdownRef.current &&\r\n                !menuDropdownRef.current.contains(e.target) &&\r\n                !permissionsDropdownRef.current.contains(e.target)\r\n            ) {\r\n                setShowMenu(false);\r\n                setShowPermissions(false);\r\n            }\r\n        }\r\n        document.addEventListener('mousedown', handleMouseMove);\r\n        return () => document.removeEventListener('mousedown', handleMouseMove);\r\n    }, [showMenu, showPermissions]);\r\n    function handlePermissionsToggle() {\r\n        setShowPermissions(v => !v);\r\n    }\r\n    function handlePermissionChange(key, value) {\r\n        setGmPermissions(prev => ({ ...prev, [key]: value }));\r\n    }\r\n\r\n    // --- NEW: Other menu options ---\r\n    function handleShowAbout() {\r\n        alert(\"Stellaris RP Board\\n\\nCreated for roleplay and diplomacy.\\n\\nContact: admin@example.com\");\r\n        handleMenuClose();\r\n    }\r\n    function handleShowTheme() {\r\n        alert(\"Theme switcher coming soon!\");\r\n        handleMenuClose();\r\n    }\r\n\r\n    // --- NEW: Theme toggle ---\r\n    const [theme, setTheme] = useState(() => localStorage.getItem('stellarisTheme') || 'dark');\r\n    useEffect(() => {\r\n        document.body.setAttribute('data-theme', theme);\r\n        localStorage.setItem('stellarisTheme', theme);\r\n    }, [theme]);\r\n    function handleThemeToggle() {\r\n        setTheme(t => t === 'dark' ? 'light' : 'dark');\r\n    }\r\n\r\n    // Only load empireInfo when switching to the Empires tab and not viewing/editing any empire.\r\n    // This prevents any reloads while editing or viewing an empire.\r\n    useEffect(() => {\r\n        if (\r\n            activeTab === 'empires' &&\r\n            !editEmpire &&\r\n            !empirePage\r\n        ) {\r\n            // Add cache-busting query param\r\n            fetch(`/empireInfo.json?ts=${Date.now()}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setEmpireInfo(data && typeof data === 'object' ? data : {});\r\n                    setEmpireInfoLoaded(true);\r\n                })\r\n                .catch(() => setEmpireInfoLoaded(true));\r\n        }\r\n    // Only run when switching tabs, or leaving view/edit mode\r\n    }, [activeTab, editEmpire, empirePage]);\r\n\r\n    // --- NEW: Search Empires ---\r\n    const [empireSearch, setEmpireSearch] = useState('');\r\n    function getEmpireNames() {\r\n        const names = empires.map(e => e.name);\r\n        if (!empireSearch.trim()) return names;\r\n        return names.filter(n => n.toLowerCase().includes(empireSearch.trim().toLowerCase()));\r\n    }\r\n\r\n    // Helper: get boards from linked empires\r\n    function getLinkedBoards() {\r\n        const names = getEmpireNames();\r\n        return getNationPairs(names);\r\n    }\r\n\r\n    // Helper: get account linked to empire\r\n    function getEmpireAccount(empireName) {\r\n        const emp = empires.find(e => e.name === empireName);\r\n        return emp && emp.account ? emp.account : null;\r\n    }\r\n\r\n    // Only show boards for the empire assigned to the logged-in account, except GameMaster sees all\r\n    const filteredBoards = account\r\n        ? account.username === \"GameMaster\"\r\n            ? getLinkedBoards()\r\n            : getLinkedBoards().filter(([a, b]) =>\r\n                getEmpireAccount(a) === account.username || getEmpireAccount(b) === account.username\r\n            )\r\n        : [];\r\n\r\n    // GameMaster: link/unlink accounts to empires\r\n    function handleLinkAccount(empireName, accountName) {\r\n        fetch('/api/empires/link', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ empireName, accountName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev =>\r\n                    prev.map(e => e.name === empireName ? { ...e, account: accountName } : e)\r\n                );\r\n            }\r\n        });\r\n    }\r\n    function handleUnlinkAccount(empireName) {\r\n        fetch('/api/empires/unlink', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ empireName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev =>\r\n                    prev.map(e => e.name === empireName ? { ...e, account: null } : e)\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    // Save selected board to localStorage\r\n    function handleBoardSelect(pair) {\r\n        const key = pair.join('|');\r\n        setSelected(key);\r\n        localStorage.setItem('stellarisSelectedBoard', key);\r\n    }\r\n\r\n    // Fetch messages for the selected board from the server\r\n    useEffect(() => {\r\n        // Only poll messages if on channels tab and not editing/viewing empire\r\n        if (\r\n            !selected ||\r\n            activeTab !== 'channels' ||\r\n            editEmpire ||\r\n            empirePage\r\n        ) {\r\n            // Stop polling if not in correct state\r\n            if (pollingRef.current) {\r\n                clearInterval(pollingRef.current);\r\n                pollingRef.current = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Use selected as key\r\n        const key = selected;\r\n\r\n        // Function to fetch messages\r\n        const fetchMessages = () => {\r\n            fetch(`/api/messages?board=${encodeURIComponent(key)}`)\r\n                .then(res => {\r\n                    if (!res.ok) throw new Error('Network response was not ok');\r\n                    return res.json();\r\n                })\r\n                .then(data => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [key]: data\r\n                    }));\r\n                })\r\n                .catch((err) => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [key]: []\r\n                    }));\r\n                    console.error('Failed to fetch messages:', err);\r\n                });\r\n        };\r\n\r\n        // Initial fetch\r\n        fetchMessages();\r\n\r\n        // Set up polling\r\n        pollingRef.current = setInterval(fetchMessages, 2000);\r\n\r\n        // Cleanup on unmount or when selected/activeTab/editEmpire/empirePage changes\r\n        return () => {\r\n            if (pollingRef.current) {\r\n                clearInterval(pollingRef.current);\r\n                pollingRef.current = null;\r\n            }\r\n        };\r\n    }, [selected, activeTab, editEmpire, empirePage]);\r\n\r\n    // Scroll to bottom only when messages actually change for the selected board\r\n    const prevMessagesLengthRef = useRef(0);\r\n    useEffect(() => {\r\n        if (!selected) return;\r\n        const currentMessages = messages[selected] || [];\r\n        if (currentMessages.length !== prevMessagesLengthRef.current) {\r\n            if (messagesEndRef.current) {\r\n                messagesEndRef.current.scrollIntoView({ behavior: 'auto' });\r\n            }\r\n            prevMessagesLengthRef.current = currentMessages.length;\r\n        }\r\n    }, [messages, selected]);\r\n\r\n    // When posting, always use the logged-in account's empire name\r\n    function postMessage(e) {\r\n        e.preventDefault();\r\n        if (!selected || !account || !text.trim()) return;\r\n        const key = selected;\r\n        const msg = {\r\n            board: key,\r\n            author: account.username,\r\n            text,\r\n            timestamp: Date.now()\r\n        };\r\n        fetch('/api/messages', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(msg)\r\n        })\r\n        .then(res => res.json())\r\n        .then(() => {\r\n            fetch(`/api/messages?board=${encodeURIComponent(key)}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [key]: data\r\n                    }));\r\n                });\r\n        });\r\n        setText('');\r\n    }\r\n\r\n    // Fetch accounts from server (accounts.json)\r\n    useEffect(() => {\r\n        fetch('/accounts.json')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setAccounts(data);\r\n                setAccountsLoaded(true);\r\n            })\r\n            .catch(() => setAccountsLoaded(true));\r\n    }, []);\r\n\r\n    // Load empires from empires.json\r\n    useEffect(() => {\r\n        fetch('/empires.json')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setEmpires(Array.isArray(data) ? data : []);\r\n            });\r\n    }, []);\r\n\r\n    // Fetch treaties from backend\r\n    useEffect(() => {\r\n        fetch('/treaties.json')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                setTreaties(Array.isArray(data) ? data : []);\r\n                setTreatiesLoaded(true);\r\n            })\r\n            .catch(() => setTreatiesLoaded(true));\r\n    }, []);\r\n\r\n    function handleLogin(e) {\r\n        e.preventDefault();\r\n        // Wait until accounts are loaded\r\n        if (!accountsLoaded) {\r\n            setError('Accounts are still loading, please wait...');\r\n            return;\r\n        }\r\n        const username = loginUser.trim();\r\n        const password = loginPass.trim();\r\n        if (!accounts[username]) {\r\n            setError('Invalid credentials');\r\n            return;\r\n        }\r\n        if (accounts[username] !== password) {\r\n            setError('Invalid credentials');\r\n            return;\r\n        }\r\n        setAccount({ username });\r\n        localStorage.setItem('stellarisAccount', JSON.stringify({ username }));\r\n        setError('');\r\n    }\r\n\r\n    function handleLogout() {\r\n        setAccount(null);\r\n        localStorage.removeItem('stellarisAccount');\r\n    }\r\n\r\n    // Save empire info to backend and update local state\r\n    function saveEmpireInfo(name, info) {\r\n        return fetch('/api/empireInfo', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, info })\r\n        })\r\n        .then(res => res.json())\r\n        .then(() => {\r\n            // After saving, reload from backend with cache-busting param\r\n            return fetch(`/empireInfo.json?ts=${Date.now()}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setEmpireInfo(data && typeof data === 'object' ? data : {});\r\n                });\r\n        });\r\n    }\r\n\r\n    // Edit panel for empire info\r\n    function EmpireEditPanel({ name, onCancel }) {\r\n        // Only initialize edit state from empireInfo[name] when the component mounts\r\n        const info = empireInfo[name] || {};\r\n        const [edit, setEdit] = useState(info);\r\n\r\n        // Do NOT use useEffect to update edit state from empireInfo.\r\n        // This ensures the text fields are not reset while editing.\r\n\r\n        function handleChange(e) {\r\n            setEdit({ ...edit, [e.target.name]: e.target.value });\r\n        }\r\n        function handleSave(e) {\r\n            e.preventDefault();\r\n            saveEmpireInfo(name, edit).then(() => {\r\n                onCancel();\r\n            });\r\n        }\r\n\r\n        return (\r\n            <form className=\"empire-edit-form\" onSubmit={handleSave}>\r\n                <label>\r\n                    Lore:\r\n                    <textarea\r\n                        name=\"lore\"\r\n                        value={edit.lore || ''}\r\n                        onChange={handleChange}\r\n                        rows={3}\r\n                    />\r\n                </label>\r\n                <label>\r\n                    Stats:\r\n                    <input name=\"stats\" value={edit.stats || ''} onChange={handleChange} />\r\n                </label>\r\n                <label>\r\n                    Ethics:\r\n                    <input name=\"ethics\" value={edit.ethics || ''} onChange={handleChange} />\r\n                </label>\r\n                <label>\r\n                    Civics:\r\n                    <input name=\"civics\" value={edit.civics || ''} onChange={handleChange} />\r\n                </label>\r\n                <label>\r\n                    Special Info:\r\n                    <input name=\"special\" value={edit.special || ''} onChange={handleChange} />\r\n                </label>\r\n                <div style={{display: 'flex', gap: '1rem', marginTop: '1rem'}}>\r\n                    <button type=\"submit\" className=\"empire-save-btn\">Save</button>\r\n                    <button type=\"button\" className=\"empire-back-btn\" onClick={onCancel}>Cancel</button>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    // View panel for empire info\r\n    function EmpirePanel({ name, canEdit }) {\r\n        const info = empireInfo[name] || {};\r\n        return (\r\n            <div\r\n                className=\"empire-info-card empire-info-page\"\r\n                style={{\r\n                    maxWidth: 420,\r\n                    margin: '2rem auto',\r\n                    background: 'var(--card-bg)',\r\n                    border: '1.5px solid var(--accent)',\r\n                    borderRadius: 14,\r\n                    boxShadow: '0 2px 16px #0002',\r\n                    padding: '2rem 2rem',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'stretch',\r\n                    gap: '1rem'\r\n                }}\r\n            >\r\n                <h2 className=\"empire-info-title\" style={{marginBottom: 0}}>{name}</h2>\r\n                <div style={{color: '#b3cfff', fontWeight: 500, marginBottom: '1.2rem', fontSize: '1.08em', textAlign: 'center'}}>\r\n                    Owner: <span style={{color: '#fff'}}>{getEmpireAccount(name) || <i>Unassigned</i>}</span>\r\n                </div>\r\n                <div className=\"empire-info-details\">\r\n                    <div><b>Lore:</b> <div className=\"empire-info-field\">{info.lore || <i>No lore set.</i>}</div></div>\r\n                    <div><b>Stats:</b> <div className=\"empire-info-field\">{info.stats || <i>No stats set.</i>}</div></div>\r\n                    <div><b>Ethics:</b> <div className=\"empire-info-field\">{info.ethics || <i>No ethics set.</i>}</div></div>\r\n                    <div><b>Civics:</b> <div className=\"empire-info-field\">{info.civics || <i>No civics set.</i>}</div></div>\r\n                    <div><b>Special Info:</b> <div className=\"empire-info-field\">{info.special || <i>No special info set.</i>}</div></div>\r\n                </div>\r\n                <div style={{display: 'flex', gap: '1rem', marginTop: '1.5rem', justifyContent: 'center'}}>\r\n                    <button className=\"empire-back-btn\" onClick={() => setEmpirePage(null)}>Back to Empires</button>\r\n                    {canEdit && (\r\n                        <button className=\"empire-save-btn\" onClick={() => setEditEmpire(name)}>Edit</button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Defensive: ensure empireInfo is always an object\r\n    useEffect(() => {\r\n        if (!empireInfo || typeof empireInfo !== 'object' || Array.isArray(empireInfo)) {\r\n            setEmpireInfo({});\r\n        }\r\n    }, [empireInfo]);\r\n\r\n    // Defensive: ensure accounts is always an object\r\n    useEffect(() => {\r\n        if (!accounts || typeof accounts !== 'object' || Array.isArray(accounts)) {\r\n            setAccounts({});\r\n        }\r\n    }, [accounts]);\r\n\r\n    // Add API to create new account\r\n    function handleCreateAccount(e) {\r\n        e.preventDefault();\r\n        setAccountError('');\r\n        setAccountSuccess('');\r\n        const name = newAccountName.trim();\r\n        const pass = newAccountPass.trim();\r\n        if (!name || !pass) {\r\n            setAccountError('Name and password required');\r\n            return;\r\n        }\r\n        if (accounts[name]) {\r\n            setAccountError('Account already exists');\r\n            return;\r\n        }\r\n        setAccountsTabLoading(true);\r\n        fetch('/api/accounts', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, pass })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setAccounts(prev => ({ ...prev, [name]: pass }));\r\n                // Remove: setEmpires(prev => prev.includes(name) ? prev : [...prev, name]);\r\n                setAccountSuccess('Account created');\r\n                setNewAccountName('');\r\n                setNewAccountPass('');\r\n            } else {\r\n                setAccountError(data.error || 'Failed to create account');\r\n            }\r\n        })\r\n        .catch(() => setAccountError('Failed to create account'))\r\n        .finally(() => setAccountsTabLoading(false));\r\n    }\r\n\r\n    // API: Rename account\r\n    function handleRenameAccount(e) {\r\n        e.preventDefault();\r\n        setEditAccountError('');\r\n        setEditAccountLoading(true);\r\n        const oldName = editAccount;\r\n        const newName = editAccountName.trim();\r\n        if (!newName || newName === oldName) {\r\n            setEditAccountError('Enter a new name');\r\n            setEditAccountLoading(false);\r\n            return;\r\n        }\r\n        fetch('/api/accounts/rename', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ oldName, newName })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                // Update local state\r\n                setAccounts(prev => {\r\n                    const updated = { ...prev };\r\n                    updated[newName] = updated[oldName];\r\n                    delete updated[oldName];\r\n                    return updated;\r\n                });\r\n                setEmpires(prev => prev.map(e => e === oldName ? newName : e));\r\n                setEditAccount(null);\r\n            } else {\r\n                setEditAccountError(data.error || 'Rename failed');\r\n            }\r\n        })\r\n        .catch(() => setEditAccountError('Rename failed'))\r\n        .finally(() => setEditAccountLoading(false));\r\n    }\r\n\r\n    // API: Change password\r\n    function handleChangePassword(e) {\r\n        e.preventDefault();\r\n        setEditAccountError('');\r\n        setEditAccountLoading(true);\r\n        const name = editAccount;\r\n        const pass = editAccountPass.trim();\r\n        if (!pass) {\r\n            setEditAccountError('Enter a new password');\r\n            setEditAccountLoading(false);\r\n            return;\r\n        }\r\n        fetch('/api/accounts/password', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name, pass })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setAccounts(prev => ({ ...prev, [name]: pass }));\r\n                setEditAccount(null);\r\n            } else {\r\n                setEditAccountError(data.error || 'Password change failed');\r\n            }\r\n        })\r\n        .catch(() => setEditAccountError('Password change failed'))\r\n        .finally(() => setEditAccountLoading(false));\r\n    }\r\n\r\n    // API: Delete account\r\n    function handleDeleteAccount(name) {\r\n        if (!window.confirm(`Delete account \"${name}\"? This cannot be undone.`)) return;\r\n        setEditAccountLoading(true);\r\n        fetch('/api/accounts/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setAccounts(prev => {\r\n                    const updated = { ...prev };\r\n                    delete updated[name];\r\n                    return updated;\r\n                });\r\n                setEmpires(prev => prev.filter(e => e !== name));\r\n                setEditAccount(null);\r\n            } else {\r\n                alert(data.error || 'Delete failed');\r\n            }\r\n        })\r\n        .catch(() => alert('Delete failed'))\r\n        .finally(() => setEditAccountLoading(false));\r\n    }\r\n\r\n    // API: Create new empire\r\n    function handleCreateEmpire(e) {\r\n        e.preventDefault();\r\n        setNewEmpireError('');\r\n        setNewEmpireLoading(true);\r\n        const name = newEmpireName.trim();\r\n        if (!name) {\r\n            setNewEmpireError('Empire name required');\r\n            setNewEmpireLoading(false);\r\n            return;\r\n        }\r\n        if (empires.some(e => e.name === name)) {\r\n            setNewEmpireError('Empire already exists');\r\n            setNewEmpireLoading(false);\r\n            return;\r\n        }\r\n        fetch('/api/empires/create', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev => [...prev, { name, account: null }]);\r\n                setNewEmpireName('');\r\n            } else {\r\n                setNewEmpireError(data.error || 'Failed to create empire');\r\n            }\r\n        })\r\n        .catch(() => setNewEmpireError('Failed to create empire'))\r\n        .finally(() => setNewEmpireLoading(false));\r\n    }\r\n\r\n    // API: Delete empire\r\n    function handleDeleteEmpire(name) {\r\n        if (!window.confirm(`Delete empire \"${name}\"? This cannot be undone.`)) return;\r\n        setNewEmpireLoading(true);\r\n        fetch('/api/empires/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ name })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                setEmpires(prev => {\r\n                    const updated = prev.filter(e => e.name !== name);\r\n                    // If the selected board involves the deleted empire, clear selection\r\n                    if (selected) {\r\n                        const [a, b] = selected.split('|');\r\n                        if (a === name || b === name) {\r\n                            setSelected(null);\r\n                            localStorage.removeItem('stellarisSelectedBoard');\r\n                        }\r\n                    }\r\n                    return updated;\r\n                });\r\n            } else {\r\n                setNewEmpireError(data.error || 'Failed to delete empire');\r\n            }\r\n        })\r\n        .catch(() => setNewEmpireError('Failed to delete empire'))\r\n        .finally(() => setNewEmpireLoading(false));\r\n    }\r\n\r\n    // Treaties: permissions\r\n    function canEditTreaty(treaty) {\r\n        if (!account) return false;\r\n        return account.username === treaty.owner || account.username === \"GameMaster\";\r\n    }\r\n    function canTransferTreaty(treaty) {\r\n        return account && account.username === \"GameMaster\";\r\n    }\r\n\r\n    // Treaties: open new form\r\n    function handleAddTreaty() {\r\n        setTreatyDialog({\r\n            open: true,\r\n            mode: 'new',\r\n            data: null\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: open edit\r\n    function handleEditTreaty(treaty) {\r\n        setTreatyDialog({\r\n            open: true,\r\n            mode: 'edit',\r\n            data: treaty\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: open view\r\n    function handleViewTreaty(treaty) {\r\n        setTreatyDialog({\r\n            open: true,\r\n            mode: 'view',\r\n            data: treaty\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: cancel form\r\n    function handleCancelTreatyForm() {\r\n        setTreatyDialog({\r\n            open: false,\r\n            mode: null,\r\n            data: null\r\n        });\r\n        setTreatyError('');\r\n    }\r\n\r\n    // Treaties: save (create or update)\r\n    function handleSaveTreaty(e) {\r\n        e.preventDefault();\r\n        setTreatyError('');\r\n        setTreatySaving(true);\r\n        const isEdit = treatyEditId != null;\r\n        const form = { ...treatyForm };\r\n        if (!form.title.trim() || !form.content.trim() || !form.participants.length) {\r\n            setTreatyError('Title, content, and at least one participant are required.');\r\n            setTreatySaving(false);\r\n            return;\r\n        }\r\n        if (!form.owner) form.owner = account ? account.username : '';\r\n        if (!form.status) form.status = 'discussion';\r\n        if (!form.id) form.id = isEdit ? treatyEditId : Date.now().toString();\r\n\r\n        fetch('/api/treaties', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(form)\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                // Always fetch the latest treaties from /treaties.json after save\r\n                return fetch('/treaties.json?ts=' + Date.now())\r\n                    .then(res => res.json())\r\n                    .then(data2 => {\r\n                        setTreaties(Array.isArray(data2) ? data2 : []);\r\n                        setTreatyForm(null);\r\n                        setTreatyEditId(null);\r\n                        setShowTreatyForm(false);\r\n                        setTreatyViewId(form.id);\r\n                    });\r\n            } else {\r\n                setTreatyError(data.error || 'Failed to save treaty');\r\n            }\r\n        })\r\n        .catch(() => setTreatyError('Failed to save treaty'))\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n\r\n    // Treaties: transfer ownership (GM only)\r\n    function handleTransferTreatyOwner(treaty, newOwner) {\r\n        if (!canTransferTreaty(treaty)) return;\r\n        setTreatySaving(true);\r\n        fetch('/api/treaties/transfer', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ id: treaty.id, newOwner })\r\n        })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.success) {\r\n                return fetch('/treaties.json')\r\n                    .then(res => res.json())\r\n                    .then(data2 => setTreaties(Array.isArray(data2) ? data2 : []));\r\n            }\r\n        })\r\n        .finally(() => setTreatySaving(false));\r\n    }\r\n\r\n    // Treaties: form field change\r\n    function handleTreatyFormChange(e) {\r\n        const { name, value, type, options } = e.target;\r\n        if (type === 'select-multiple') {\r\n            const vals = Array.from(options).filter(o => o.selected).map(o => o.value);\r\n            setTreatyForm(f => ({ ...f, [name]: vals }));\r\n        } else {\r\n            setTreatyForm(f => ({ ...f, [name]: value }));\r\n        }\r\n    }\r\n\r\n    // Treaties: render\r\n    function renderTreatyForm() {\r\n        if (!treatyForm) return null;\r\n        return (\r\n            <form className=\"treaty-form card\" onSubmit={handleSaveTreaty}>\r\n                <div className=\"treaty-form-header\">\r\n                    <input\r\n                        name=\"title\"\r\n                        placeholder=\"Treaty Title\"\r\n                        value={treatyForm.title}\r\n                        onChange={handleTreatyFormChange}\r\n                        className=\"login-input\"\r\n                        required\r\n                        disabled={treatySaving}\r\n                    />\r\n                    <select\r\n                        name=\"status\"\r\n                        value={treatyForm.status}\r\n                        onChange={handleTreatyFormChange}\r\n                        className=\"login-input\"\r\n                        disabled={treatySaving}\r\n                    >\r\n                        {TREATY_STATUSES.map(s => (\r\n                            <option key={s.value} value={s.value}>{s.label}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n                <div className=\"treaty-form-participants\">\r\n                    <div className=\"participants-select\">\r\n                        <label className=\"participants-label\">Participants</label>\r\n                        <select\r\n                            name=\"participants\"\r\n                            value={treatyForm.participants}\r\n                            onChange={handleTreatyFormChange}\r\n                            className=\"login-input\"\r\n                            multiple\r\n                            disabled={treatySaving}\r\n                        >\r\n                            {getEmpireNames().map(e => (\r\n                                <option key={e} value={e}>{e}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    {account && account.username === \"GameMaster\" && (\r\n                        <div className=\"owner-select\">\r\n                            <label className=\"owner-label\">Owner:</label>\r\n                            <select\r\n                                name=\"owner\"\r\n                                value={treatyForm.owner}\r\n                                onChange={handleTreatyFormChange}\r\n                                className=\"login-input\"\r\n                                disabled={treatySaving}\r\n                            >\r\n                                {Object.keys(accounts).map(acc => (\r\n                                    <option key={acc} value={acc}>{acc}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                <label className=\"treaty-content-label\">Treaty Content</label>\r\n                <textarea\r\n                    name=\"content\"\r\n                    placeholder=\"Treaty Content\"\r\n                    value={treatyForm.content}\r\n                    onChange={handleTreatyFormChange}\r\n                    className=\"login-input\"\r\n                    rows={9}\r\n                    required\r\n                    disabled={treatySaving}\r\n                />\r\n                <div className=\"treaty-form-actions\">\r\n                    <button type=\"submit\" className=\"empire-save-btn\" disabled={treatySaving}>\r\n                        {treatyEditId ? \"Save Changes\" : \"Create Treaty\"}\r\n                    </button>\r\n                    <button type=\"button\" className=\"empire-back-btn\" onClick={handleCancelTreatyForm} disabled={treatySaving}>Cancel</button>\r\n                    {treatyError && <div className=\"login-error treaty-error\">{treatyError}</div>}\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    function renderTreatyView(treaty) {\r\n        const statusObj = TREATY_STATUSES.find(s => s.value === treaty.status);\r\n        return (\r\n            <div className=\"treaty-view card\">\r\n                <div className=\"treaty-view-header\">\r\n                    <h2 className=\"treaty-title\">{treaty.title}</h2>\r\n                    <span className=\"treaty-status\" style={{color: statusObj.color}}>{statusObj ? statusObj.label : treaty.status}</span>\r\n                </div>\r\n                <div className=\"treaty-view-owner\">\r\n                    Owner: {treaty.owner}\r\n                </div>\r\n                <div className=\"treaty-view-participants\">\r\n                    <b>Participants:</b> {treaty.participants && treaty.participants.length > 0 ? treaty.participants.join(', ') : <i>None</i>}\r\n                </div>\r\n                <div className=\"treaty-content-static\">\r\n                    {treaty.content}\r\n                </div>\r\n                <div className=\"treaty-view-actions\">\r\n                    <button className=\"empire-back-btn\" onClick={() => setTreatyViewId(null)}>Back</button>\r\n                    {canEditTreaty(treaty) && (\r\n                        <button className=\"empire-save-btn\" onClick={() => handleEditTreaty(treaty)}>Edit</button>\r\n                    )}\r\n                    {canTransferTreaty(treaty) && (\r\n                        <select\r\n                            value={treaty.owner}\r\n                            onChange={e => handleTransferTreatyOwner(treaty, e.target.value)}\r\n                            className=\"owner-transfer-select\"\r\n                        >\r\n                            {Object.keys(accounts).map(acc => (\r\n                                <option key={acc} value={acc}>{acc}</option>\r\n                            ))}\r\n                        </select>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Add tab for GameMaster\r\n    const showAccountsTab = account && account.username === \"GameMaster\";\r\n    const tabs = [\r\n        { key: 'channels', label: 'Channels' },\r\n        { key: 'empires', label: 'Empires' },\r\n        { key: 'treaties', label: 'Treaties' }\r\n    ];\r\n    if (showAccountsTab) {\r\n        tabs.push({ key: 'accounts', label: 'Manage Accounts' });\r\n        tabs.push({ key: 'manage-empires', label: 'Manage Empires' });\r\n    }\r\n\r\n    // Ref for account edit panel\r\n    const accountEditPanelRef = useRef(null);\r\n\r\n    // Scroll to edit panel when editAccount changes\r\n    useEffect(() => {\r\n        if (editAccount && accountEditPanelRef.current) {\r\n            accountEditPanelRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        }\r\n    }, [editAccount]);\r\n\r\n    // --- MODIFIED: Only allow delete if GM and permission enabled ---\r\n    function handleDeleteMessage(boardKey, msgIdx) {\r\n        if (!account || account.username !== \"GameMaster\" || !gmPermissions.canDeleteMessages) return;\r\n        if (!window.confirm(\"Delete this message?\")) return;\r\n        fetch('/api/messages/delete', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ board: boardKey, index: Number(msgIdx) })\r\n        })\r\n        .then(res => res.json())\r\n        .then(() => {\r\n            fetch(`/api/messages?board=${encodeURIComponent(boardKey)}`)\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    setMessages(prev => ({\r\n                        ...prev,\r\n                        [boardKey]: data\r\n                    }));\r\n                });\r\n        });\r\n    }\r\n\r\n    // --- NEW: Show Password toggle ---\r\n    const [showLoginPass, setShowLoginPass] = useState(false);\r\n    const [showAccountPass, setShowAccountPass] = useState(false);\r\n    const [showEditAccountPass, setShowEditAccountPass] = useState(false);\r\n\r\n    return (\r\n        <div className=\"app-container\">\r\n            <header className=\"header\">\r\n                <h1>Stellaris RP Diplomatic Message Boards</h1>\r\n                <div className=\"tabs-bar\">\r\n                    {tabs.map(tab => (\r\n                        <button\r\n                            key={tab.key}\r\n                            className={`tab-btn${activeTab === tab.key ? ' active' : ''}`}\r\n                            onClick={() => {\r\n                                setActiveTab(tab.key);\r\n                                setEmpirePage(null);\r\n                                setEditEmpire(null);\r\n                                setEditAccount(null);\r\n                                setTreatyEditId(null);\r\n                                setTreatyViewId(null);\r\n                                setShowTreatyForm(false);\r\n                            }}\r\n                        >\r\n                            {tab.label}\r\n                        </button>\r\n                    ))}\r\n                    {/* --- Hamburger menu at top right --- */}\r\n                    <div className=\"menu-dropdown-container\">\r\n                        <button\r\n                            className=\"menu-btn\"\r\n                            aria-label=\"Open menu\"\r\n                            onClick={handleMenuToggle}\r\n                        >\r\n                            <span className=\"menu-icon\">&#9776;</span>\r\n                        </button>\r\n                        {showMenu && (\r\n                            <div\r\n                                className=\"menu-dropdown\"\r\n                                ref={menuDropdownRef}\r\n                            >\r\n                                <button className=\"menu-dropdown-item logout-btn\" onClick={handleLogout}>\r\n                                    <span className=\"logout-icon\">&#x1F511;</span> Logout\r\n                                </button>\r\n                                <button className=\"menu-dropdown-item\" onClick={handleShowAbout}>\r\n                                    About\r\n                                </button>\r\n                                <button className=\"menu-dropdown-item\" onClick={handleShowTheme}>\r\n                                    Theme Switcher\r\n                                </button>\r\n                                {account && account.username === \"GameMaster\" && (\r\n                                    <button className=\"menu-dropdown-item\" onClick={handlePermissionsToggle}>\r\n                                        Manage Permissions\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                        {showPermissions && (\r\n                            <div\r\n                                className=\"menu-permissions-dropdown\"\r\n                                ref={permissionsDropdownRef}\r\n                            >\r\n                                <div className=\"menu-permissions-title\">GameMaster Permissions</div>\r\n                                <label className=\"menu-permissions-option\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={!!gmPermissions.canDeleteMessages}\r\n                                        onChange={e => handlePermissionChange('canDeleteMessages', e.target.checked)}\r\n                                    />\r\n                                    Allow deleting messages\r\n                                </label>\r\n                                {/* Add more GM toggles here if needed */}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n            <main className=\"main-content\">\r\n                {activeTab === 'treaties' ? (\r\n                    <section className=\"treaties-section card\">\r\n                        <div className=\"treaties-header\">\r\n                            <h2>Treaties, Contracts & Agreements</h2>\r\n                            {account && (\r\n                                <button\r\n                                    className=\"empire-save-btn\"\r\n                                    onClick={() => openTreatyDialog('new')}\r\n                                >\r\n                                    + Add New Treaty\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        {/* Dialogs */}\r\n                        {treatyDialog.open && treatyDialog.mode !== 'view' && (\r\n                            <TreatyDialog\r\n                                open={treatyDialog.open}\r\n                                mode={treatyDialog.mode}\r\n                                data={treatyDialog.data}\r\n                                onSave={handleTreatySave}\r\n                                onClose={closeTreatyDialog}\r\n                                error={treatyError}\r\n                                saving={treatySaving}\r\n                                empires={empires.map(e => e.name)}\r\n                                accounts={accounts}\r\n                            />\r\n                        )}\r\n                        {treatyDialog.open && treatyDialog.mode === 'view' && (\r\n                            <TreatyView\r\n                                treaty={treatyDialog.data}\r\n                                onBack={closeTreatyDialog}\r\n                                onEdit={() => openTreatyDialog('edit', treatyDialog.data)}\r\n                                onTransfer={newOwner => handleTreatyTransferOwner(treatyDialog.data.id, newOwner)}\r\n                                canEdit={canEditTreaty(treatyDialog.data)}\r\n                                canTransfer={canTransferTreaty(treatyDialog.data)}\r\n                                accounts={accounts}\r\n                            />\r\n                        )}\r\n                        {/* List */}\r\n                        <div className=\"treaties-list-container\">\r\n                            {!treatiesLoaded && <div className=\"login-loading\">Loading treaties...</div>}\r\n                            {treaties.length === 0 && treatiesLoaded && (\r\n                                <div className=\"no-messages\">No treaties yet.</div>\r\n                            )}\r\n                            <ul className=\"treaties-list\">\r\n                                {treaties.map(treaty => (\r\n                                    <li\r\n                                        key={treaty.id}\r\n                                        className=\"treaty-item\"\r\n                                        onClick={() => setTreatyDialog({ open: true, mode: 'view', data: treaty })}\r\n                                    >\r\n                                        <div className=\"treaty-info\">\r\n                                            <div className=\"treaty-title\">{treaty.title}</div>\r\n                                            <div className=\"treaty-meta\">\r\n                                                <div className=\"treaty-owner\">Owner: {treaty.owner}</div>\r\n                                                <div className=\"treaty-participants\">\r\n                                                    <b>Participants:</b> {treaty.participants?.join(', ') || <i>None</i>}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"treaty-content\">\r\n                                                {treaty.content.length > 180 ? treaty.content.slice(0,180) + '…' : treaty.content}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"treaty-actions\">\r\n                                            <span className=\"treaty-status\">\r\n                                                {({\r\n                                                    discussion: '🗨️ In Discussion',\r\n                                                    active: '✅ Active',\r\n                                                    broken: '❌ Broken',\r\n                                                    expired: '⌛ Expired',\r\n                                                    other: '❓ Other'\r\n                                                })[treaty.status] || treaty.status}\r\n                                            </span>\r\n                                            <span className=\"treaty-buttons\">\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    onClick={ev => { ev.stopPropagation(); setTreatyDialog({ open: true, mode: 'view', data: treaty }); }}\r\n                                                >View</button>\r\n                                                {canEditTreaty(treaty) && (\r\n                                                    <button\r\n                                                        className=\"empire-save-btn\"\r\n                                                        onClick={ev => { ev.stopPropagation(); openTreatyDialog('edit', treaty); }}\r\n                                                    >Edit</button>\r\n                                                )}\r\n                                                <button\r\n                                                    className=\"empire-save-btn\"\r\n                                                    style={{background: '#555'}}\r\n                                                    onClick={ev => { ev.stopPropagation(); handleCopyTreaty(treaty); }}\r\n                                                    title=\"Copy treaty\"\r\n                                                >Copy</button>\r\n                                            </span>\r\n                                        </div>\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        </div>\r\n                    </section>\r\n                ) : activeTab === 'manage-empires' && showAccountsTab ? (\r\n                    <section className=\"account-manage-section card\">\r\n                        <h2>Manage Empires</h2>\r\n                        <form onSubmit={handleCreateEmpire} className=\"account-form\">\r\n                            <div className=\"account-form-fields\">\r\n                                <input\r\n                                    placeholder=\"New empire name\"\r\n                                    value={newEmpireName}\r\n                                    onChange={e => setNewEmpireName(e.target.value)}\r\n                                    required\r\n                                    className=\"login-input\"\r\n                                    disabled={newEmpireLoading}\r\n                                />\r\n                                <button type=\"submit\" className=\"login-btn\" disabled={newEmpireLoading}>Create Empire</button>\r\n                            </div>\r\n                        </form>\r\n                        {newEmpireError && <div className=\"login-error\">{newEmpireError}</div>}\r\n                        <h3>Empires & Account Assignment</h3>\r\n                        <ul className=\"accounts-list\">\r\n                            {empires.map(emp => (\r\n                                <li\r\n                                    key={emp.name}\r\n                                    className=\"account-item\"\r\n                                >\r\n                                    <b>{emp.name}</b>\r\n                                    <span className=\"account-actions\">\r\n                                        <select\r\n                                            value={emp.account || ''}\r\n                                            onChange={e => {\r\n                                                const val = e.target.value;\r\n                                                if (val) handleLinkAccount(emp.name, val);\r\n                                                else handleUnlinkAccount(emp.name);\r\n                                            }}\r\n                                            className=\"account-select\"\r\n                                        >\r\n                                            <option value=\"\" className=\"account-option\">Select account...</option>\r\n                                            {Object.keys(accounts).map(accName => (\r\n                                                <option key={accName} value={accName} className=\"account-option\">\r\n                                                    {accName}\r\n                                                </option>\r\n                                            ))}\r\n                                        </select>\r\n                                        <button\r\n                                            className=\"account-manage-btn account-delete-btn\"\r\n                                            onClick={() => handleDeleteEmpire(emp.name)}\r\n                                            disabled={newEmpireLoading}\r\n                                        >Delete</button>\r\n                                    </span>\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    </section>\r\n                ) : activeTab === 'accounts' && showAccountsTab ? (\r\n                    <section className=\"account-manage-section card\">\r\n                        <h2>Manage Accounts</h2>\r\n                        <form onSubmit={handleCreateAccount} className=\"account-form\">\r\n                            <div className=\"account-form-fields\">\r\n                                <input\r\n                                    placeholder=\"Account name\"\r\n                                    value={newAccountName}\r\n                                    onChange={e => setNewAccountName(e.target.value)}\r\n                                    required\r\n                                    className=\"login-input\"\r\n                                    disabled={accountsTabLoading}\r\n                                />\r\n                                <input\r\n                                    type=\"password\"\r\n                                    placeholder=\"Password\"\r\n                                    value={newAccountPass}\r\n                                    onChange={e => setNewAccountPass(e.target.value)}\r\n                                    required\r\n                                    className=\"login-input\"\r\n                                    disabled={accountsTabLoading}\r\n                                />\r\n                                <button type=\"submit\" className=\"login-btn\" disabled={accountsTabLoading}>Create</button>\r\n                            </div>\r\n                        </form>\r\n                        {accountError && <div className=\"login-error\">{accountError}</div>}\r\n                        {accountSuccess && <div className=\"login-loading\" style={{color:'limegreen'}}>{accountSuccess}</div>}\r\n\r\n                        {/* Restore account list with Edit/Delete buttons */}\r\n                        <h3>All Accounts</h3>\r\n                        <ul className=\"accounts-list\">\r\n                            {Object.keys(accounts).map(acc => (\r\n                                <li\r\n                                    key={acc}\r\n                                    className=\"account-item\"\r\n                                >\r\n                                    <b>{acc}</b>\r\n                                    {acc !== \"GameMaster\" && (\r\n                                        <span className=\"account-actions\">\r\n                                            <button\r\n                                                className=\"account-manage-btn account-edit-btn\"\r\n                                                onClick={() => {\r\n                                                    setEditAccount(acc);\r\n                                                    setEditAccountName(acc);\r\n                                                    setEditAccountPass('');\r\n                                                    setEditAccountError('');\r\n                                                }}\r\n                                                disabled={editAccountLoading}\r\n                                            >Edit</button>\r\n                                            <button\r\n                                                className=\"account-manage-btn account-delete-btn\"\r\n                                                onClick={() => handleDeleteAccount(acc)}\r\n                                                disabled={editAccountLoading}\r\n                                            >Delete</button>\r\n                                        </span>\r\n                                    )}\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                        {editAccount && (\r\n                            <div\r\n                                className=\"account-edit-panel card\"\r\n                                ref={accountEditPanelRef}\r\n                            >\r\n                                <h3>Edit Account: <b>{editAccount}</b></h3>\r\n                                <form onSubmit={handleRenameAccount} className=\"edit-account-form\">\r\n                                    <label>\r\n                                        Rename to:\r\n                                        <input\r\n                                            value={editAccountName}\r\n                                            onChange={e => setEditAccountName(e.target.value)}\r\n                                            className=\"login-input\"\r\n                                            disabled={editAccountLoading}\r\n                                        />\r\n                                    </label>\r\n                                    <button type=\"submit\" className=\"empire-save-btn\" disabled={editAccountLoading}>Rename</button>\r\n                                </form>\r\n                                <form onSubmit={handleChangePassword} className=\"change-password-form\">\r\n                                    <label>\r\n                                        New Password:\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            value={editAccountPass}\r\n                                            onChange={e => setEditAccountPass(e.target.value)}\r\n                                            className=\"login-input\"\r\n                                            disabled={editAccountLoading}\r\n                                        />\r\n                                    </label>\r\n                                    <button type=\"submit\" className=\"empire-save-btn\" disabled={editAccountLoading}>Change Password</button>\r\n                                </form>\r\n                                {editAccountError && <div className=\"login-error\">{editAccountError}</div>}\r\n                                <button className=\"empire-back-btn\" onClick={() => setEditAccount(null)} disabled={editAccountLoading}>Cancel</button>\r\n                            </div>\r\n                        )}\r\n                    </section>\r\n                ) : activeTab === 'empires' ? (\r\n                    editEmpire ? (\r\n                        <section className=\"empires-info-section card\">\r\n                            <h2>Edit {editEmpire}</h2>\r\n                            <EmpireEditPanel name={editEmpire} onCancel={() => setEditEmpire(null)} />\r\n                        </section>\r\n                    ) : empirePage ? (\r\n                        <EmpirePanel name={empirePage} canEdit={account && account.username === empirePage} />\r\n                    ) : (\r\n                        <section className=\"empires-info-section card\">\r\n                            <div style={{\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                alignItems: 'center',\r\n                                marginBottom: '1.5rem',\r\n                                gap: '0.3rem'\r\n                            }}>\r\n                                <h2 className=\"section-title\" style={{margin: 0, textAlign: 'center'}}>Empires Overview</h2>\r\n                                <span style={{\r\n                                    color: '#aaa',\r\n                                    fontSize: '1.05rem',\r\n                                    fontWeight: 500,\r\n                                    textAlign: 'center'\r\n                                }}>\r\n                                    Total Empires: <b>{getEmpireNames().length}</b>\r\n                                </span>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search empires...\"\r\n                                    value={empireSearch}\r\n                                    onChange={e => setEmpireSearch(e.target.value)}\r\n                                    style={{\r\n                                        marginTop: '0.7em',\r\n                                        padding: '0.5em 1em',\r\n                                        borderRadius: 8,\r\n                                        border: '1px solid var(--border)',\r\n                                        background: 'var(--primary-bg)',\r\n                                        color: 'var(--text)',\r\n                                        fontSize: '1em',\r\n                                        maxWidth: 320\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                            <div className=\"empires-info-list\" style={{display: 'flex', flexWrap: 'wrap', gap: '1.5rem', justifyContent: 'flex-start'}}>\r\n                                {getEmpireNames().map(e => {\r\n                                    const linkedAccount = getEmpireAccount(e);\r\n                                    const canEdit = account && (account.username === linkedAccount || account.username === \"GameMaster\");\r\n                                    return (\r\n                                        <div\r\n                                            key={e}\r\n                                            className=\"empire-info-card empire-list-card\"\r\n                                            style={{\r\n                                                minWidth: 260,\r\n                                                maxWidth: 340,\r\n                                                flex: '1 1 320px',\r\n                                                background: 'var(--primary-bg)',\r\n                                                border: '1.5px solid var(--accent)',\r\n                                                borderRadius: 12,\r\n                                                boxShadow: '0 2px 12px #0002',\r\n                                                padding: '1.2rem 1.2rem',\r\n                                                display: 'flex',\r\n                                                flexDirection: 'column',\r\n                                                gap: '0.7rem',\r\n                                                cursor: 'pointer'\r\n                                            }}\r\n                                            onClick={() => setEmpirePage(e)}\r\n                                        >\r\n                                            <h3 className=\"empire-info-title\" style={{margin: 0, color: 'var(--accent)', textAlign: 'center'}}>{e}</h3>\r\n                                            <div style={{color: '#b3cfff', fontWeight: 500, fontSize: '1.05em', textAlign: 'center', marginBottom: '0.5rem'}}>\r\n                                                {linkedAccount ? <span title=\"Assigned Account\">{linkedAccount}</span> : <i>Unassigned</i>}\r\n                                            </div>\r\n                                            <div className=\"empire-actions\" style={{display: 'flex', gap: '0.5rem', marginTop: '0.5rem', justifyContent: 'center'}}>\r\n                                                <button\r\n                                                    className=\"empire-view-btn\"\r\n                                                    style={{minWidth: 80}}\r\n                                                    onClick={ev => {ev.stopPropagation(); setEmpirePage(e);}}\r\n                                                >View</button>\r\n                                                {canEdit && (\r\n                                                    <button\r\n                                                        className=\"empire-save-btn\"\r\n                                                        style={{minWidth: 80}}\r\n                                                        onClick={ev => {ev.stopPropagation(); setEditEmpire(e);}}\r\n                                                    >Edit</button>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </section>\r\n                    )\r\n                ) : (\r\n                    <>\r\n                        {!account ? (\r\n                            <section className=\"account-section card\">\r\n                                <h2 className=\"login-title\">Login</h2>\r\n                                <form onSubmit={handleLogin} className=\"account-form login-form\">\r\n                                    <div className=\"login-fields\">\r\n                                        <input\r\n                                            placeholder=\"Empire name\"\r\n                                            value={loginUser}\r\n                                            onChange={e => setLoginUser(e.target.value)}\r\n                                            required\r\n                                            disabled={!accountsLoaded}\r\n                                            className=\"login-input\"\r\n                                        />\r\n                                        <div style={{position: 'relative'}}>\r\n                                            <input\r\n                                                type={showLoginPass ? \"text\" : \"password\"}\r\n                                                placeholder=\"Password\"\r\n                                                value={loginPass}\r\n                                                onChange={e => setLoginPass(e.target.value)}\r\n                                                required\r\n                                                disabled={!accountsLoaded}\r\n                                                className=\"login-input\"\r\n                                            />\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                style={{\r\n                                                    position: 'absolute',\r\n                                                    right: 8,\r\n                                                    top: 8,\r\n                                                    background: 'none',\r\n                                                    border: 'none',\r\n                                                    color: '#aaa',\r\n                                                    cursor: 'pointer'\r\n                                                }}\r\n                                                tabIndex={-1}\r\n                                                onClick={() => setShowLoginPass(v => !v)}\r\n                                            >\r\n                                                {showLoginPass ? '🙈' : '👁️'}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button type=\"submit\" disabled={!accountsLoaded} className=\"login-btn\">Login</button>\r\n                                </form>\r\n                                {!accountsLoaded && <div className=\"login-loading\">Loading accounts...</div>}\r\n                                {error && <div className=\"login-error\">{error}</div>}\r\n                            </section>\r\n                        ) : (\r\n                            // Center the channels page\r\n                            <div style={{ display: 'flex', justifyContent: 'center', width: '100%' }}>\r\n                                <section className=\"boards-section\">\r\n                                    {/* Logout button at top right */}\r\n                                    {/* <div className=\"channels-header\">\r\n                                        <span style={{marginRight: 'auto', color: '#aaa', fontWeight: 500}}>\r\n                                            Logged in as <b>{account.username}</b>\r\n                                        </span>\r\n                                        <button\r\n                                            className=\"logout-btn\"\r\n                                            onClick={handleLogout}\r\n                                            title=\"Logout\"\r\n                                        >\r\n                                            <span className=\"logout-icon\">&#x1F511;</span> Logout\r\n                                        </button>\r\n                                    </div> */}\r\n                                    {/* Main area: boards/channels list left, text channel right */}\r\n                                    <div className=\"channels-main\">\r\n                                        <div className=\"channels-sidebar\">\r\n                                            <div className=\"boards-list card\">\r\n                                                <h2>\r\n                                                    {account && account.username === \"GameMaster\"\r\n                                                        ? \"All Boards\"\r\n                                                        : \"Your Diplomatic Channels\"}\r\n                                                </h2>\r\n                                                <div className=\"boards-list-header\">\r\n                                                    <span className=\"boards-list-count\">\r\n                                                        {filteredBoards.length} {filteredBoards.length === 1 ? \"channel\" : \"channels\"}\r\n                                                    </span>\r\n                                                </div>\r\n                                                <ul className=\"boards-list-ul\">\r\n                                                    {filteredBoards.length === 0 && (\r\n                                                        <li className=\"no-channels\">No channels available.</li>\r\n                                                    )}\r\n                                                    {filteredBoards.map(([a, b]) => {\r\n                                                        const key = a + '|' + b;\r\n                                                        return (\r\n                                                            <li key={key} className={`boards-list-item${selected === key ? ' active' : ''}`}>\r\n                                                                <button\r\n                                                                    className=\"board-btn\"\r\n                                                                    onClick={() => handleBoardSelect([a, b])}\r\n                                                                >\r\n                                                                    <span className=\"board-nations\">{a}</span>\r\n                                                                    <span className=\"board-arrow\">↔</span>\r\n                                                                    <span className=\"board-nations\">{b}</span>\r\n                                                                </button>\r\n                                                            </li>\r\n                                                        );\r\n                                                    })}\r\n                                                </ul>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"channels-content\">\r\n                                            <div className=\"board-messages card\">\r\n                                                {(selected && filteredBoards.length > 0) ? (\r\n                                                    <div className=\"board-messages-inner\">\r\n                                                        <div className=\"board-title-row\">\r\n                                                            <h2 className=\"board-title\">{selected.replace('|', ' ↔ ')}</h2>\r\n                                                        </div>\r\n                                                        <div className=\"messages-panel\">\r\n                                                            <div className=\"messages-list-container\">\r\n                                                                <ul className=\"messages-list\">\r\n                                                                    {(messages[selected] || []).length === 0 && <li className=\"no-messages\">No messages yet.</li>}\r\n                                                                    {(messages[selected] || []).map((msg, i) => {\r\n                                                                        const [partnerA, partnerB] = selected.split('|');\r\n                                                                        let partnerClass = '';\r\n                                                                        if (msg.author === partnerA) partnerClass = 'message-partnerA';\r\n                                                                        else if (msg.author === partnerB) partnerClass = 'message-partnerB';\r\n                                                                        return (\r\n                                                                            <li\r\n                                                                                key={i}\r\n                                                                                className={`message-item ${partnerClass}`}\r\n                                                                                style={{\r\n                                                                                    display: 'flex',\r\n                                                                                    alignItems: 'stretch',\r\n                                                                                    justifyContent: 'flex-start',\r\n                                                                                    gap: '0.7rem'\r\n                                                                                }}\r\n                                                                            >\r\n                                                                                <div style={{\r\n                                                                                    flex: 1,\r\n                                                                                    minWidth: 0,\r\n                                                                                    display: 'flex',\r\n                                                                                    flexDirection: 'column',\r\n                                                                                    gap: '0.15rem',\r\n                                                                                    justifyContent: 'center'\r\n                                                                                }}>\r\n                                                                                    <div className=\"message-meta\" style={{marginBottom: 0}}>\r\n                                                                                        <span className=\"message-author\">{msg.author}</span>\r\n                                                                                        <small className=\"message-date\">{new Date(msg.timestamp).toLocaleString()}</small>\r\n                                                                                    </div>\r\n                                                                                    <div className=\"message-text\">{msg.text}</div>\r\n                                                                                </div>\r\n                                                                                {account && account.username === \"GameMaster\" && gmPermissions.canDeleteMessages && (\r\n                                                                                    <div style={{\r\n                                                                                        display: 'flex',\r\n                                                                                        alignItems: 'center',\r\n                                                                                        justifyContent: 'center',\r\n                                                                                        minWidth: '2.5em',\r\n                                                                                        paddingLeft: '0.5em'\r\n                                                                                    }}>\r\n                                                                                        <button\r\n                                                                                            title=\"Delete message\"\r\n                                                                                            style={{\r\n                                                                                                background: 'none',\r\n                                                                                                border: 'none',\r\n                                                                                                color: '#ff4d4d',\r\n                                                                                                cursor: 'pointer',\r\n                                                                                                fontSize: '1.3em',\r\n                                                                                                display: 'flex',\r\n                                                                                                alignItems: 'center',\r\n                                                                                                height: '2.2em'\r\n                                                                                            }}\r\n                                                                                            onClick={e => {\r\n                                                                                                e.stopPropagation();\r\n                                                                                                handleDeleteMessage(selected, i);\r\n                                                                                            }}\r\n                                                                                        >\r\n                                                                                            <span role=\"img\" aria-label=\"Delete\">&#128465;</span>\r\n                                                                                        </button>\r\n                                                                                    </div>\r\n                                                                                )}\r\n                                                                            </li>\r\n                                                                        );\r\n                                                                    })}\r\n                                                                    <div ref={messagesEndRef} />\r\n                                                                </ul>\r\n                                                            </div>\r\n                                                            <form onSubmit={postMessage} className=\"message-form message-form-bottom\">\r\n                                                                <input\r\n                                                                    placeholder=\"Your empire\"\r\n                                                                    value={account.username}\r\n                                                                    disabled\r\n                                                                    required\r\n                                                                    className=\"author-input\"\r\n                                                                />\r\n                                                                <input\r\n                                                                    placeholder=\"Message\"\r\n                                                                    value={text}\r\n                                                                    onChange={e => setText(e.target.value)}\r\n                                                                    required\r\n                                                                    className=\"text-input\"\r\n                                                                />\r\n                                                                <button type=\"submit\" className=\"send-btn\">Send</button>\r\n                                                            </form>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <div className=\"no-messages\">Select a channel to view messages.</div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </section>\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </main>\r\n            <footer className=\"footer\">\r\n                <span>Stellaris RP Board &copy; {new Date().getFullYear()}</span>\r\n            </footer>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}